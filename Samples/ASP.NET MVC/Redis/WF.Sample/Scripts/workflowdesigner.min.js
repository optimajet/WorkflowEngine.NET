function WorkflowDesigner(e){function t(){var e={actions:new Array,conditions:new Array,rules:new Array,referenceContainers:new Array},t=n.data;return t.Activities.forEach(function(i){void 0!=i.Implementation&&$.each(i.Implementation,function(n,o){if(t.AdditionalParams.Actions.includes(o.ActionName))return!0;var r=function(e){return"Action"===e.Type&&e.Name===o.ActionName};$.grep(t.CodeActions,r).length||(e.actions.includes(o.ActionName)||e.actions.push(o.ActionName),e.referenceContainers.includes(i.Name)||e.referenceContainers.push(i.Name))}),void 0!=i.PreExecutionImplementation&&$.each(i.PreExecutionImplementation,function(n,o){if(t.AdditionalParams.Actions.includes(o.ActionName))return!0;var r=function(e){return"Action"===e.Type&&e.Name===o.ActionName};$.grep(t.CodeActions,r).length||(e.actions.includes(o.ActionName)||e.actions.push(o.ActionName),e.referenceContainers.includes(i.Name)||e.referenceContainers.push(i.Name))})}),t.Transitions.forEach(function(i){$.each(i.Conditions,function(n,o){if(o.Action&&"Action"===o.Type){if(t.AdditionalParams.Conditions.includes(o.Action.ActionName))return!0;var r=function(e){return"Condition"===e.Type&&e.Name===o.Action.ActionName};$.grep(t.CodeActions,r).length||(e.conditions.includes(o.Action.ActionName)||e.conditions.push(o.Action.ActionName),e.referenceContainers.includes(i.Name)||e.referenceContainers.push(i.Name))}})}),t.Actors.forEach(function(i){if(void 0!=i.Rule&&!t.AdditionalParams.Rules.includes(i.Rule)){var n=function(e){return("RuleCheck"===e.Type||"RuleGet"===e.Type)&&e.Name===i.Rule};$.grep(t.CodeActions,n).length||(e.rules.includes(i.Rule)||e.rules.push(i.Rule),e.referenceContainers.includes(i.Name)||e.referenceContainers.push(i.Name))}}),e}function i(){var e=t();e.referenceContainers.length>0&&WorkflowDesignerWindows.ConfirmDialog(WorkflowDesignerConstants.BrokenReferencesDialogText,WorkflowDesignerConstants.ButtonTextYes,function(){var t=n.data;return t.AdditionalParams.Actions=t.AdditionalParams.Actions.concat(e.actions),t.AdditionalParams.Conditions=t.AdditionalParams.Conditions.concat(e.conditions),t.AdditionalParams.Rules=t.AdditionalParams.Rules.concat(e.rules),!0},WorkflowDesignerConstants.ButtonTextNo,function(){return!0})}var n=this;this.Settings=e,WorkflowDesignerWindows.Autocompleter.apiurl=e.apiurl,window.localStorage||WorkflowDesignerCommon.defineLocalStorage(),Array.prototype.includes||WorkflowDesignerCommon.defineArrayIncludes(),this.GetName=function(){return n.Settings.name},this.error=function(e,t){alert(e),void 0!==t&&null!==t&&console.log(e,t)},this.refresh=function(){var e=void 0!==this.data&&void 0!==this.data.__loadParams?this.data.__loadParams:this.loadParams;void 0===e?alert("You might use refresh method after called load method only."):this.load(e)},this.getParam=function(e){return localStorage["WorkflowDesigner_"+e]},this.setParam=function(e,t){var i="WorkflowDesigner_"+e;localStorage[i]=t},this.load=function(e,t,o){var r=new Array;this.loadParams=e,this.schemecode=e.schemecode,this.processid=e.processid,this.schemeid=e.schemeid,e.readonly&&(this.Settings.readonly=e.readonly),r.push({name:"schemecode",value:this.schemecode}),r.push({name:"processid",value:this.processid}),r.push({name:"schemeid",value:this.schemeid}),r.push({name:"operation",value:"load"});$.ajax({url:this.Settings.apiurl,data:r,async:!0,success:function(r){n.Graph&&n.Graph.ClearGraphData();var a=WorkflowDesignerErrors.ErrorWithAlert(s,r,!0,t,o);if(!a.success)return!1;var s=a.data;s.__loadParams=e,n.data=s,e.processid&&n.data.IsSubprocessScheme||i(),n.render()},error:function(e,t,i){var n=WorkflowDesignerErrors.GetErrorText(e,t,i);return WorkflowDesignerErrors.OutErrorMessage(r,n,e.responseText),o&&o(n),!1}})},this.exists=function(e,t,i){var n=new Array;this.schemecode=e.schemecode,this.processid=e.processid,this.schemeid=e.schemeid,e.readonly&&(this.Settings.readonly=e.readonly),n.push({name:"schemecode",value:this.schemecode}),n.push({name:"processid",value:this.processid}),n.push({name:"schemeid",value:this.schemeid}),n.push({name:"operation",value:"exists"});var o;return $.ajax({url:this.Settings.apiurl,data:n,async:!1,success:function(e){var r=WorkflowDesignerErrors.ErrorWithAlert(n,e,!0,t,i);return o=!!r.success&&r.data},error:function(e,t,r){var a=WorkflowDesignerErrors.GetErrorText(e,t,r);return WorkflowDesignerErrors.OutErrorMessage(n,a,e.responseText),i&&i(a),o=!1,!1}}),o},this.create=function(e,t,i){var o=new Array;o.push({name:"operation",value:"load"}),o.push({name:"newschemecode",value:e}),$.ajax({url:this.Settings.apiurl,data:o,async:!0,success:function(e){var r=WorkflowDesignerErrors.ErrorWithAlert(o,e,!0,t,i);if(!r.success)return!1;n.data=r.data,n.render()},error:function(e,t,n){var r=WorkflowDesignerErrors.GetErrorText(e,t,n);return WorkflowDesignerErrors.WorkflowDesignerErrors.OutErrorMessage(o,r),i&&i(r),!1}})},this.render=function(){var e=!1;n.Graph&&(n.Graph.destroy(),void 0!=n.data&&void 0!=n.data.__loadParams&&(void 0!=n.data.__loadParams.isFullScreen&&(e=n.data.__loadParams.isFullScreen),void 0!=n.data.__loadParams.readonly&&(this.Settings.readonly=n.data.__loadParams.readonly)));var t=[WorkflowDesignerActivityManager,WorkflowDesignerTransitionManager,WorkflowDesignerKeyboard];if(Array.isArray(n.Settings.externalComponents)&&n.Settings.externalComponents.forEach(function(e){t.push(e)}),this.Settings.printable||t.push(WorkflowDesignerBackground),this.Settings.notrendertoolbar||t.push(WorkflowDesignerToolbar),n.Settings.printable&&void 0!=n.data){var i=0,o=0;$(n.data.Activities).each(function(e){var t=parseInt(this.DesignerSettings.X),n=parseInt(this.DesignerSettings.Y);t>i&&(i=t),n>o&&(o=n)}),n.Settings.graphwidth=i+n.Settings.DefaultActivityWidth,n.Settings.graphheight=o+n.Settings.DefaultActivityHeight}n.Graph=new WorkflowGraph(this.Settings.renderTo,n,n.Settings,t),n.Graph.setFullScreen(e),void 0!=n.data&&(WorkflowDesignerCommon.DataCorrection(n.data),void 0!=n.data.__loadParams&&void 0!=n.data.__loadParams.graphData&&(n.Graph.graphData=n.data.__loadParams.graphData,n.Graph.graphDataIndex=n.data.__loadParams.graphDataIndex),n.Graph.Draw(n.data),n.Graph.сheckToolbarButtonState())},this.save=function(e,t){if(n.Settings.readonly)return void alert(WorkflowDesignerConstants.ErrorReadOnlySaveText);var i=new Array;i.push({name:"schemecode",value:this.schemecode}),i.push({name:"processid",value:this.processid}),i.push({name:"schemeid",value:this.schemeid}),i.push({name:"operation",value:"save"}),i.push({name:"data",value:JSON.stringify(this.data)});$.ajax({url:this.Settings.apiurl,data:i,async:!0,type:"post",success:function(o){var r=WorkflowDesignerErrors.ErrorWithAlert(i,o,!0,null,t);r.success&&(n.data=r.data,n.render(),e&&setTimeout(function(){e(n)},100))},error:function(e,n,o){var r=WorkflowDesignerErrors.GetErrorText(e,n,o);WorkflowDesignerErrors.OutErrorMessage(i,r,e.responseText),t&&t(r)}})},this.downloadscheme=function(e,t,i){var n=new Array;n.push({name:"operation",value:"downloadscheme"}),n.push({name:"data",value:JSON.stringify(this.data)}),e&&e.name&&n.push({name:"scheme",value:e.name});var o=(this.schemecode?this.schemecode:"scheme")+".xml";WorkflowDesignerCommon.download(o,this.Settings.apiurl,n,"post",t,i)},this.uploadscheme=function(e,t,o){$.ajax({type:"POST",url:this.createurl("uploadscheme"),data:new FormData(e),processData:!1,contentType:!1,success:function(e){var r=WorkflowDesignerErrors.ErrorWithAlert("XML upload",e,!0,null,o);r.success&&(n.data=r.data,i(),n.render(),t&&t(n))},error:function(e,t,i){var n=WorkflowDesignerErrors.GetErrorText(e,t,i);WorkflowDesignerErrors.OutErrorMessage("XML upload",n,e.responseText),o&&o(n)}})},this.createurl=function(e){var t=this.Settings.apiurl,i="?";return t.indexOf("?")>=0&&(i="&"),t+=i+"operation="+e,i="&",void 0!=this.schemeid&&(t+=i+"schemeid="+this.schemeid),void 0!=this.processid&&(t+=i+"processid="+this.processid),void 0!=this.schemecode&&(t+=i+"schemecode="+this.schemecode),t},this.validate=function(){if(1!=$.grep(n.data.Activities,function(e){return e.IsInitial}).length)return WorkflowDesignerConstants.ErrorActivityIsInitialCountText;if(n.data.CanBeInlined){if(0==$.grep(n.data.Activities,function(e){return e.IsFinal}).length)return WorkflowDesignerConstants.ErrorActivityIsFinalCountText}var e=t().referenceContainers;return $.each(n.data.Transitions,function(t,i){var n=!1;"Auto"!==i.Trigger.Type&&(("Timer"===i.Trigger.Type&&!i.Trigger.Timer||"Command"===i.Trigger.Type&&!i.Trigger.Command)&&e.push(i.Name),n=!0),null!==i.Restrictions&&void 0!==i.Restrictions&&$.each(i.Restrictions,function(t,o){o.Actor||n||(e.push(i.Name),n=!0)})}),$.each(n.data.Activities,function(t,i){"Inline"!==i.ActivityType||void 0!=i.SchemeCode&&""!==i.SchemeCode||e.push(i.Name)}),e.length>0?WorkflowDesignerConstants.ErrorInvalidObjectsSaveText(e.join(", ")):void 0},this.destroy=function(){this.schemecode=void 0,this.processid=void 0,this.schemeid=void 0,this.data=void 0,void 0!==this.Graph&&this.Graph.destroy()},this.compile=function(e,t,i){e={Name:e.Name,Type:e.Type,IsGlobal:e.IsGlobal,IsAsync:e.IsAsync,ActionCode:e.ActionCode,Usings:e.Usings};var n=new Array;n.push({name:"schemecode",value:this.schemecode}),n.push({name:"processid",value:this.processid}),n.push({name:"schemeid",value:this.schemeid}),n.push({name:"operation",value:"compile"}),n.push({name:"data",value:JSON.stringify(e)});$.ajax({url:this.Settings.apiurl,data:n,async:!0,type:"post",success:function(e){var o=WorkflowDesignerErrors.ErrorWithAlert(n,e,!0,null,i);o.success&&t&&setTimeout(function(){t(o.data)},100)},error:function(e,t,o){var r=WorkflowDesignerErrors.GetErrorText(e,t,o);WorkflowDesignerErrors.OutErrorMessage(n,r,e.responseText),i&&i(r)}})},this.perform=function(e,t,i){var n=new Array;n.push({name:"schemecode",value:this.schemecode}),n.push({name:"processid",value:this.processid}),n.push({name:"schemeid",value:this.schemeid}),n.push({name:"expression",value:e.expression}),n.push({name:"operation",value:"perform"});$.ajax({url:this.createurl("perform"),data:n,async:!0,type:"post",success:function(e){var o=WorkflowDesignerErrors.ErrorWithAlert(n,e,!0,null,i);o.success&&t&&setTimeout(function(){t(o.data)},100)},error:function(e,t,o){var r=workflowdesignererrors.geterrortext(e,t,o);workflowdesignererrors.outerrormessage(n,r,e.responsetext),i&&i(r)}})},this.deleteGlobalCodeAction=function(e,t,i){var n=new Array;n.push({name:"operation",value:"deleteglobalcodeaction"}),n.push({name:"names",value:JSON.stringify(e)});$.ajax({url:this.Settings.apiurl,data:n,async:!0,type:"post",success:function(e){var o=WorkflowDesignerErrors.ErrorWithAlert(n,e,!0,null,i);o.success&&t&&setTimeout(function(){t(o.data)},100)},error:function(e,t,o){var r=WorkflowDesignerErrors.GetErrorText(e,t,o);WorkflowDesignerErrors.OutErrorMessage(n,r,e.responseText),i&&i(r)}})},this.getemptytype=function(e,t,i){var n=new Array;n.push({name:"operation",value:"getemptytype"}),n.push({name:"data",value:JSON.stringify(e)});$.ajax({url:this.Settings.apiurl,data:n,async:!0,type:"post",success:function(e){var o=WorkflowDesignerErrors.ErrorWithAlert(n,e,!0,null,i);o.success&&t&&setTimeout(function(){t(JSON.stringify(o.data))},100)},error:function(e,t,o){var r=WorkflowDesignerErrors.GetErrorText(e,t,o);WorkflowDesignerErrors.OutErrorMessage(n,r,e.responseText),i&&i(r)}})},this.requestcodeactionparameter=function(e,t,i,n,o){var r=new Array;r.push({name:"operation",value:"getcodeactionparameter"}),r.push({name:"type",value:t}),r.push({name:"name",value:i}),r.push({name:"schemecode",value:e});var a=null;if($.ajax({url:this.Settings.apiurl,data:r,async:!1,type:"post",success:function(e){var t=WorkflowDesignerErrors.ErrorWithAlert(r,e,!0,n,o);if(!t.success)return!1;a=t.data},error:function(e,t,i){var n=WorkflowDesignerErrors.GetErrorText(e,t,i);WorkflowDesignerErrors.OutErrorMessage(r,n,e.responseText),o&&o(n)}}),null==a)return!1;for(var s=0;s<a.length;s+=1)null===a[s].Name&&(a[s].Name="");return a},this.requestautocompletesuggestions=function(e,t,i,n,o){var r=new Array;r.push({name:"operation",value:"getautocompletesuggestions"}),r.push({name:"category",value:t}),r.push({name:"value",value:i}),r.push({name:"schemecode",value:e});var a;return $.ajax({url:this.Settings.apiurl,data:r,async:!1,type:"post",success:function(e){var t=WorkflowDesignerErrors.ErrorWithAlert(r,e,!0,n,o);return a=!!t.success&&t.data},error:function(e,t,i){var n=WorkflowDesignerErrors.GetErrorText(e,t,i);return WorkflowDesignerErrors.OutErrorMessage(r,n,e.responseText),o&&o(n),a=!1}}),a},this.readonlymode=function(e){var t=this;void 0===e||null==e?(t.Settings.notrendertoolbar=!1,t.Settings.notshowwindows=!1,t.Settings.disableobjectmovements=!1):(void 0!=e.notrendertoolbar?t.Settings.notrendertoolbar=e.notrendertoolbar:t.Settings.notrendertoolbar=!1,void 0!=e.notshowwindows?t.Settings.notshowwindows=e.notshowwindows:t.Settings.notshowwindows=!1,void 0!=e.disableobjectmovements?t.Settings.disableobjectmovements=e.disableobjectmovements:t.Settings.disableobjectmovements=!1),t.Settings.readonly=!0,t.Settings.printable&&(t.Settings.graphheight=t.Settings.originalgraphheighth,t.Settings.graphwidth=t.Settings.originalgraphwidth,t.Settings.printable=!1),t.render()},this.printablemode=function(){var e=this;e.Settings.printable||(e.Settings.originalgraphheighth=e.Settings.graphheight,e.Settings.originalgraphwidth=e.Settings.graphwidth),e.Settings.notrendertoolbar=!0,e.Settings.notshowwindows=!0,e.Settings.disableobjectmovements=!1,e.Settings.readonly=!0,e.Settings.printable=!0,e.render()},this.editablemode=function(){var e=this;e.Settings.notrendertoolbar=!1,e.Settings.notshowwindows=!1,e.Settings.disableobjectmovements=!1,e.Settings.readonly=!1,e.Settings.printable&&(e.Settings.graphheight=e.Settings.originalgraphheighth,e.Settings.graphwidth=e.Settings.originalgraphwidth,e.Settings.printable=!1),e.render()},void 0===this.Settings.mode||("readonly"===this.Settings.mode.toLowerCase()?this.readonlymode(e):"printable"===this.Settings.mode.toLowerCase()?this.printablemode():this.editablemode()),this.autoarrangement=function(){var e=this.Graph.GetComponentByType("WorkflowDesignerToolbar");void 0!=e&&e.AutoArrangement()},this.downloadschemeBPMN=function(e,t,i){var n=new Array;n.push({name:"operation",value:"downloadschemebpmn"}),n.push({name:"data",value:JSON.stringify(this.data)}),e&&e.name&&n.push({name:"scheme",value:e.name});var o=(this.schemecode?this.schemecode:"scheme")+".bpmn";WorkflowDesignerCommon.download(o,this.Settings.apiurl,n,"post",t,i)},this.uploadschemeBPMN=function(e,t,o){$.ajax({type:"POST",url:this.createurl("uploadschemebpmn"),data:new FormData(e),processData:!1,contentType:!1,success:function(e){var r=WorkflowDesignerErrors.ErrorWithAlert("BPMN upload",e,!0,null,o);r.success&&(n.data=r.data,i(),n.render(),t&&t(n))},error:function(e,t,i){var n=WorkflowDesignerErrors.GetErrorText(e,t,i);WorkflowDesignerErrors.OutErrorMessage("BPMN upload",n,e.responseText),o&&o(n)}})}}function WorkflowDesignerOverviewMap(){this.type="WorkflowDesignerOverviewMap";var e=this;this.init=function(t){this.graph=t,this.Layer=new Konva.Layer,this.Layer.scale(.5),this.graph.Stage.add(this.Layer),this.Layer.setZIndex(1e3);var i=this.graph.Stage.width(),n=this.graph.Stage.height(),o=void 0!=this.graph.Settings.overviewMapWidth?this.graph.Settings.overviewMapWidth:WorkflowDesignerConstants.OverviewMap.width,r=void 0!=this.graph.Settings.overviewMapHeight?this.graph.Settings.overviewMapHeight:WorkflowDesignerConstants.OverviewMap.height;e.background=new Konva.Image({x:i-o-5,y:n-r-5,width:o,height:r,fill:"white",shadowEnabled:!0,shadowBlur:5,shadowOpacity:.3}),e.Layer.add(e.background)},this.draw=function(){this.GraphRedrawAll()},this.GraphRedrawAll=function(){console.log("GraphRedrawAll")}}function WorkflowDesignerForm(e){var t=this;this.type="WorkflowDesignerForm",this.parameters=e,this.id=WorkflowDesignerCommon.createUUID(),this.isReadOnly=function(){return this.parameters.readonly},this.showModal=function(e,t,i){var n=this;n.window=$('<div tabindex="0" class="ui modal WorkflowDesignerDialog"></div>'),void 0!=WorkflowDesignerConstants.FormMaxHeight&&""!=WorkflowDesignerConstants.FormMaxHeight&&n.window.css("max-height",WorkflowDesignerConstants.FormMaxHeight),void 0!=this.parameters.width&&""!=this.parameters.width&&n.window.width(this.parameters.width),n.window.id=this.id;var o=void 0;switch(this.parameters.type){case"table":o=this.generateTable(this.parameters);break;case"form":o=this.generateForm(this.parameters);break;case"tabs":o=this.generateTabs(this.parameters)}void 0==o&&(o=new Array),void 0!=n.parameters.top&&o.unshift(n.parameters.top),void 0!=n.parameters.bottom&&o.push(n.parameters.bottom),void 0!=this.parameters.renderFinalFunc&&this.parameters.renderFinalFunc(o,n);var r=n.getEditData(n.parameters);n.ClearTempField(r),n.window.append($('<div class="header">'+this.parameters.title+'<div class="headerbuttons"> <span class="close"></span> <span class="fillscreen"></span> </div>')),n.window.append($('<div class="content"></div>').append(o));var a=$('<div class="actions"></div>');n.isReadOnly()?a.append('<div class="ui secondary  cancel button">'+WorkflowDesignerConstants.ButtonTextClose+"</div>"):(a.append('<div class="ui primary ok button">'+WorkflowDesignerConstants.ButtonTextSave+"</div>"),a.append('<div class="ui secondary cancel button">'+WorkflowDesignerConstants.ButtonTextCancel+"</div>")),n.window.append(a);var s=function(){if(n.ClearError(),void 0!=e&&!n.isReadOnly()){return!!e(n.getEditData(n.parameters),n.parameters)&&(n.allowDestroy=!0,!0)}},l=function(){if(!n.isReadOnly()){var e=n.getEditData(n.parameters);return void 0!==i&&i(e,n.parameters),n.ClearTempField(e),JSON.stringify(r)===JSON.stringify(e)?(n.allowDestroy=!0,!0):(WorkflowDesignerWindows.ConfirmDialog(WorkflowDesignerConstants.CloseWithoutSaving,WorkflowDesignerConstants.ButtonTextYes,function(){n.allowDestroy=!0,WorkflowDesignerCommon.modal(n.window,"hide")},WorkflowDesignerConstants.ButtonTextNo,function(){return WorkflowDesignerCommon.modal(n.window,"refresh"),!0}),!1)}n.allowDestroy=!0};WorkflowDesignerCommon.modal(n.window,{closable:!1,onApprove:s,onDeny:l,allowMultiple:!0,onHidden:function(){n.allowDestroy&&n.destroy(),n.parameters.onHidden&&n.parameters.onHidden()},dimmerSettings:{opacity:.2,duration:{show:0,hide:0}},transition:"fade"}),WorkflowDesignerCommon.modal(n.window,"show"),WorkflowDesignerCommon.modal(n.window,"refresh"),void 0!=this.refreshFunc&&this.refreshFunc(),$(".item",n.window).tab({context:"parent"}),$(".ui.accordion",n.window).accordion({exclusive:!1}),$(".close",n.window).click(function(){(n.isReadOnly()||l())&&(n.allowDestroy=!0,WorkflowDesignerCommon.modal(n.window,"hide"))}),$(".fillscreen",n.window).click(function(){n.window.hasClass("fullscreen")?n.window.removeClass("fullscreen"):n.window.addClass("fullscreen"),setTimeout(function(){void 0!=n.refreshFunc&&n.refreshFunc()},500)})},this.destroy=function(){void 0!=this.destroyFunc&&this.destroyFunc(),$(".WorkflowDesignerDialogautoComplete").remove(),this.window.remove()},this.InfoDialog=function(e,t,i){var n="ui modal WorkflowDesignerConfirmDialog";void 0!=i&&(n+=" "+i);var o=$('<div tabindex="0" class="'+n+'"></div>');o.append($('<div class="header">'+e+"</div>")),o.append($('<div class="content scrolling"><p>'+t+"</p></div>"));var r=$('<div class="actions"></div>').append('<div tabindex="1" class="ui primary ok button">'+WorkflowDesignerConstants.EditCodeLabel.OK+"</div>");o.append(r),WorkflowDesignerCommon.modal(o,{allowMultiple:!0,dimmerSettings:{opacity:.2,duration:{show:0,hide:0}},transition:"fade"}),WorkflowDesignerCommon.modal(o,"show"),WorkflowDesignerCommon.modal(o,"refresh")},this.getEditData=function(e){var t,i=this;if("form"===e.type||"group"===e.type)t={},e.elements.forEach(function(e){void 0!=e.field&&(t["control_"+e.field]=e.control),"table"===e.type||"form"===e.type?t[e.field]=i.getEditData(e):"group"===e.type?i.objAssign(t,i.getEditData(e)):"scheme"===e.type||i.SetValueByPropertyName(t,e.field,i.getEasyControlValue(e))});else if("table"===e.type){void 0==t&&(t=[]);var n=e.control;if(e.elements.forEach(function(e){var o=i.getElementCode(e),r="[name="+o+"]",a=n.find(r);if(void 0!=a)for(var s=0;s<a.length;s++)void 0==t[s]&&(t[s]={}),t[s]["control_"+e.field]=a[s],"table"===e.type||"form"===e.type?t[s][e.field]=i.getEditData({type:e.type,control:$(a[s]),elements:e.elements}):i.SetValueByPropertyName(t[s],e.field,i.getEasyControlValue({type:e.type,control:a[s]}))}),e.keyproperty)for(var o=n.children("tbody").children("tr"),r=0;r<o.length;r++)void 0==t[r]&&(t[r]={}),t[r].keyproperty=$(o[r]).attr("keyproperty")}return t},this.generateTabs=function(e,t){var i=this,n=new Array,o=$('<div class="ui top attached tabular menu" />'),r=!0;e.elements.forEach(function(e){var t=$('<a class="item">'+e.name+"</a>");t.attr("data-tab",e.tabKey),r&&(t.addClass("active"),r=!1),o.append(t)}),n.push(o),r=!0;var a=null;return e.elements.forEach(function(e){var t=$('<div class="ui bottom attached tab segment" />');switch(t.attr("data-tab",e.tabKey),r&&(t.addClass("active"),r=!1),e.type){case"table":a=i.generateTable(e);break;case"form":a=i.generateForm(e);break;case"accordion":a=i.generateAccordion(e);break;default:a=null}t.append(a),n.push(t)}),n},this.generateAccordion=function(e,t){var i,n,o=this,r=$('<div class="ui accordion" />'),a=!0;return $.each(e.data,function(t,s){i=$('<div class="title"><i class="dropdown icon"></i>'+t+"</div>"),a&&i.addClass("active"),r.append(i),n=$('<div class="content" />'),a&&(n.addClass("active"),a=!1),e.elements.forEach(function(e){switch(e.type){case"table":e.data=s,n.append(o.generateTable(e))}}),r.append(n)}),r},this.generateForm=function(e,t){var i=this,n="group"==e.type?$('<div class="fields">'):$('<div class="ui form">');void 0!=e.width&&n.width(e.width),n.attr("name",i.getElementCode(e));var o=new Array;return e.elements.forEach(function(n){var r=$('<div class="field">');void 0!=n.width&&r.width(n.width),void 0==t&&(t="");var a=t+"_"+n.field,s=void 0;if(void 0!=n.name){var l=null==n.parameters||null==n.parameters.Comment?"":" ("+n.parameters.Comment+")";s="table"===n.type?$('<h4 class="ui dividing header"></h4>'):$("<label></label>"),s[0].innerHTML=n.name+l,r.append(s)}if("table"===n.type){n.data||(n.fieldFunc?n.data=n.fieldFunc(e.data):n.data=e.data[n.field]);var d=i.generateTable(n,a);r.append(d)}else if("form"===n.type){n.fieldFunc?n.data=n.fieldFunc(e.data):n.data=e.data[n.field];var d=i.generateForm(n,a);r.append(d)}else if("group"===n.type){n.fieldFunc?n.data=n.fieldFunc(e.data):n.data=e.data;var d=i.generateForm(n,a);r.append(d)}else if("accordion"===n.type){n.data||(n.fieldFunc?n.data=n.fieldFunc(e.data):n.data=e.data[n.field]);var d=i.generateAccordion(n,a);r.append(d)}else if("scheme"===n.type){var c=n.group+"_group",h=$('<div id="'+c+'"></div>'),u=$(window).height()-550;u<400&&(u=400),h.height(u),n.control=h[0],r.append(h[0]),i.refreshFunc=function(){void 0!=i.wfdesigner&&i.wfdesigner.destroy(),i.wfdesigner=new WorkflowDesigner({name:c,renderTo:c,imagefolder:i.parameters.graph.Settings.imagefolder,apiurl:i.parameters.graph.Settings.apiurl,graphwidth:h.width(),graphheight:u,readonly:!0,group:n.group,hideElementsToolbar:!0,hideLegend:!0,hideInfoBlock:!0}),i.wfdesigner.data=i.parameters.graph.data,i.wfdesigner.render()},i.destroyFunc=function(){h.remove(),void 0!=i.wfdesigner&&i.wfdesigner.destroy()}}else{var h=i.generateEasyControls(n,i.GetValueByPropertyName(e.data,n.field),a,n.parameters);void 0!=s&&(s[0].for=h[0].id),n.control=h[0],r.append(h[0])}o.push(r)}),e.control=n,n.append(o),n},this.generateTable=function(e,t){var i=this,n=$('<table class="ui form WorkflowDesignerTable"></table>');n.attr("name",i.getElementCode(e));var o=$("<thead></thead>"),r=$("<tr></tr>");if(!i.isReadOnly()){var a=$('<th class="movecol"></th>');r.append(a)}e.elements.forEach(function(e){if(e.name){var t=$("<th></th>");t[0].innerHTML=e.name,void 0!=e.width&&(t[0].width=e.width),r.append(t)}}),this.isReadOnly()||r.append("<th></th>"),o.append(r),n.append(o);var s=function(o){void 0!=e.beforerowadded&&e.beforerowadded(o,i);var r=$("<tr></tr>");e.keyproperty&&r.attr("keyproperty",o[e.keyproperty]),void 0==t&&(t="");var a=t+WorkflowDesignerCommon.createUUID();if(!i.isReadOnly()){var s=$("<td class='movecol'><div class='btnmove'></div></td>");s.attr("draggable",!0),s.bind("dragstart",function(e){if(null!==e&&void 0!==e&&null!==e.originalEvent&&void 0!==e.originalEvent&&null!==e.originalEvent.dataTransfer&&void 0!==e.originalEvent.dataTransfer)try{e.originalEvent.dataTransfer.setData("text/plain","anything")}catch(e){}r.css("opacity",.5),n.row=r}).bind("dragover",function(e){e.preventDefault()}).bind("drop",function(e){if(e.preventDefault(),void 0!=n.row){var t=n.find("tr");t.index(n.row[0])>t.index(r[0])?n.row.insertBefore(r):n.row.insertAfter(r),n.row.css("opacity",""),n.row=void 0}}),r.append(s)}if(e.elements.forEach(function(t){if("table"===t.type){t.fieldFunc?t.data=t.fieldFunc(o):t.data=o[t.field];var n=i.generateTable(t,a);r.append($("<td></td>").append(n))}else{var s=i.generateEasyControls(t,i.GetValueByPropertyName(o,t.field),a,o);void 0!==e.onrowchanged&&s.change(function(){e.onrowchanged(r,i)}),t.colspan?r.append($("<td colspan="+t.colspan+"></td>").append(s)):r.append($("<td></td>").append(s))}}),!i.isReadOnly()){var l=$('<a class="btnDelete"></a>');l[0].innerHTML=WorkflowDesignerConstants.ButtonTextDelete,l[0].href="#",l.on("click",function(){return!(void 0!==e.onrowdelete&&!e.onrowdelete(r,i))&&(r.remove(),0==$("tr",$(n).find("tbody")).length&&n.css("display","none"),WorkflowDesignerCommon.modal(i.window,"refresh"),!1)}),r.append($("<td></td>").append(l))}n.append(r),void 0!==e.onrowadded&&e.onrowadded(r,i)};void 0!=e.data&&e.data.forEach(function(e){s(e)}),void 0!=e.data&&0!=e.data.length||n.css("display","none"),e.control=n;var l=new Array;if(l.push(n),!this.isReadOnly()){var d=$('<a class="btnAdd"></a>');d[0].innerHTML=WorkflowDesignerConstants.ButtonTextCreate,d[0].href="#",d.on("click",function(){var t={};return e.datadefault&&(t=e.datadefault),"none"==n.css("display")&&0==$("tr",$(n).find("tbody")).length&&n.css("display",""),s(t),WorkflowDesignerCommon.modal(i.window,"refresh"),!1}),l.push(d)}return l},this.generateEasyControls=function(e,i,n,o){var r=null;if("input"===e.type)return new WorkflowDesignerWindows.InputControl(t).generate(e,i,n);if("checkbox"===e.type)return new WorkflowDesignerWindows.CheckboxControl(t).generate(e,i,n);if("select"===e.type)return new WorkflowDesignerWindows.SelectControl(t).generate(e,i,n);if("multiselect"===e.type)return new WorkflowDesignerWindows.MultiSelectControl(t).generate(e,i,n);if("textarea"===e.type)return new WorkflowDesignerWindows.TextAreaControl(t).generate(e,i,n);if("expression"===e.type)return new WorkflowDesignerWindows.ExpressionControl(t,e,n).generate(i);if("json"===e.type)return new WorkflowDesignerWindows.JsonControl(t,e,n).generateBasicControl(i);if("jsonparameter"===e.type)return new WorkflowDesignerWindows.JsonControl(t,e,n).generateParameterControl(i,o);if("code"===e.type)return t.generateCodeControl(e,i,n,o);if("transitionclassifier"===e.type){switch(r=$('<img class="table-icon" />'),i){case 0:r.attr("src",t.parameters.graph.Settings.imagefolder+"wfe.transition.not-specified.png"),r.attr("alt","NotSpecified"),r.attr("title","NotSpecified");break;case 1:r.attr("src",t.parameters.graph.Settings.imagefolder+"wfe.transition.direct.png"),r.attr("alt","Direct"),r.attr("title","Direct");break;case 2:r.attr("src",t.parameters.graph.Settings.imagefolder+"wfe.transition.reverse.png"),r.attr("alt","Reverse"),r.attr("title","Reverse")}return r}return"parameters"===e.type?new WorkflowDesignerWindows.ParametersControl(t).generate(e,i,n):"defaultvalue"===e.type?new WorkflowDesignerWindows.DefaultValueControl(t,e,n).generate(i,o):void 0},this.generateCodeControl=function(e,i,n,o){void 0==i&&(i="");var r=$('<button class="ui button basic">'+WorkflowDesignerConstants.EditCodeLabel.EditCodeButton+"</button>");r[0].id=this.generateid(e.field,n),r[0].name=t.getElementCode(e),r[0].code={},r[0].code.code=decodeURIComponent(i);var a=o.Usings;a=void 0==a?t.parameters.graph.data.AdditionalParams.Usings.join(";")+";":decodeURIComponent(a),r[0].code.usings=a;var s=t.isReadOnly()?' readonly="true"':"",l=$('<div class="ui large modal WorkflowDesignerDialogChild">');l[0].id=r[0].id+"_form",l.append('<div class="header">'+WorkflowDesignerConstants.EditCodeLabel.Title+"</div>");var d=$('<div class="content scrolling"></div>'),c=$('<a class="ui button">'+WorkflowDesignerConstants.EditCodeLabel.ShowUsings+"</a>");d.append(c);var h=$('<div id="'+r[0].id+'_usings" style="padding-top: 6px;display:none"/>');h.append('<textarea style="width:100%;height: 100px; max-width:inherit;" id="'+r[0].id+'_usingsedit"'+s+">asdfasdfasd</textarea>"),d.append(h),d.append('<div id="'+r[0].id+'_function_upper" />'),d.append('<div id="'+r[0].id+'_editor" style="height:'+WorkflowDesignerConstants.EditCodeSettings.CodeHeight+'px" '+s+"></div>"),d.append('<div id="'+r[0].id+'_function_lower">}</div>'),c.on("click",function(e){h.is(":visible")?(h.hide(),c[0].innerText=WorkflowDesignerConstants.EditCodeLabel.ShowUsings):(h.show(),c[0].innerText=WorkflowDesignerConstants.EditCodeLabel.HideUsings),WorkflowDesignerCommon.modal(l,"refresh")}),l.append(d);var u=$('<div class="actions"></div>'),m=$('<div class="ui button">'+WorkflowDesignerConstants.EditCodeLabel.Compile+"</div>");return u.append(m),m.on("click",function(){for(var e=t.getEditData(t.parameters),i=void 0,n=0;n<e.length;n++)if(e[n].control_ActionCode.id==r[0].id){i=e[n];break}if(void 0!=i){i.ActionCode=encodeURIComponent(ace.edit(r[0].id+"_editor").getValue()),i.Usings=encodeURIComponent($("#"+r[0].id+"_usingsedit")[0].value.replace(/(\r\n|\n|\r)/gm,""));var o=function(e){var i=e.Success?WorkflowDesignerConstants.EditCodeLabel.Success:WorkflowDesignerConstants.EditCodeLabel.Error,n=e.Success?WorkflowDesignerConstants.EditCodeLabel.CompileSucceeded:e.Message;return t.InfoDialog(i,n,e.Success?"mini":void 0),!1};t.parameters.graph.designer.compile(i,o)}}),r[0].readOnly?u.append('<div class="ui secondary cancel button">'+WorkflowDesignerConstants.ButtonTextClose+"</div>"):(u.append('<div class="ui primary ok button">'+WorkflowDesignerConstants.ButtonTextSave+"</div>"),u.append('<div class="ui secondary cancel button">'+WorkflowDesignerConstants.ButtonTextCancel+"</div>")),l.append(u),r.on("click",function(e){WorkflowDesignerCommon.modal(l,{closable:!1,allowMultiple:!0,onApprove:function(){r[0].code={},r[0].code.code=ace.edit(r[0].id+"_editor").getValue(),r[0].code.usings=$("#"+r[0].id+"_usingsedit")[0].value.replace(/(\r\n|\n|\r)/gm,"")},onHidden:function(){setTimeout(function(){WorkflowDesignerCommon.modal(t.window,"show"),WorkflowDesignerCommon.modal(t.window,"refresh")},10)},dimmerSettings:{opacity:.2,duration:{show:0,hide:0}},transition:"fade"});var i=ace.edit(r[0].id+"_editor");$("#"+r[0].id+"_usingsedit")[0].value=t.htmlEncode(t.modifyUsingString(r[0].code.usings)),$("#"+r[0].id+"_usings").accordion({collapsible:!0,active:!1,heightStyle:"content scrolling"});var o=$("#"+t.generateid("Type",n)).dropdown("get value").toLowerCase(),a=$("#"+t.generateid("Name",n))[0].value,s=$("#"+t.generateid("IsAsync",n))[0].checked;a=""===a?"???":"<b>"+a+"</b>";var d="{",c=" "+WorkflowDesignerWindows.getVariablesDefinitionStr(o,s)+" {";if("action"===o){d=(s?"async Task ":"void ")+a+c}if("condition"===o){var h=s?"async Task&lt;bool&gt; ":"bool ";d=h+a+c}if("ruleget"===o){d=(s?"async Task&lt;IEnumerable&lt;string&gt;&gt; ":"IEnumerable&lt;string&gt; ")+a+c}if("rulecheck"===o){var h=s?"async Task&lt;bool&gt; ":"bool ";d=h+a+c}$("#"+r[0].id+"_function_upper").html(d);var i=ace.edit(r[0].id+"_editor");i.getSession().setMode("ace/mode/csharp"),i.setValue(r[0].code.code),i.clearSelection(),t.isReadOnly()?i.setOptions({readOnly:!0}):(i.setOptions({readOnly:!1}),i.focus()),
WorkflowDesignerCommon.modal(t.window,"hide"),WorkflowDesignerCommon.modal(l,"show"),WorkflowDesignerWindows.Autocompleter.enableAceEditor({editor:i,getUsingsCallback:function(){return r[0].code.usings},getVariablesCallback:function(){return WorkflowDesignerWindows.getVariablesList(o,s)}})}),r},this.addAutoComplete=function(e,t){if(void 0!=e.datasource){var n;n=Array.isArray(e.datasource)?function(t,n){t=t.toLowerCase();var o=e.datasource,r=[];for(i=0;i<o.length;i++)~o[i].toLowerCase().indexOf(t)&&r.push(o[i]);n(r)}:e.datasource.bind(t);var o={minChars:0,source:n};t.autoComplete(o)}},this.modifyUsingString=function(e){return";"===e.substring(e.length-1)&&(e=e.substring(0,e.length-1)),e.split(";").join(";\r\n")+";"},this.getEasyControlValue=function(e){var t=this;if("input"===e.type)return e.control.value;if("json"===e.type||"jsonparameter"===e.type)return"div"===e.control.localName?$(e.control).find("input").val():e.control.value;if("code"===e.type)return e.control.code;if("parameters"===e.type)return e.control.parameters;if("checkbox"===e.type)return"div"===e.control.localName?e.indeterminable&&$(e.control).checkbox("is indeterminate")?null:e.control.children[0].checked:e.indeterminable&&$(e.control).parent().checkbox("is indeterminate")?null:e.control.checked;if("select"===e.type)return $(e.control).dropdown("get value");if("multiselect"===e.type)return $(e.control).dropdown("get value");if("textarea"===e.type)return e.control.value;if("expression"===e.type)return e.control.value;if("defaultvalue"===e.type){switch(e.control.type){case"textarea":return t.getEasyControlValue({type:"textarea",control:e.control});case"text":return t.getEasyControlValue({type:"input",control:e.control});case"checkbox":return t.getEasyControlValue({type:"checkbox",control:e.control,indeterminable:!0});case"select-one":return t.getEasyControlValue({type:"select",control:e.control});case"select-multiple":return t.getEasyControlValue({type:"multiselect",control:e.control})}return null}},this.generateid=function(e,t){return t?e+"_"+t+"_"+this.id:e+"_"+this.id},this.GetValueByPropertyName=function(e,t){if(void 0!=e){if(t.indexOf(".")<0)return e[t];var i=e;return t.split(".").forEach(function(e){void 0!=i&&(i=i[e])}),i}},this.SetValueByPropertyName=function(e,t,i){if(t.indexOf(".")<0)return e[t]=i;for(var n=e,o=t.split("."),r=0;r<o.length;r++){var a=o[r];r==o.length-1?n[a]=i:(void 0==n[a]&&(n[a]={}),n=n[a])}},this.ClearError=function(){var e=this.window.find(".field-validation-error");e.attr("title",""),e.removeClass("field-validation-error"),this.window.find(".error-message").remove()},this.ControlAddError=function(e,t){var i=$(e);i.addClass("field-validation-error"),i.attr("title",t)},this.CheckRequired=function(e,t,i){var n=this,o=!0;return e.forEach(function(e){t.forEach(function(t){""==n.GetValueByPropertyName(e,t)&&(n.ControlAddError(e["control_"+t],i),o=!1)})}),o},this.CheckUnique=function(e,t,i){for(var n=this,o=!0,r=0;r<e.length;r++)for(var a=r+1;a<e.length;a++)this._checkUniqueEquals(e[r],e[a],t)&&(t.forEach(function(t){n.ControlAddError(e[r]["control_"+t],i),n.ControlAddError(e[a]["control_"+t],i)}),o=!1);return o},this._checkUniqueEquals=function(e,t,i){for(var n=0;n<i.length;n++){var o=i[n];if(e[o]!=t[o])return!1}return!0};var t=this;this.ClearTempField=function(e,i){void 0!=e&&(void 0==i&&(i=this.parameters.elements),i.forEach(function(n){$.isArray(e)?e.forEach(function(e){t.ClearTempField(e,i)}):void 0!=e["control_"+n.field]&&delete e["control_"+n.field],n.elements&&(void 0==n.field?t.ClearTempField(e,n.elements):t.ClearTempField(e[n.field],n.elements))}))},this.getElementCode=function(e){return void 0!=e.code?e.code:e.field},this.getElementName=function(e){return void 0!=e.name?e.name:t.getElementCode(e)},this.htmlEncode=function(e){return $("<div/>").text(e).html()},this.htmlDecode=function(e){return $("<div/>").html(e).text()},this.toCompactJSON=function(e){try{return JSON.stringify(JSON.parse(e))}catch(t){try{return JSON5.stringify(JSON5.parse(e))}catch(t){return e}}},this.toPrettyJSON=function(e){try{return JSON.stringify(JSON.parse(e),null,"\t")}catch(t){try{return JSON5.stringify(JSON5.parse(e),null,"\t")}catch(t){return e}}},this.objAssign=function(e,t){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(e),n=1;n<arguments.length;n++){var o=arguments[n];if(null!=o)for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(i[r]=o[r])}return i}}function WorkflowDesignerTransitionManager(){this.type="WorkflowDesignerTransitionManager",this.init=function(e){var t=this;this.graph=e,this.Layer=new Konva.Layer,this.graph.Stage.add(this.Layer),this.Layer.setZIndex(2),this.graph=e,this.APLayer=new Konva.Layer,this.graph.Stage.add(this.APLayer),this.APLayer.setZIndex(3);var i=function(){t.APLayer.batchDraw(),t.Layer.batchDraw()};this.ImageTimer=WorkflowDesignerCommon.loadImage(this.graph.Settings.imagefolder+"wfe.transition.timer.png",i),this.ImageCondition=WorkflowDesignerCommon.loadImage(this.graph.Settings.imagefolder+"wfe.transition.condition.png",i),this.ImageActor=WorkflowDesignerCommon.loadImage(this.graph.Settings.imagefolder+"wfe.transtion.actor.png",i),this.ImageOtherwise=WorkflowDesignerCommon.loadImage(this.graph.Settings.imagefolder+"wfe.transition.otherwise.png",i)},this.ItemControls=new Array,this.draw=function(){null!=this.ItemControls&&this.ItemControls.forEach(function(e){e.destroy()}),this.ItemControls=new Array;var e=this;void 0!=this.graph.data.Transitions&&this.graph.data.Transitions.forEach(function(t){var i=e.graph.GetComponentByType("WorkflowDesignerActivityManager"),n=i.find(t.From),o=i.find(t.To),r=!1;if(void 0==n&&void 0!=t.From&&t.From.DesignerSettings.Group!=e.graph.Settings.group&&(n=i.findGroup(t.From.DesignerSettings.Group,e.graph.Settings.group),r=!0),void 0==o&&void 0!=t.To&&t.To.DesignerSettings.Group!=e.graph.Settings.group&&(o=i.findGroup(t.To.DesignerSettings.Group,e.graph.Settings.group),r=!0),void 0!=n&&void 0!=o&&(!r||n!=o)){var a=new WorkflowDesignerTransitionControl({from:n,to:o,item:t,graph:e.graph,manager:e,group:r});e.ItemControls.push(a),a.Draw()}}),this.batchDraw()},this.batchDraw=function(){this.CorrectItems(),this.Layer.batchDraw(),this.APLayer.batchDraw()},this.CorrectItems=function(){for(var e=0;e<this.ItemControls.length;e++)for(var t=this.ItemControls[e],i=0;i<this.ItemControls.length;i++)if(e!=i){var n=this.ItemControls[i];t.start.x==n.start.x&&t.start.y==n.start.y&&(n.start.x+=5),t.end.x==n.end.x&&t.end.y==n.end.y&&(n.end.x+=5),t.middle.x==n.middle.x&&t.middle.y==n.middle.y&&(n.middle.x+=15)}},this.getIntersectingActivity=function(e){return this.graph.GetComponentByType("WorkflowDesignerActivityManager").getIntersectingActivity(e)},this.LayerSetOffset=function(e){this.Layer.setOffset(e),this.APLayer.setOffset(e)},this.LayerScale=function(e){var t=(e.scale,e.delta);this.Layer.setScale({x:this.Layer.getScale().x+t,y:this.Layer.getScale().y+t}),this.APLayer.setScale({x:this.APLayer.getScale().x+t,y:this.APLayer.getScale().y+t})},this.LayerScaleNorm=function(){this.Layer.setScale({x:1,y:1}),this.Layer.setOffset({x:0,y:0}),this.APLayer.setScale({x:1,y:1}),this.APLayer.setOffset({x:0,y:0})},this.DeselectAll=function(){this.ItemControls.forEach(function(e){e.Deselect()})},this.SelectAll=function(){this.ItemControls.forEach(function(e){e.Select()})},this.GetSelected=function(){var e=new Array;return this.ItemControls.forEach(function(t){t.selected&&e.push(t)}),e},this.SelectByPosition=function(e){this.ItemControls.forEach(function(t){t.getIntersectingRect(e)&&t.Select()})},this.SelectByItem=function(e){this.ItemControls.forEach(function(t){t.item==e&&t.Select()})},this.CreateNewTransition=function(e,t){var i=this;if(void 0==t){var n=e.control.getX()+e.rectangle.attrs.width,o=e.control.getY()+e.rectangle.attrs.height/2,r={x:n,y:o},a=new WorkflowDesignerTransitionManagerTempControl({x:r.x,y:r.y,manager:this});a.Draw(r.x+10,r.y),this.batchDraw();var s=function(e){var t=i.graph.CorrectPossition({x:e.evt.offsetX,y:e.evt.offsetY},i.Layer);a.Redraw(t),i.Layer.batchDraw()},l=function(t){var n={x:t.evt.offsetX,y:t.evt.offsetY},o=i.getIntersectingActivity(n);void 0!=o&&i.CreateNewTransition(e,o),a.Delete(),i.graph.Stage.off("mousemove.WorkflowDesignerTransitionManagerTempControl",s),i.graph.Stage.off("mouseup.WorkflowDesignerTransitionManagerTempControl",l),i.batchDraw(),i.graph.StoreGraphData()};return this.graph.Stage.on("mousemove.WorkflowDesignerTransitionManagerTempControl",s),this.graph.Stage.on("mouseup.WorkflowDesignerTransitionManagerTempControl",l),a}var d={Name:this.GetDefaultName(e.GetName(),t.GetName()),From:e.item,To:t.item,Trigger:{Type:"Auto"},Conditions:[{Type:"Always"}],AllowConcatenationType:"And",RestrictConcatenationType:"And",ConditionsConcatenationType:"And",Classifier:"NotSpecified",DesignerSettings:{}},c=new WorkflowDesignerTransitionControl({from:e,to:t,item:d,graph:i.graph,manager:i});return i.ItemControls.push(c),i.graph.data.Transitions.push(d),c.Draw(),c},this.GetDefaultName=function(e,t){for(var i=e+"_"+t+"_",n=1,o=0;o<this.graph.data.Transitions.length;o++){this.graph.data.Transitions[o].Name==i+n&&(n++,o=-1)}return i+n}}function WorkflowDesignerActivityControl(e){var t=this;this.manager=e.manager,this.graph=e.graph,this.x=e.x,this.y=e.y,this.group=e.group,this.item=e.item,this.control=void 0,this.rectangle=void 0,this.text=void 0,this.createTransitionAndActivityButton=void 0,this.createTransitionButton=void 0,this.selected=!1,this.dependentTransitions=new Array,this.getX=function(){return this.rectangle.attrs.x+this.control.attrs.x},this.getY=function(){return this.rectangle.attrs.y+this.control.attrs.y},this.GetName=function(){return this.group&&null!==this.item.FirstTimeInlineName&&void 0!==this.item.FirstTimeInlineName?this.item.FirstTimeInlineName:this.item.Name},this.SetName=function(e){this.item.Name=e},this.Draw=function(){var i=t.graph.Settings,n=!t.graph.Settings.disableobjectmovements;if(void 0==this.graph.Settings.drawElements||void 0==this.graph.Settings.drawElements.activity||this.graph.Settings.drawElements.activity(this)===!1){t.control=new Konva.Group({x:e.x,y:e.y,rotation:0,draggable:n,dragBoundFunc:function(e){var n=(i.DefaultMoveStep*t.manager.Layer.getScaleX(),i.DefaultMoveStep*t.manager.Layer.getScaleY()),e={x:Math.round(e.x/n)*n,y:Math.round(e.y/n)*n};if(t.selected){var o=this.getAbsolutePosition();t.manager.ObjectMove({sender:t,changepos:{x:e.x-o.x,y:e.y-o.y}})}return e}});var o=WorkflowDesignerConstants.ActivityColor,r=WorkflowDesignerConstants.ActivityTextColor;t.item.IsFinal&&(o=WorkflowDesignerConstants.ActivityFinalColor,r=WorkflowDesignerConstants.ActivityFinalTextColor,!1),t.item.IsInitial&&(o=WorkflowDesignerConstants.ActivityInitialColor,r=WorkflowDesignerConstants.ActivityInitialTextColor,!1);(this.group?t.graph.IsGroupActive(t.item.DesignerSettings.Group):t.graph.GetCurrentActivity()==t.item.Name)&&(o=WorkflowDesignerConstants.SelectColor,r=WorkflowDesignerConstants.SelectTextColor,!1),t.graph.isCurrentActivityForSubprocess(t.item.Name)&&(o=WorkflowDesignerConstants.SelectSubProcessColor,r=WorkflowDesignerConstants.SelectSubProcessTextColor,!1);var a="Inline"===this.item.ActivityType||this.group;t.rectangle=new Konva.Rect({x:0,y:0,width:this.graph.Settings.DefaultActivityWidth,height:this.graph.Settings.DefaultActivityHeight,fill:o,cornerRadius:5,dash:a?[8,4]:void 0,stroke:a?WorkflowDesignerConstants.ActivityShape:void 0,strokeWidth:a?4:0}),t.control.add(t.rectangle),this.group||(Array.isArray(t.item.Implementation)&&t.item.Implementation.length>0&&t.control.add(new Konva.Text({x:t.rectangle.attrs.width-20,y:38,text:"E",fontSize:12,fontFamily:"Arial",fill:r,fontStyle:"bold"})),Array.isArray(t.item.PreExecutionImplementation)&&t.item.PreExecutionImplementation.length>0&&t.control.add(new Konva.Text({x:t.rectangle.attrs.width-30,y:38,text:"P",fontSize:12,fontFamily:"Arial",fill:r,fontStyle:"bold"}))),t.text=new Konva.Text({x:10,y:10,text:this.GetName(),fontSize:12,fontFamily:"Arial",fontStyle:"bold",fill:r}),void 0==t.item.State&&(t.item.State="");var s=this.group?t.item.OriginalSchemeCode:t.item.State;a&&(t.control.add(new Konva.Text({x:t.rectangle.attrs.width-20,y:10,text:"I",fontSize:12,fontFamily:"Arial",fill:r,fontStyle:"bold"})),void 0!=t.item.SchemeCode&&(s=t.item.SchemeCode)),t.stateText=new Konva.Text({x:10,y:25,text:s,fontSize:12,fontFamily:"Arial",fill:r}),t.control.add(t.text),t.control.add(t.stateText);var l="";1==t.item.IsInitial&&(l.length>0&&(l+=" "),l+=WorkflowDesignerConstants.ActivityFormLabel.IsInitial),1==t.item.IsFinal&&(l.length>0&&(l+=" "),l+=WorkflowDesignerConstants.ActivityFormLabel.IsFinal),1==t.graph.getParam("exinfo")&&(t.createExInfo(t.control),1==t.item.IsForSetState&&(l.length>0&&(l+=" - "),l+=WorkflowDesignerConstants.ActivityFormLabel.IsForSetState)),""!=l&&(t.typeText=new Konva.Text({x:10,y:40,text:l,fontSize:12,fontFamily:"Arial",fill:r}),t.control.add(t.typeText)),t.graph.Settings.disableobjectmovements||(this.control.on("dragend",this.Sync),this.control.on("dragmove",this._onMove),this.control.on("click",this._onClick),this.control.on("touchend",this._onClick)),this.control.on("dblclick",this._onDblClick);var d=t.graph.Settings.imagefolder,c=[];if(t.graph.Settings.notshowwindows||c.push({img:d+"wfe.settings.png",click:function(){t.ShowProperties()}}),t.graph.Settings.readonly||t.group||(c.push({img:d+"wfe.transition.png",click:function(){t._onCreateTransition()}}),c.push({img:d+"wfe.activity.png",click:function(){t._onCreateTransitionAndActivity()}}),c.push({img:d+"wfe.clone.png",click:function(){t.manager.Clone(t)}}),c.push({img:d+"wfe.delete.png",click:function(){t._onDelete()}})),c.length>0){var h={x:t.rectangle.getWidth()-30*c.length,y:-40};t.bar=WorkflowDesignerBar(t.manager.Layer,c,h),t.control.add(t.bar),t.bar.hide()}t.manager.Layer.add(t.control)}},this.Delete=function(){this.control.destroy(),this.graph.data.Activities.splice(this.graph.data.Activities.indexOf(this.item),1),this.manager.ItemControls.splice(this.manager.ItemControls.indexOf(this),1);for(var e=new Array,t=0;t<this.dependentTransitions.length;t++)e.push(this.dependentTransitions[t]);for(var t=0;t<e.length;t++)e[t].Delete()},this.Select=function(){if(!this.selected){var e=this;this.rectangle.setStrokeWidth(4),this.rectangle.setStroke(WorkflowDesignerConstants.SelectColor),void 0!=e.bar&&e.bar.show(),this.selected=!0}},this.Deselect=function(){if(this.selected){var e="Inline"===this.item.ActivityType||this.group;this.rectangle.setStrokeWidth(e?4:0),this.rectangle.setStroke(e?WorkflowDesignerConstants.ActivityShape:this.rectangle.fill()),void 0!=t.bar&&t.bar.hide(),this.selected=!1}},this.ObjectMove=function(e){var i=this.control.getAbsolutePosition();if(i.x+=e.x,i.y+=e.y,this.control.setAbsolutePosition(i),this.Sync(),!(t.dependentTransitions.length<1))for(var n=0;n<t.dependentTransitions.length;n++){var o=t.dependentTransitions[n];o.middle=void 0,o.item.DesignerSettings={},o.Draw()}},this._onMove=function(){if(!(t.dependentTransitions.length<1)){var e=!1;if(void 0==t.oldpos)t.oldpos=t.control.getPosition();else{var i=t.control.getPosition();(Math.abs(i.x-t.oldpos.x)>20||Math.abs(i.y-t.oldpos.y)>20)&&(e=!0)}for(var n=0;n<t.dependentTransitions.length;n++){var o=t.dependentTransitions[n];e&&(o.middle=void 0,o.item.DesignerSettings={}),o.Draw()}t.manager.redrawTransitions()}},this._onClick=function(e){var i=t.selected;e.evt.ctrlKey||t.graph.DeselectAll(),i?t.Deselect():t.Select(),t.graph.onSelectionChanged(!i),t.manager.batchDraw()},this._onDblClick=function(){t.graph.DeselectAll(),t.Select(),t.manager.batchDraw(),t.graph.Settings.notshowwindows||t.ShowProperties()},this._onDelete=function(){var e=this;e.graph.confirm(WorkflowDesignerConstants.DeleteConfirmCurrent,function(){e.Delete(),e.graph.onSelectionChanged(),e.graph.redrawAll(),e.graph.StoreGraphData()})},this._onCreateTransitionAndActivity=function(){t.manager.createTransitionAndActivity(t),t.graph.StoreGraphData()},this._onCreateTransition=function(){t.manager.createTransition(t)},this.RegisterTransition=function(e){for(var t=!1,i=0;i<this.dependentTransitions.length;i++)if(this.dependentTransitions[i].GetName()==e.GetName()){t=!0;break}t||this.dependentTransitions.push(e)},this.UnregisterTransition=function(e){for(var t=new Array,i=0;i<this.dependentTransitions.length;i++)this.dependentTransitions[i].GetName()!=e.GetName()&&t.push(this.dependentTransitions[i]);this.dependentTransitions=t},this.RegisterTransition=function(e){for(var t=!1,i=0;i<this.dependentTransitions.length;i++)if(this.dependentTransitions[i].GetName()==e.GetName()){t=!0;break}t||this.dependentTransitions.push(e)},this.UnregisterTransition=function(e){for(var t=new Array,i=0;i<this.dependentTransitions.length;i++)this.dependentTransitions[i].GetName()!=e.GetName()&&t.push(this.dependentTransitions[i]);this.dependentTransitions=t},this.getRectPos=function(){var e=this.rectangle.getAbsolutePosition(),t=e.x,i=e.y;return{xl:t,yl:i,xr:t+this.rectangle.getWidth()*this.manager.Layer.getScaleX(),yr:i+this.rectangle.getHeight()*this.manager.Layer.getScaleY()}},this.getIntersectingActivity=function(e){var t=this.getRectPos();return e.x>=t.xl&&e.x<t.xr&&e.y>=t.yl&&e.y<t.yr},this.getIntersectingActivityRect=function(e){var t=this.getRectPos();return!(e.xl>t.xr||e.xr<t.xl||e.yl>t.yr||e.yr<t.yl)},this.ShowInlineProperties=function(){var e=WorkflowDesignerConstants.ActivityFormLabel,i=t.graph.data.AdditionalParams.InlinedSchemeCodes,n={type:"form",title:e.TitleForInline,width:"800px",data:this.item,elements:[{name:e.Name,field:"Name",type:"input"},{name:e.Scheme,field:"SchemeCode",type:"select",datasource:i,width:"100%"}],graph:t.graph,readonly:t.graph.Settings.readonly,saveFunc:function(e){t.item.Name=e.Name,t.item.SchemeCode=e.SchemeCode,WorkflowDesignerCommon.DataCorrection(t.graph.data),t.graph.Draw(t.graph.data),t.graph.StoreGraphData()}};if(void 0!=this.graph.Settings.forms&&void 0!=this.graph.Settings.forms.activity)this.graph.Settings.forms.activity(n);else{var o=new WorkflowDesignerForm(n),r=function(e,i){var n=!0;return n&=e.CheckRequired([i],["Name","Scheme"],WorkflowDesignerConstants.FieldIsRequired),t.graph.data.Activities.forEach(function(o){o!=t.item&&o.Name==i.Name&&(n=!1,e.ControlAddError(i.control_Name,WorkflowDesignerConstants.FieldMustBeUnique))}),n},a=function(e){return!!r(o,e)&&(o.ClearTempField(e),o.parameters.saveFunc(e),!0)};o.showModal(a)}},this.ShowProperties=function(){var e;if(this.group)return void this.ShowGroup();if("Inline"===this.item.ActivityType)return void this.ShowInlineProperties();var i=WorkflowDesignerConstants.ActivityFormLabel,n=[{name:i.ImpAction,code:"impAction",field:"ActionName",type:"select",datasource:t.graph.getActionNames(),onchange:function(e){var t=$(e),i=t.closest("tr").find("[name=impparam]").closest("td"),n=i.children(),o=n[0].rebuild($(e).dropdown("get value"),n.find("input").val());n.remove(),i.append(o)}},{name:i.ImpActionParameter,code:"impparam",field:"ActionParameter",type:"jsonparameter",graph:t.graph,parametertype:"Action",openautocompleteonclick:!0,datasource:function(e,i){var n=$(this).closest("tr"),o=n.find("[name=impAction]")[0].value;i(t.graph.getAutoCompleteSuggestions("actionparameter",o,e))}}],o={type:"form",title:i.Title,data:this.item,elements:[{type:"group",elements:[{name:i.Name,field:"Name",type:"input",width:"100%"},{name:i.State,field:"State",type:"input",width:"100%"}]},{type:"group",elements:[{name:i.IsInitial,field:"IsInitial",type:"checkbox"},{name:i.IsFinal,field:"IsFinal",type:"checkbox"},{name:i.IsForSetState,field:"IsForSetState",type:"checkbox"},{name:i.IsAutoSchemeUpdate,field:"IsAutoSchemeUpdate",type:"checkbox"}]},{name:i.Implementation,field:"Implementation",type:"table",elements:n},{name:i.PreExecutionImplementation,field:"PreExecutionImplementation",type:"table",elements:n},{name:i.Annotations,type:"table",field:"Annotations",keyproperty:"Name",elements:[{name:i.AnnotationName,field:"Name",type:"input"},{name:i.AnnotationValue,field:"JsonValue",type:"json"}]}],graph:t.graph,readonly:t.graph.Settings.readonly,saveFunc:function(e){if(Array.isArray(e.Implementation)){var i=1;e.Implementation.forEach(function(e){e.Order=i,i++})}if(Array.isArray(e.PreExecutionImplementation)){var i=1;e.PreExecutionImplementation.forEach(function(e){e.Order=i,i++})}t.item.Name=e.Name,t.item.State=e.State,t.item.IsInitial=e.IsInitial,t.item.IsFinal=e.IsFinal,t.item.IsForSetState=e.IsForSetState,t.item.IsAutoSchemeUpdate=e.IsAutoSchemeUpdate,t.item.Implementation=e.Implementation,t.item.PreExecutionImplementation=e.PreExecutionImplementation,t.item.Annotations=e.Annotations,WorkflowDesignerCommon.DataCorrection(t.graph.data),t.graph.Draw(t.graph.data),t.graph.StoreGraphData()}};if(void 0!=this.graph.Settings.forms&&void 0!=this.graph.Settings.forms.activity)this.graph.Settings.forms.activity(o);else{e=new WorkflowDesignerForm(o);var r=function(e,i){var n=!0;return n&=e.CheckRequired([i],["Name"],WorkflowDesignerConstants.FieldIsRequired),t.graph.data.Activities.forEach(function(o){o!=t.item&&o.Name==i.Name&&(n=!1,e.ControlAddError(i.control_Name,WorkflowDesignerConstants.FieldMustBeUnique))}),e.CheckRequired(i.Implementation,["ActionName","Order"],WorkflowDesignerConstants.FieldIsRequired)||(n=!1),e.CheckRequired(i.PreExecutionImplementation,["ActionName","Order"],WorkflowDesignerConstants.FieldIsRequired)||(n=!1),e.CheckRequired(i.Annotations,["Name"],WorkflowDesignerConstants.FieldIsRequired)||(n=!1),e.CheckUnique(i.Annotations,["Name"],WorkflowDesignerConstants.FieldMustBeUnique)||(n=!1),i.Annotations.forEach(function(o){o!=t.item&&o.Name==i.Name&&(n=!1,e.ControlAddError(i.control_Name,WorkflowDesignerConstants.FieldMustBeUnique))}),n},a=function(t){return!!r(e,t)&&(e.ClearTempField(t),e.parameters.saveFunc(t),!0)};e.showModal(a)}},this.ShowGroup=function(){new WorkflowDesignerForm({type:"form",title:this.GetName(),data:this.manager.graph.data,elements:[{type:"scheme",group:this.item.DesignerSettings.Group}],graph:t.graph,readonly:!0}).showModal()},this.Sync=function(){if(t.group){void 0==t.item.DesignerSettings.InlineElementSettings&&(t.item.DesignerSettings.InlineElementSettings={});var e=t.control.getPosition();t.item.DesignerSettings.InlineElementSettings.X=e.x,t.item.DesignerSettings.InlineElementSettings.Y=e.y}else{void 0==t.item.DesignerSettings&&(t.item.DesignerSettings={});var e=t.control.getPosition();t.item.DesignerSettings.X=e.x,t.item.DesignerSettings.Y=e.y}t.oldpos=void 0},this.createExInfo=function(e){var i="";Array.isArray(t.item.Implementation)&&t.item.Implementation.length>0&&t.item.Implementation.forEach(function(e){i.length>0&&(i+=", "),i+=e.ActionName});var n="";if(Array.isArray(t.item.PreExecutionImplementation)&&t.item.PreExecutionImplementation.length>0&&(t.item.PreExecutionImplementation.forEach(function(e){n.length>0&&(n+=", "),n+=e.ActionName}),""==i&&(i=WorkflowDesignerConstants.None)),i.length>0){var o=new Konva.Text({x:10,y:this.graph.Settings.DefaultActivityHeight+5,text:i,fontFamily:"Arial",fontSize:12,fill:"#4A4A4A",fontStyle:"bold"});if(e.add(o),n.length>0){var r=new Konva.Text({x:10,y:this.graph.Settings.DefaultActivityHeight+o.getHeight()+5,text:n,fontFamily:"Arial",fontSize:12,fill:"#4A4A4A",fontStyle:"italic"});e.add(r)}}},this.destroy=function(){this.control.destroy()}}function WorkflowGraph(e,t,i,n){var o=this;o.container=e,o.designer=t,o.suggestionsCache=new Object,o.parametersCache=new Object,void 0==i&&(i=new Object),void 0==i.Container&&(i.Container="container"),void 0==i.graphwidth&&(i.graphwidth=1024),void 0==i.graphheight&&(i.graphheight=768),void 0==i.DefaultActivityWidth&&(i.DefaultActivityWidth=200),void 0==i.DefaultActivityHeight&&(i.DefaultActivityHeight=60),void 0==i.DefaultMoveStep&&(i.DefaultMoveStep=10),void 0==i.imagefolder&&(i.imagefolder="/images/"),this.Settings=i,this.Settings.ContainerStage=this.container+"_stage",$("#"+this.container).append("<div id='"+this.Settings.ContainerStage+"' class='workflowenginecontainerstage'></div>"),this.Stage=new Konva.Stage({container:this.Settings.ContainerStage,width:parseInt(this.Settings.graphwidth),height:parseInt(this.Settings.graphheight)}),this.getParam=function(e){var t=this.designer.getParam(e);return"true"===t||"false"!==t&&t},this.setParam=function(e,t){this.designer.setParam(e,t)},this.Components=new Array,this.AddComponent=function(e){var t=new e;return t.init(this),o.Components.push(t),t},this.GetComponentByType=function(e){for(var t=0;t<this.Components.length;t++)if(this.Components[t].type==e)return this.Components[t]},this.ComponentsExecute=function(e,t){o.Components.forEach(function(i){i[e]&&i[e](t)})},n&&n.forEach(function(e){o.AddComponent(e)}),this.Draw=function(e){o.data=e,0==o.graphData.length&&o.StoreGraphData(),o.onSelectionChanged(),o.ComponentsExecute("draw")},this.GraphLayerSetOffset=function(e,t){o.ComponentsExecute("LayerSetOffset",{x:e,y:t}),o.redrawAll()},this.GraphLayerScale=function(e,t){void 0==o._bg&&(o._bg=o.GetComponentByType("WorkflowDesignerBackground"));var i=o._bg.BackgroundLayer.getScale(),n=i.x+e;n>.3&&n<2&&(o.ComponentsExecute("LayerScale",{scale:i.x,delta:e}),void 0!=t&&o.ComponentsExecute("setPosition",t),o.redrawAll())},this.GraphLayerScaleNorm=function(){o.ComponentsExecute("LayerScaleNorm",1),o.redrawAll()},this.GraphUpdatePosition=function(e){void 0==o._bg&&(o._bg=o.GetComponentByType("WorkflowDesignerBackground")),o._bg.updatePosition(e),o.redrawAll()},this.Refresh=function(){o.designer.refresh()},this.onFullScreenClick=function(){void 0!==this.data.__loadParams&&this.data.__loadParams.isFullScreen?(this.setFullScreen(!1),this.data.__loadParams.isFullScreen=!1):(this.setFullScreen(!0),void 0===this.data.__loadParams&&(this.data.__loadParams={}),this.data.__loadParams.isFullScreen=!0),this.redrawAll()},this.setFullScreen=function(e){var t=$("#"+this.container);void 0==this._toolbar&&(this._toolbar=this.GetComponentByType("WorkflowDesignerToolbar"));var i=this._toolbar;if(e){this.originalContainerStyle=t.attr("style"),void 0==this.originalContainerStyle&&(this.originalContainerStyle=""),this.originalWidth=this.Stage.width(),this.originalHeight=this.Stage.height();var n=$(window).width()-2,o=$(window).height()-2;this.Stage.hide(),this.Stage.width(n),this.Stage.height(o),void 0!=i&&(i.setItemActive("fullscreen",!0),i.changeSize(n,o)),t.css({position:"absolute",top:0,left:0,width:n,height:o,"z-index":1e3,background:"white"}),this.Stage.show()}else void 0!=this.originalContainerStyle&&void 0!=this.originalWidth&&void 0!=this.originalHeight&&(this.Stage.hide(),t.attr("style",this.originalContainerStyle),this.Stage.width(this.originalWidth),this.Stage.height(this.originalHeight),void 0!=i&&(i.setItemActive("fullscreen",!1),i.changeSize(this.originalWidth,this.originalHeight)),this.Stage.show())},this.DeselectAll=function(){o.ComponentsExecute("DeselectAll"),o.onSelectionChanged(!1),o.redrawAll()},this.SelectAll=function(){o.ComponentsExecute("SelectAll"),o.onSelectionChanged(!1),o.redrawAll()},this.redrawAll=function(){void 0==this._toolbal&&(this._toolbal=o.GetComponentByType("WorkflowDesignerToolbar")),void 0!=this._toolbal&&this._toolbal.draw(),o.Stage.batchDraw()},this.CorrectPossition=function(e,t){return 0==t.getScaleX()||0==t.getScaleY()?{x:t.getOffsetX(),y:0}:{x:e.x/t.getScaleX()+t.getOffsetX(),y:e.y/t.getScaleY()+t.getOffsetY()}},this.DeleteSelected=function(){var e=this,t=new Array;this.Components.forEach(function(e){e.GetSelected&&(t=t.concat(e.GetSelected()))}),t.length>0&&e.confirm(WorkflowDesignerConstants.DeleteConfirm,function(){t.forEach(function(e){e.Delete()}),e.onSelectionChanged(!1),e.StoreGraphData(),e.redrawAll()})},this.confirm=function(e,t){var i=$('<div class="ui mini modal WorkflowDesignerConfirmDialog"></div>');i.append($('<div class="content"><p>'+e+"</p></div>"));var n=$('<div class="actions"></div>').append('<div class="ui primary ok button">'+WorkflowDesignerConstants.ButtonTextYes+"</div>").append('<div class="ui secondary  cancel button">'+WorkflowDesignerConstants.ButtonTextCancel+"</div>");i.append(n),WorkflowDesignerCommon.modal(i,{onApprove:function(){t()}}),WorkflowDesignerCommon.modal(i,"show"),WorkflowDesignerCommon.modal(i,"refresh")},this.destroy=function(){if(void 0!=this.originalContainerStyle){$("#"+this.container).attr("style",this.originalContainerStyle)}void 0!=this.data&&(void 0==this.data.__loadParams&&(this.data.__loadParams={}),this.data.__loadParams.graphData=this.graphData,this.data.__loadParams.graphDataIndex=this.graphDataIndex),this.Stage.destroy(),this.ComponentsExecute("destroy")},this.GetCurrentActivity=function(){if(void 0!=o.data&&void 0!=o.data.AdditionalParams&&void 0!=o.data.AdditionalParams.ProcessParameters)for(var e=0;e<o.data.AdditionalParams.ProcessParameters.length;e++){var t=o.data.AdditionalParams.ProcessParameters[e];if("CurrentActivity"===t.Name)return t.Value}},this.isCurrentActivityForSubprocess=function(e){if(void 0==o.data||void 0==o.data.AdditionalParams||!Array.isArray(o.data.AdditionalParams.SubprocessCurrentActivities))return!1;for(var t=0;t<o.data.AdditionalParams.SubprocessCurrentActivities.length;t++)if(e===o.data.AdditionalParams.SubprocessCurrentActivities[t])return!0;return!1},this.IsGroupActive=function(e){var t=this.GetCurrentActivity();if(void 0==t)return!1;for(var i=0;i<o.data.Activities.length;i++){var n=o.data.Activities[i];if(t===n.Name)return o.CheckActive(n,e)}return!1},this.CheckActive=function(e,t){var i=this,n=e.DesignerSettings.Group;if(n===t)return!0;var o=null;if(void 0!==e.DesignerSettings.InlineElementSettings&&null!==e.DesignerSettings.InlineElementSettings&&void 0!==e.DesignerSettings.InlineElementSettings.Group&&null!==e.DesignerSettings.InlineElementSettings.Group)o=e;else for(var r=0;r<i.data.Activities.length;r++){var a=i.data.Activities[r];if(a.DesignerSettings.Group===n&&void 0!==a.DesignerSettings.InlineElementSettings&&null!==a.DesignerSettings.InlineElementSettings&&void 0!==a.DesignerSettings.InlineElementSettings.Group&&null!==a.DesignerSettings.InlineElementSettings.Group){o=a;break}}if(null===o)return!1;var s=o.DesignerSettings.InlineElementSettings.Group;if(s===t)return!0;for(var l=null,r=0;r<i.data.Activities.length;r++){var d=i.data.Activities[r];if(void 0!==d.DesignerSettings.InlineElementSettings&&null!==d.DesignerSettings.InlineElementSettings&&d.DesignerSettings.Group===s){l=d;break}}return null!==l&&i.CheckActive(l,t)},this.getActionParameterDefinition=function(e,t){for(var i=0;i<o.data.CodeActions.length;i++){var n=o.data.CodeActions[i];if(n.Type===t&&n.Name===e){if(n.ParameterDefinitions&&n.ParameterDefinitions.length>0)return n.ParameterDefinitions;break}}return o.getCodeactionParameter(t,e)},this.getActionNames=function(){for(var e=this,t=new Array,i=0;i<e.data.CodeActions.length;i++){var n=e.data.CodeActions[i];"action"===n.Type.toLowerCase()&&t.push(n.Name)}return e.data.AdditionalParams.Actions.concat(t)},this.getConditionNames=function(){for(var e=this,t=new Array,i=0;i<e.data.CodeActions.length;i++){var n=e.data.CodeActions[i];"condition"===n.Type.toLowerCase()&&t.push(n.Name)}return e.data.AdditionalParams.Conditions.concat(t)},this.getActorNames=function(){for(var e=this,t=new Array,i=0;i<e.data.CodeActions.length;i++){var n=e.data.CodeActions[i];"ruleget"!==n.Type.toLowerCase()&&"rulecheck"!==n.Type.toLowerCase()||t.push(n.Name)}return e.unique(e.data.AdditionalParams.Rules.concat(t))},this.getTypeNames=function(){for(var e=this,t=new Array,i=0;i<e.data.Parameters.length;i++){var n=e.data.Parameters[i];t.push(decodeURIComponent(n.Type))}return e.unique(e.data.AdditionalParams.Types.concat(t))},this.getCodeactionParameter=function(e,t){var i=this,n=null;return void 0!==this.parametersCache[e]&&void 0!==this.parametersCache[e][t]?n=this.parametersCache[e][t]:(void 0===this.parametersCache[e]&&(this.parametersCache[e]=new Object),
n=this.designer.requestcodeactionparameter(i.data.Name,e,t),this.parametersCache[e][t]=n),n},this.getAutoCompleteSuggestions=function(e,t,i){var n,o=this;return void 0===t||""===t?new Array:(void 0!=this.suggestionsCache[e]&&void 0!=this.suggestionsCache[e][t]?n=this.suggestionsCache[e][t]:(void 0==this.suggestionsCache[e]&&(this.suggestionsCache[e]=new Object),n=this.designer.requestautocompletesuggestions(o.data.Name,e,t),this.suggestionsCache[e][t]=n),$.grep(n,function(e){return e.toLowerCase().indexOf(i.toLowerCase())>=0}))},this.getNonSystemParameters=function(){for(var e=this,t=new Array,i=0;i<e.data.Parameters.length;i++){var n=e.data.Parameters[i];"system"!=n.Purpose.toLowerCase()&&t.push(n)}return t},this.unique=function(e){return $.grep(e,function(t,i){return i===$.inArray(t,e)})},this.setInlinedFlag=function(e){this.data.CanBeInlined=e,o.StoreGraphData()},this.graphData=[],this.graphDataIndex=-1,this.StoreGraphData=function(){var e=void 0;void 0!=this.data.__loadParams&&(e=this.data.__loadParams.graphData,this.data.__loadParams.graphData=void 0);var t=JSON.stringify(this.data);if(void 0!=e&&(this.data.__loadParams.graphData=e),this.graphDataIndex<0||this.graphData[this.graphDataIndex]!=t){this.graphDataIndex++,this.graphData.length>this.graphDataIndex&&this.graphData.splice(this.graphDataIndex,this.graphData.length-this.graphDataIndex),this.graphData.push(t);var i=200;void 0!=WorkflowDesignerConstants.UndoDepth&&(i=WorkflowDesignerConstants.UndoDepth),this.graphData.length>i&&(this.graphData.splice(0,1),this.graphDataIndex--)}this.сheckToolbarButtonState()},this.ClearGraphData=function(){this.graphData=[],this.graphDataIndex=-1},this.Undo=function(){this.graphDataIndex>0&&this.changeGraphDataIndex(this.graphDataIndex-1)},this.Redo=function(){this.graphData.length>this.graphDataIndex&&this.changeGraphDataIndex(this.graphDataIndex+1)},this.changeGraphDataIndex=function(e){if(this.graphData.length>e){var t=JSON.parse(this.graphData[e]);WorkflowDesignerCommon.DataCorrection(t),this.designer.data=t,this.Draw(t),this.graphDataIndex=e}this.сheckToolbarButtonState()},this.сheckToolbarButtonState=function(){void 0==this._toolbal&&(this._toolbal=o.GetComponentByType("WorkflowDesignerToolbar"));var e=this._toolbal;void 0!=e&&(e.setItemDisabled("undo",this.graphDataIndex<=0),e.setItemDisabled("redo",this.graphData.length<=this.graphDataIndex+1),e.onChangeScheme(),e.Layer.batchDraw())},this.onSelectionChanged=function(e){void 0==this._toolbal&&(this._toolbal=o.GetComponentByType("WorkflowDesignerToolbar"));var t=this._toolbal;if(void 0!=t){var i;if(void 0==e){var n=o.GetComponentByType("WorkflowDesignerActivityManager"),r=o.GetComponentByType("WorkflowDesignerTransitionManager"),a=n.GetSelected(),s=r.GetSelected();i=a.length>0||s.length>0}else i=e;t.setItemDisabled("copy",!i),t.setItemDisabled("delete",!i)}}}function WorkflowDesignerTransitionControl(e){var t=this;this.manager=e.manager,this.graph=e.graph,this.from=e.from,this.to=e.to,this.item=e.item,this.group=e.group,this.setFrom=function(e){this.from=e,this.item.From=e.item},this.setTo=function(e){this.to=e,this.item.To=e.item},this.GetName=function(){return this.item.Name},this.SetName=function(e){this.item.Name=e},this.control=void 0,this.arrow=void 0,this.line=void 0,void 0!=this.item.DesignerSettings&&void 0!=this.item.DesignerSettings.X&&void 0!=this.item.DesignerSettings.Y&&(this.middle={x:Number(this.item.DesignerSettings.X),y:Number(this.item.DesignerSettings.Y)}),this.from.RegisterTransition(this),this.to.RegisterTransition(this),this.start=void 0,this.end=void 0,this.angle=void 0,this.activePoint=void 0,this.touchpoints=[],this.DrawTransition=function(e,t){var i,n,o,r,a=this,s=this.from.rectangle,l=this.to.rectangle;i=Number(this.from.getX()),n=Number(this.from.getY()),o=Number(this.to.getX()),r=Number(this.to.getY());var d=Number(s.attrs.width/2),c=Number(s.attrs.height/2),h=Number(l.attrs.width/2),u=Number(l.attrs.height/2),m=i+d,g=n+c,f=o+h,p=r+u;if(this.direction={start:0,end:0},this.from==this.to)this.start={x:m+d,y:g-c+14},this.end={x:f+h-25,y:p-u},this.direction.end=1,void 0==this.middle&&(this.middle={x:m+d+c,y:g-2*c});else{var v=!1;void 0==this.middle&&(v=!0,this.middle={x:(m+f)/2,y:(g+p)/2});var y=m,w=g,b=f,C=p;if(g-c-25>this.middle.y&&p-u-25>this.middle.y?(w=g-c,C=p-u,this.direction.start=1,this.direction.end=1):g+c+25<this.middle.y&&p+u+25<this.middle.y?(w=g+c,C=p+u,this.direction.start=1,this.direction.end=1):m-d-25>this.middle.x&&f-h-25>this.middle.x?(y=m-d,b=f-h):m+d+25<this.middle.x&&f+h+25<this.middle.x?(y=m+d,b=f+h):(m+d+25<this.middle.x?y+=d:m-d-25>this.middle.x?y-=d:g+c+25<this.middle.y?(w+=c,this.direction.start=1):g-c-25>this.middle.y?(w-=c,this.direction.start=1):y<=this.middle.x?y+=d:y-=d,f+h+25<this.middle.x?b+=h:f-h-25>this.middle.x?b-=h:p+u+25<this.middle.y?(C+=u,this.direction.end=1):p-u-25>this.middle.y?(C-=u,this.direction.end=1):(w>=this.middle.y?C+=u:C-=u,this.direction.end=1)),void 0!=e&&(y=e.x,w=e.y,v=!0),void 0!=t&&(b=t.x,C=t.y,v=!0),this.start={x:y,y:w},this.end={x:b,y:C},v){this.middle={x:(y+b)/2,y:(w+C)/2};for(var S=0;S<a.manager.ItemControls.length;S++){var k=a.manager.ItemControls[S];k!=a&&k.middle.x==a.middle.x&&k.middle.y==a.middle.y&&(0==a.direction.start?a.middle.y+=40:a.middle.x+=40)}}void 0==e&&(0==this.direction.start?this.middle.y>w+c-7?w+=c-7:this.middle.y<w-c+7?w-=c-7:w=this.middle.y:this.middle.x>y+d-10?y+=d-10:this.middle.x<y-d+10?y-=d-10:y=this.middle.x),void 0==t&&(0==this.direction.end?this.middle.y>C+u-7?C+=u-7:this.middle.y<C-u+7?C-=u-7:C=this.middle.y:this.middle.x>b+h-10?b+=h-10:this.middle.x<b-h+10?b-=h-10:b=this.middle.x),this.start={x:y,y:w},this.end={x:b,y:C}}this.points=this.GetPoints([this.start.x,this.start.y,this.middle.x,this.middle.y,this.end.x,this.end.y],this.direction);var T=this.GetColor();if(this.angle=Math.atan2(this.points[this.points.length-1]-this.points[this.points.length-3],this.points[this.points.length-2]-this.points[this.points.length-4]),void 0==this.control){this.control=new Konva.Group({x:0,y:0,rotation:0}),this.arrow=WorkflowDesignerCommon.createArrowByAngle(this.end.x,this.end.y,this.angle,15,T);var D={points:this.points,stroke:T,strokeWidth:2,lineCap:"round",lineJoin:"round"};this.item.IsFork&&(D.dash=[10,10]),this.line=new Konva.Line(D),this.control.add(this.line),this.control.add(this.arrow),this.manager.Layer.add(this.control)}else WorkflowDesignerCommon.updateArrowByAngle(this.arrow,this.end.x,this.end.y,this.angle,15,T),this.line.setPoints(this.points)},this.GetPoints=function(e,t){if(e[0]==e[2]==e[4]||e[1]==e[3]==e[5])return e;var i=new Array;return e[0]==e[2]||e[1]==e[3]?i.push(e[0],e[1],e[2],e[3]):(i.push(e[0],e[1]),0==t.start?i.push(e[2],e[1]):i.push(e[0],e[3]),i.push(e[2],e[3])),0==t.end&&i[i.length-2]!=e[4]?i.push(i[i.length-2],e[5]):1==t.end&&i[i.length-1]!=e[5]&&i.push(e[4],i[i.length-1]),i.push(e[4],e[5]),i},this.GetColor=function(){var e=void 0==this.item.Classifier?"notspecified":this.item.Classifier.toLowerCase();return"notspecified"==e?"#7F8C8D":"direct"==e?"#27AE60":"#2980B9"},this.DrawActivePoint=function(){if(this.activePoint)this._moveActivePoint(this.middle.x,this.middle.y);else{var e=void 0;void 0!=this.graph.Settings.drawElements&&void 0!=this.graph.Settings.drawElements.transitionActivePoint&&(e=this.graph.Settings.drawElements.transitionActivePoint(this,this.middle.x,this.middle.y)),e||(e=this.graph.Settings.transitionActivePointOldStyle?this._createActivePointOld(this.middle.x,this.middle.y,this.control):this._createActivePoint(this.middle.x,this.middle.y,this.control)),t.manager.APLayer.add(e),this.activePoint=e}},this.DrawTouchPoints=function(){this._getLineLength(this.start.x,this.start.y,this.end.x,this.end.y);if(void 0==this.touchpoints[0]||this.touchpoints[0].isdestroyed){var e=this._createTouchPoint(this.points,this.control,!1);t.manager.APLayer.add(e),this.touchpoints[0]=e}else this._moveTouchPoints(this.touchpoints[0],this.points,!1);if(void 0==this.touchpoints[1]||this.touchpoints[1].isdestroyed){var i=this._createTouchPoint(this.points,this.control,!0);t.manager.APLayer.add(i),this.touchpoints[1]=i}else this._moveTouchPoints(this.touchpoints[1],this.points,!0)},this.Draw=function(e,t){this.DrawTransition(e,t),this.DrawActivePoint(),this.graph.Settings.readonly||this.DrawTouchPoints()},this.DeleteTouchPoint=function(e){for(var t=0;t<this.touchpoints.length;t++)this.touchpoints[t].isend===e&&(this.touchpoints[t].destroy(),this.touchpoints[t].isdestroyed=!0)},this.Delete=function(){this.from.UnregisterTransition(this),this.to.UnregisterTransition(this),this.control.destroy(),void 0!=this.activePoint.ToolTip&&this.activePoint.ToolTip.destroy(),this.activePoint.destroy();for(var e=0;e<this.touchpoints.length;e++)this.touchpoints[e].destroy();var t=this.graph.data.Transitions.indexOf(this.item);t>=0&&this.graph.data.Transitions.splice(t,1),t=this.manager.ItemControls.indexOf(this),t>=0&&this.manager.ItemControls.splice(t,1)},this._onDelete=function(){t.graph.confirm(WorkflowDesignerConstants.DeleteConfirmCurrent,function(){t.Delete(),t.graph.onSelectionChanged(),t.graph.redrawAll(),t.graph.StoreGraphData()})},this.Select=function(){if(1!=this.selected){var e=this;if(e.oldstroke=this.line.getStroke(),e.line.setStroke(WorkflowDesignerConstants.SelectColor),e.line.setStrokeWidth(3),void 0==e.bar){var t=e.graph.Settings.imagefolder,i=-15,n=[];e.graph.Settings.notshowwindows||n.push({img:t+"wfe.settings.png",click:function(){e.ShowProperties()}}),e.graph.Settings.readonly||(n.push({img:t+"wfe.delete.png",click:function(){e._onDelete()}}),i=-30),n.length>0&&(e.bar=WorkflowDesignerBar(e.manager.APLayer,n,{x:i,y:-50}),e.activePoint.add(e.bar))}else this.bar.show();e.selected=!0}},this.Deselect=function(){0!=this.selected&&(this.line.setStrokeWidth(2),void 0!=this.oldstroke&&this.line.setStroke(this.oldstroke),void 0!=this.bar&&this.bar.hide(),this.selected=!1)},this._moveTouchPoints=function(e,t,i){var n=i?{x:t[t.length-2],y:t[t.length-1]}:{x:t[0],y:t[1]},o=i?{x:t[t.length-4],y:t[t.length-3]}:{x:t[2],y:t[3]},r={x:0,y:0},a=i?24:10;n.x==o.x?n.y<o.y?r.y=a:r.y=-a:n.y==o.y&&(n.x<o.x?r.x=a:r.x=-a),e.setPosition(n),e.circle.setPosition(r)},this._createTouchPoint=function(e,t,i){var n=this,o=i?{x:e[e.length-2],y:e[e.length-1]}:{x:e[0],y:e[1]},r=i?{x:e[e.length-4],y:e[e.length-3]}:{x:e[2],y:e[3]},a={x:0,y:0},s=i?24:10;o.x==r.x?o.y<r.y?a.y=s:a.y=-s:o.y==r.y&&(o.x<r.x?a.x=s:a.x=-s);var l=new Konva.Group({x:o.x,y:o.y,draggable:!0});l.isend=i;var d=this.GetColor(),c=new Konva.Circle({x:a.x,y:a.y,radius:5,fill:d});l.add(c),l.circle=c,l.transition=t;var h=function(){var e=n.graph.CorrectPossition(c.getAbsolutePosition(),n.manager.Layer);i?n.DrawTransition(void 0,e):n.DrawTransition(e,void 0),n.DrawActivePoint(),n.DeleteTouchPoint(!i),n.manager.batchDraw()};return l.on("dragmove",function(){h()}),l.on("dragend",function(){var e=c.getAbsolutePosition(),t=n.manager.getIntersectingActivity(e);void 0==t||t.group||(n.middle=void 0,n.Sync(),i?(n.to.UnregisterTransition(n),n.setTo(t),n.to.RegisterTransition(n)):(n.from.UnregisterTransition(n),n.setFrom(t),n.from.RegisterTransition(n)),n.graph.StoreGraphData()),n.Draw(),n.manager.batchDraw()}),l},this._moveActivePoint=function(e,t){this.activePoint.setPosition({x:e,y:t})},this._createActivePoint=function(e,t,i){var n=this,o=!n.graph.Settings.disableobjectmovements,r=new Konva.Group({x:e,y:t,draggable:o}),a="";isTimer=!1;var s=this.item.Trigger.Type.toLowerCase();"auto"===s?(a=WorkflowDesignerConstants.TransitionAuto,void 0==a&&(a="Auto")):"command"===s?this.item.Trigger&&this.item.Trigger.Command&&this.item.Trigger.Command.Name&&(a=this.item.Trigger.Command.Name,a.length>15&&(a=a.substr(0,15)+"...")):"timer"===s&&(isTimer=!0,this.item.Trigger&&this.item.Trigger.Timer&&this.item.Trigger.Timer.Name&&(a=this.item.Trigger.Timer.Name,a.length>15&&(a=a.substr(0,15)+"...")));var l=[],d=[];isTimer&&l.push(this.manager.ImageTimer),Array.isArray(this.item.Restrictions)&&this.item.Restrictions.length>0&&d.push(this.manager.ImageActor);var c=this.item.Conditions[0].Type.toLowerCase();"action"===c||"expression"===c?d.push(this.manager.ImageCondition):"otherwise"===c&&d.push(this.manager.ImageOtherwise);var h=WorkflowDesignerCommon.getTextWidth(a,"bold 12px arial")+2,u=15*l.length,m=15*d.length,g=(h+u+m)/2,f=h+u+m+10,p=new Konva.Text({x:-g+u+1,y:-5,text:a,fontSize:12,fontFamily:"Arial",fill:"#FFFFFF",fontStyle:"bold"}),v=new Konva.Rect({x:-g-5,y:-12,width:f,height:25,fill:n.GetColor(),cornerRadius:15});r.add(v);for(var y=0;y<l.length;y++)r.add(new Konva.Image({x:-g+12*y+2,y:-5,image:l[y],width:10,height:10,strokeWidth:0}));for(var y=0;y<d.length;y++)r.add(new Konva.Image({x:-g+2+u+h+12*y,y:-5,image:d[y],width:10,height:10,strokeWidth:0}));r.add(p),r.transition=i;var w=function(e,t){var i=n.graph.CorrectPossition(r.getAbsolutePosition(),n.manager.Layer);n.middle=i,n.DrawTransition(),n.graph.Settings.readonly||n.DrawTouchPoints(),e&&(n.DrawActivePoint(),n.Sync()),n.manager.batchDraw()},b=function(e){if(!n.graph.Settings.disableobjectmovements){var t=n.selected;e.evt.ctrlKey||n.graph.DeselectAll(),t?n.Deselect():n.Select(),void 0!=n.activePoint.ToolTip&&n.activePoint.ToolTip.hide(),n.graph.onSelectionChanged(),n.manager.batchDraw()}};if(r.on("click",b),r.on("touchend",b),r.on("dblclick",function(){n.graph.DeselectAll(),n.Select(),n.manager.batchDraw(),n.graph.Settings.notshowwindows||n.ShowProperties()}),r.on("dragstart",function(){n.graph.Settings.disableobjectmovements||void 0!=n.activePoint.ToolTip&&n.activePoint.ToolTip.hide()}),r.on("dragmove",function(){n.graph.Settings.disableobjectmovements||w(!1)}),r.on("dragend",function(){n.graph.Settings.disableobjectmovements||w(!0)}),1==n.graph.getParam("exinfo"))n.createExInfo(r);else{var C=this.item.Trigger.Type;void 0!=n.item.Trigger&&void 0!=n.item.Trigger.Command&&"Command"===n.item.Trigger.Type&&(C+=" "+n.item.Trigger.Command.Name),void 0!=n.item.Trigger&&void 0!=n.item.Trigger.Timer&&"Timer"===n.item.Trigger.Type&&(C+=" "+n.item.Trigger.Timer.Name),C+="\r\n"+this.item.Conditions[0].Type,void 0!=n.item.Conditions[0]&&"Action"===n.item.Conditions[0].Type&&n.item.Conditions[0].Action&&(C+=" "+n.item.Conditions[0].Action.ActionName),WorkflowDesignerTooltip(n.manager.APLayer,r,C,17)}return r},this._createActivePointOld=function(e,t,i){var n=this,o=!n.graph.Settings.disableobjectmovements,r=new Konva.Group({x:e,y:t,draggable:o}),a="",s=this.item.Trigger.Type.toLowerCase();"auto"===s?a+="A":"command"===s?a+="C":"timer"===s&&(a+="T");var l=this.item.Conditions[0].Type.toLowerCase();"always"===l?a+="A":"action"===l?a+="C":"otherwise"===l&&(a+="O"),Array.isArray(this.item.Restrictions)&&this.item.Restrictions.length>0&&(a+="R");var d=new Konva.Rect({x:3==a.length?-22:-16,y:-15,width:3==a.length?47:34,height:30,fill:n.GetColor(),cornerRadius:15});r.add(d);var c=new Konva.Text({x:3==a.length?-16:-10,y:-7,text:a,fontSize:16,fontFamily:"Arial",fill:"#FFFFFF",fontStyle:"bold"});r.add(c),r.transition=i;var h=function(e,t){var i=n.graph.CorrectPossition(r.getAbsolutePosition(),n.manager.Layer);n.middle=i,n.DrawTransition(),n.graph.Settings.readonly||n.DrawTouchPoints(),e&&(n.DrawActivePoint(),n.Sync()),n.manager.batchDraw()},u=function(e){if(!n.graph.Settings.disableobjectmovements){var t=n.selected;e.evt.ctrlKey||n.graph.DeselectAll(),t?n.Deselect():n.Select(),void 0!=n.activePoint.ToolTip&&n.activePoint.ToolTip.hide(),n.graph.onSelectionChanged(),n.manager.batchDraw()}};if(r.on("click",u),r.on("touchend",u),r.on("dblclick",function(){n.graph.DeselectAll(),n.Select(),n.manager.batchDraw(),n.graph.Settings.notshowwindows||n.ShowProperties()}),r.on("dragstart",function(){n.graph.Settings.disableobjectmovements||void 0!=n.activePoint.ToolTip&&n.activePoint.ToolTip.hide()}),r.on("dragmove",function(){n.graph.Settings.disableobjectmovements||h(!1)}),r.on("dragend",function(){n.graph.Settings.disableobjectmovements||h(!0)}),1==n.graph.getParam("exinfo"))n.createExInfo(r);else{var m=this.item.Trigger.Type;void 0!=n.item.Trigger&&void 0!=n.item.Trigger.Command&&"Command"===n.item.Trigger.Type&&(m+=" "+n.item.Trigger.Command.Name),void 0!=n.item.Trigger&&void 0!=n.item.Trigger.Timer&&"Timer"===n.item.Trigger.Type&&(m+=" "+n.item.Trigger.Timer.Name),m+="\r\n"+this.item.Conditions[0].Type,void 0!=n.item.Conditions[0]&&"Action"===n.item.Conditions[0].Type&&(m+=" "+n.item.Conditions[0].Action.ActionName),WorkflowDesignerTooltip(n.manager.APLayer,r,m,17)}return r},this.createExInfo=function(e){var i="";if(void 0!=t.item.Trigger&&void 0!=t.item.Trigger.Command&&"Command"===t.item.Trigger.Type&&(Array.isArray(t.item.Restrictions)&&t.item.Restrictions.length>0&&t.item.Restrictions.forEach(function(e){if(void 0!=e.Actor){var t=e.Actor.Name;"Restrict"==e.Type&&(t="("+t+")"),i.length>0&&(i+=", "),i+=t}}),i.length>0&&(i+=" -> "),i+=t.item.Trigger.Command.Name),void 0!=t.item.Trigger&&void 0!=t.item.Trigger.Timer&&"Timer"===t.item.Trigger.Type){var n=t.item.Trigger.Timer.Value;void 0!=n&&""!=n&&(i+=" "+n)}if(i.length>0){var o=new Konva.Text({x:0,y:-30,text:i,fontFamily:"Arial",fontSize:12,fill:"#4A4A4A",fontStyle:"bold"});o.setX(-Number(o.getWidth()/2)),e.add(o)}var r="";if(Array.isArray(t.item.Conditions)&&t.item.Conditions.length>0&&t.item.Conditions.forEach(function(e){if("Action"==e.Type){var t=e.Action.ActionName;1==e.ConditionInversion&&(t="("+t+")"),r.length>0&&(r+=", "),r+=t}else if("Expression"==e.Type){var t=e.Expression.substr(0,100);1==e.ConditionInversion&&(t="("+t+")"),r.length>0&&(r+=", "),r+=t}}),r.length>0){var o=new Konva.Text({x:0,y:20,text:r,fontFamily:"Arial",fontSize:12,fill:"#4A4A4A",fontStyle:"bold"});o.setX(-Number(o.getWidth()/2)),e.add(o)}},this._getLineLength=function(e,t,i,n){return Math.sqrt(Math.pow(i-e,2)+Math.pow(n-t,2))},this._getBendingKoeff=function(e,t,i,n,o,r){var a=t-n,s=i-e,l=e*n-i*t;s<=0&&(a=-a,s=-s,l=-l);var d=-(l+a*o)/s,c=d<r?-1:1,h=this._getLineLength(e,t,i,n),u=(e+i)/2,m=(t+n)/2,g=this._getLineLength(u,m,o,r),f=g/h*c;return 0==s&&(f=-f),f},this.getIntersectingRect=function(e){var t=this.activePoint.getAbsolutePosition();return t.x>=e.xl&&t.x<e.xr&&t.y>=e.yl&&t.y<e.yr},this.ShowProperties=function(){var e=WorkflowDesignerConstants.TransitionFormLabel,i={name:e.From,field:"From.Name",type:"select",displayfield:"Name",datasource:t.graph.data.Activities,width:"100%"};void 0!=this.item.From&&"Inline"===this.item.From.ActivityType&&(i={type:"group",width:"100%",elements:[i,{name:e.InlinedFinalActivityName,field:"InlinedFinalActivityName",type:"input",width:"100%"}]});var n={type:"form",title:e.Title,data:this.item,readonly:this.graph.Settings.readonly,elements:[{type:"group",elements:[{name:e.Name,field:"Name",type:"input",width:"100%"},{name:e.Classifier,field:"Classifier",type:"select",width:"100%",datasource:["Direct","Reverse","NotSpecified"]}]},{type:"group",elements:[i,{name:e.To,field:"To.Name",type:"select",displayfield:"Name",datasource:t.graph.data.Activities,width:"100%"}]},{field:"Trigger",code:"trigger",type:"form",datadefault:{Type:"Command"},elements:[{type:"group",elements:[{name:e.Trigger,code:"triggertype",field:"Type",type:"select",datasource:["Auto","Command","Timer"]},{name:e.TriggerCommand,code:"triggercommand",field:"Command.Name",type:"select",displayfield:"Name",datasource:t.graph.data.Commands},{name:e.TriggerTimer,code:"triggertimer",field:"Timer.Name",type:"select",displayfield:"Name",datasource:t.graph.data.Timers}]}]},{type:"group",elements:[{name:e.IsFork,field:"IsFork",code:"isfork",type:"checkbox"},{name:e.MergeViaSetState,field:"MergeViaSetState",code:"mergeviasetstate",type:"checkbox"},{name:e.DisableParentStateControl,field:"DisableParentStateControl",code:"disableparentstatecontrol",type:"checkbox"}]},{name:e.Restrictions,field:"Restrictions",code:"restrictions",type:"table",datadefault:{Type:"Allow"},elements:[{name:e.RestrictionsType,code:"resttype",field:"Type",type:"select",datasource:["Allow","Restrict"]},{name:e.RestrictionsActor,code:"restactor",field:"Actor.Name",type:"select",displayfield:"Name",datasource:t.graph.data.Actors}]},{type:"group",elements:[{name:e.AllowConcatenationType,field:"AllowConcatenationType",type:"select",datasource:["And","Or"]},{name:e.RestrictConcatenationType,field:"RestrictConcatenationType",type:"select",datasource:["And","Or"]}]},{name:e.Condition,field:"Conditions",code:"condition",type:"table",datadefault:{Type:"Always",ResultOnPreExecution:"Null"},elements:[{name:e.ConditionType,code:"conditiontype",field:"Type",type:"select",datasource:["Always","Action","Expression","Otherwise"]},{code:"conditionexpression",field:"Expression",type:"expression",colspan:"2",graph:t.graph},{name:e.ConditionAction,code:"conditionaction",field:"Action.ActionName",type:"select",datasource:t.graph.getConditionNames(),onchange:function(e){var t=$(e),i=t.closest("tr").find("[name=conditionactionparameter]").closest("td"),n=i.children(),o=$(e).dropdown("get value"),r=n[0].rebuild(o,n.find("input").val());n.remove(),i.append(r)}},{name:e.ConditionActionParameter,code:"conditionactionparameter",field:"Action.ActionParameter",type:"jsonparameter",graph:t.graph,parametertype:"Condition",openautocompleteonclick:!0,datasource:function(e,i){var n=$(this).closest("tr"),o=n.find("[name=conditionaction]")[0].value;i(t.graph.getAutoCompleteSuggestions("conditionparameter",o,e))}},{name:e.ConditionInversion,code:"conditioninversion",field:"ConditionInversion",type:"checkbox",width:"10px"},{name:e.ResultOnPreExecution,code:"conditionresult",field:"ResultOnPreExecution",type:"select",datasource:["True","False"],width:"10px"}],onrowadded:function(e){var t=e.find("[name=conditiontype]"),i=e.find("[name=conditionaction]").parents("td"),n=e.find("[name=conditionresult]").parents("td"),o=e.find("[name=conditionactionparameter]").parents("td"),r=e.find("[name=conditioninversion]").parents("td"),a=e.find("[name=conditionexpression]").parents("td"),s=function(){var e=i.children(),s=n.children(),l=o.children(),d=r.children(),c=a.children(),h=t.dropdown("get value");i.hide(),n.hide(),o.hide(),r.hide(),a.hide(),e.hide(),s.hide(),l.hide(),d.hide(),c.hide(),"Action"==h?(i.show(),n.show(),o.show(),r.show(),e.show(),l.show(),d.show(),s.show()):"Expression"===h?(a.show(),c.show(),r.show(),d.show(),n.show(),s.show()):(i.show(),n.show(),o.show(),r.show())};t.on("change",s),s()}},{type:"group",elements:[{name:e.ConditionsConcatenationType,field:"ConditionsConcatenationType",type:"select",datasource:["And","Or"]}]},{name:e.Annotations,type:"table",field:"Annotations",keyproperty:"Name",elements:[{name:e.AnnotationName,field:"Name",type:"input"},{name:e.AnnotationValue,field:"JsonValue",type:"json"}]}],renderFinalFunc:function(e,t){var i=e.find("[name=restrictions]").parent(),n=e.find("[name=triggertype]"),o=e.find("[name=isfork]"),r=e.find("[name=triggercommand]"),a=e.find("[name=triggertimer]"),s=e.find("[name=AllowConcatenationType]").parent().parent(),l=e.find("[name=ConditionsConcatenationType]").parent().parent(),d=e.find("[name=mergeviasetstate]").parent().parent(),c=e.find("[name=disableparentstatecontrol]").parent().parent(),h=function(){var e=function(e){return e.prev()},o=n.dropdown("get value");"Command"==o?(r.show(),e(r).show(),a.hide(),e(a).hide(),i.show()):"Timer"==o?(r.hide(),e(r).hide(),a.show(),e(a).show(),i.hide(),s.hide()):(r.hide(),e(r).hide(),a.hide(),e(a).hide(),i.hide(),s.hide()),WorkflowDesignerCommon.modal(t.window,"refresh")};n.on("change",h),h();var u=function(){o[0].checked?(d.show(),c.show()):(d.hide(),c.hide())};o.on("change",u),u();var m=s.find("[name=AllowConcatenationType]").dropdown("get value").toLowerCase(),g=s.find("[name=RestrictConcatenationType]").dropdown("get value").toLowerCase(),f=l.find("[name=ConditionsConcatenationType]").dropdown("get value").toLowerCase();"and"===m&&"and"===g&&s.hide();var p=e.find("[name=restrictions]").parent(),v=$('<a class="btnConcatParameters"></a>');v[0].innerText=WorkflowDesignerConstants.TransitionFormLabel.ShowConcatParameters,v.on("click",function(){s.is(":visible")?(s.hide(),v[0].innerText=WorkflowDesignerConstants.TransitionFormLabel.ShowConcatParameters):(s.show(),v[0].innerText=WorkflowDesignerConstants.TransitionFormLabel.HideConcatParameters),WorkflowDesignerCommon.modal(t.window,"refresh")}),p.append("&nbsp;"),p.append(v),"and"===f&&l.hide();var y=e.find("[name=condition]").parent(),w=$('<a class="btnConcatParameters"></a>');w[0].innerText=WorkflowDesignerConstants.TransitionFormLabel.ShowConcatParameters,w.on("click",function(){l.is(":visible")?(l.hide(),w[0].innerText=WorkflowDesignerConstants.TransitionFormLabel.ShowConcatParameters):(l.show(),w[0].innerText=WorkflowDesignerConstants.TransitionFormLabel.HideConcatParameters),WorkflowDesignerCommon.modal(t.window,"refresh")}),y.append("&nbsp;"),y.append(w),WorkflowDesignerCommon.modal(t.window,"refresh")},graph:t.graph,saveFunc:function(e){t.item.Name=e.Name,t.item.From={Name:e.From.Name},t.item.InlinedFinalActivityName=e.InlinedFinalActivityName,t.item.To={Name:e.To.Name},t.item.Classifier=e.Classifier,t.item.Restrictions=e.Restrictions,t.item.Trigger=e.Trigger,t.item.Conditions=e.Conditions,t.item.IsFork=e.IsFork,t.item.MergeViaSetState=e.MergeViaSetState,t.item.DisableParentStateControl=e.DisableParentStateControl,t.item.ConditionsConcatenationType=e.ConditionsConcatenationType,t.item.AllowConcatenationType=e.AllowConcatenationType,t.item.RestrictConcatenationType=e.RestrictConcatenationType,t.item.Annotations=e.Annotations,WorkflowDesignerCommon.DataCorrection(t.graph.data),t.graph.Draw(t.graph.data),t.graph.StoreGraphData()}};if(void 0!=this.graph.Settings.forms&&void 0!=this.graph.Settings.forms.transition)this.graph.Settings.forms.transition(n);else{var o=new WorkflowDesignerForm(n),r=function(e,i){var n=!0;n&=e.CheckRequired([i],["Name"],WorkflowDesignerConstants.FieldIsRequired),n&=e.CheckRequired([i],["Classifier"],WorkflowDesignerConstants.FieldIsRequired),n&=e.CheckRequired([i],["From.Name"],WorkflowDesignerConstants.FieldIsRequired),n&=e.CheckRequired([i],["To.Name"],WorkflowDesignerConstants.FieldIsRequired);var o=["Type"];"Command"==i.Trigger.Type?o.push("Command.Name"):"Timer"==i.Trigger.Type&&o.push("Timer.Name"),n&=e.CheckRequired([i.Trigger],o,WorkflowDesignerConstants.FieldIsRequired),i.Conditions.forEach(function(t){o=["Type"],"Action"==t.Type&&o.push("Action.ActionName"),"Expression"==t.Type&&o.push("Expression"),n&=e.CheckRequired([t],o,WorkflowDesignerConstants.FieldIsRequired),"Always"==t.Type&&i.Conditions.length>1?(n=!1,e.ControlAddError(t.control_Type,WorkflowDesignerConstants.AlwaysConditionShouldBeSingle)):"Otherwise"==t.Type&&i.Conditions.length>1&&(n=!1,e.ControlAddError(t.control_Type,WorkflowDesignerConstants.OtherwiseConditionShouldBeSingle))});var r=i.control_Conditions.parent().children("h4");return!i.Conditions.length>0?(r.attr("title",WorkflowDesignerConstants.TransitionFormLabel.ConditionsListShouldNotBeEmpty),r.css("cssText","color: red !important;"),n=!1):(r.attr("title",void 0),r.css("color","")),t.graph.data.Transitions.forEach(function(o){o!=t.item&&o.Name==i.Name&&(n=!1,e.ControlAddError(i.control_Name,WorkflowDesignerConstants.FieldMustBeUnique))}),e.CheckRequired(i.Restrictions,["Type","Actor.Name"],WorkflowDesignerConstants.FieldIsRequired)||(n=!1),e.CheckRequired(i.Annotations,["Name"],WorkflowDesignerConstants.FieldIsRequired)||(n=!1),e.CheckUnique(i.Annotations,["Name"],WorkflowDesignerConstants.FieldMustBeUnique)||(n=!1),n},a=function(e){return!!r(o,e)&&(o.ClearTempField(e),o.parameters.saveFunc(e),!0)};o.showModal(a)}},this.Sync=function(){this.group||(t.item.DesignerSettings.Bending=t.bending,void 0!=t.middle&&(t.item.DesignerSettings.X=t.middle.x,t.item.DesignerSettings.Y=t.middle.y))},this.destroy=function(){this.control.destroy(),this.activePoint.destroy(),this.touchpoints.forEach(function(e){e.destroy()}),void 0!=this.bar&&this.bar.destroy()}}function WorkflowDesignerTransitionManagerTempControl(e){this.x=e.x,this.y=e.y,this.manager=e.manager,this.control=void 0,this.Draw=function(e,t){this.control=new Konva.Group({x:0,y:0,rotation:0}),this.line=new Konva.Line({points:[this.x,this.y,e,t],stroke:"#FFCC99",strrokeWidth:1});var i=Math.atan2(t-this.y,e-this.x);this.arrow=WorkflowDesignerCommon.createArrowByAngle(e,t,i,20,"#FFCC99"),this.control.add(this.line),this.control.add(this.arrow),this.manager.Layer.add(this.control)},this.Redraw=function(e){this.line.setPoints([this.x,this.y,e.x,e.y]);var t=Math.atan2(e.y-this.y,e.x-this.x);WorkflowDesignerCommon.updateArrowByAngle(this.arrow,e.x,e.y,t,20,"#FFCC99")},this.Delete=function(){this.control.destroy()}}function WorkflowDesignerActivityManager(){this.type="WorkflowDesignerActivityManager",this.init=function(e){this.graph=e,this.Layer=new Konva.Layer,this.graph.Stage.add(this.Layer),this.Layer.setZIndex(1)},this.ItemControls=new Array,this.draw=function(){null!=this.ItemControls&&this.ItemControls.forEach(function(e){e.destroy()}),this.ItemControls=new Array;var e=this;void 0!=this.graph.data.Activities&&this.graph.data.Activities.forEach(function(t){var i,n,o=void 0;if(e.graph.Settings.group!=t.DesignerSettings.Group){if(void 0!=t.DesignerSettings.InlineElementSettings&&t.DesignerSettings.InlineElementSettings.Group==e.graph.Settings.group){if(""!=t.DesignerSettings.InlineElementSettings.X&&""!=t.DesignerSettings.InlineElementSettings.Y)i=Number(t.DesignerSettings.InlineElementSettings.X),n=Number(t.DesignerSettings.InlineElementSettings.Y);else{var r=e.GetDefaultPosition();i=r.x,n=r.y}o=new WorkflowDesignerActivityControl({x:i,y:n,item:t,graph:e.graph,manager:e,group:!0})}}else{if(""!=t.DesignerSettings.X&&""!=t.DesignerSettings.Y)i=Number(t.DesignerSettings.X),n=Number(t.DesignerSettings.Y);else{var r=e.GetDefaultPosition();i=r.x,n=r.y}var o=new WorkflowDesignerActivityControl({x:i,y:n,item:t,graph:e.graph,manager:e})}void 0!=o&&(e.ItemControls.push(o),o.Draw(),o.Sync())}),this.Layer.batchDraw()},this.CreateNewActivity=function(e,t){void 0==e&&(e=this.GetDefaultPosition()),void 0==t&&(t={IsAutoSchemeUpdate:!0,IsForSetState:!0}),void 0==t.Name&&(t.Name=this.GetDefaultName()),0==this.graph.data.Activities.length&&(t.IsInitial=!0),t.DesignerSettings&&(t.DesignerSettings=new{X:e.x,Y:e.y});var i=new WorkflowDesignerActivityControl({x:e.x,y:e.y,item:t,graph:this.graph,manager:this});return this.graph.data.Activities.push(t),this.ItemControls.push(i),i.Draw(),i.Sync(),i},this.CreateNewInline=function(e,t){void 0==e&&(e=this.GetDefaultPosition()),void 0==t&&(t={IsAutoSchemeUpdate:!1,IsForSetState:!1,ActivityType:"Inline"}),void 0==t.Name&&(t.Name=this.GetDefaultName()),0==this.graph.data.Activities.length&&(t.IsInitial=!0),t.DesignerSettings&&(t.DesignerSettings=new{X:e.x,Y:e.y});var i=new WorkflowDesignerActivityControl({x:e.x,y:e.y,item:t,graph:this.graph,manager:this});return this.graph.data.Activities.push(t),this.ItemControls.push(i),i.Draw(),i.Sync(),i},this.GetDefaultName=function(){for(var e=WorkflowDesignerConstants.ActivityNamePrefix,t=1,i=0;i<this.graph.data.Activities.length;i++){this.graph.data.Activities[i].Name==e+t&&(t++,i=-1)}return e+t},this.GetDefaultPosition=function(){for(var e=this.graph.CorrectPossition({x:60,y:100},this.Layer),t=2*this.graph.Settings.DefaultMoveStep/this.Layer.getScaleX(),i=0;i<this.ItemControls.length;i++){var n=this.ItemControls[i].control.getPosition();n.x==e.x&&n.y==e.y&&(e.x+=t,e.y+=t,i=-1)}return e},this.find=function(e){if("object"==typeof e&&void 0!=e.Name)return this.find(e.Name);for(var t=0;t<this.ItemControls.length;t++)if(this.ItemControls[t].item.Name===e)return this.ItemControls[t]},this.findGroup=function(e,t){for(var i=0;i<this.graph.data.Activities.length;i++){var n=this.graph.data.Activities[i];if(n.DesignerSettings.Group==e&&void 0!=n.DesignerSettings.InlineElementSettings&&n.DesignerSettings.InlineElementSettings.Group==t)return this.find(n.Name)}},this.getIntersectingActivity=function(e){
for(var t=0;t<this.ItemControls.length;t++){var i=this.ItemControls[t];if(i.getIntersectingActivity(e))return i}},this.LayerSetOffset=function(e){this.Layer.setOffset(e)},this.LayerScale=function(e){var t=(e.scale,e.delta);this.Layer.setScale({x:this.Layer.getScale().x+t,y:this.Layer.getScale().y+t})},this.LayerScaleNorm=function(e){this.Layer.setScale({x:1,y:1}),this.Layer.setOffset({x:0,y:0})},this.redrawTransitions=function(){return void 0==this.cTransition&&(this.cTransition=this.graph.GetComponentByType("WorkflowDesignerTransitionManager")),this.cTransition.batchDraw()},this.batchDraw=function(){this.Layer.batchDraw()},this.SelectAll=function(){this.ItemControls.forEach(function(e){e.Select()})},this.DeselectAll=function(){this.ItemControls.forEach(function(e){e.Deselect()})},this.GetSizeForSaveAsImage=function(e){for(var t=0;t<this.ItemControls.length;t++){var i=this.ItemControls[t],n=i.rectangle.getAbsolutePosition(),o=n.x,r=n.y,a=o+i.rectangle.getWidth()*this.Layer.getScaleX(),s=r+i.rectangle.getHeight()*this.Layer.getScaleX();o<e.x1&&(e.x1=o),r<e.y1&&(e.y1=r),a>e.x2&&(e.x2=a),s>e.y2&&(e.y2=s)}return e},this.GetSelected=function(){var e=new Array;return this.ItemControls.forEach(function(t){t.selected&&e.push(t)}),e},this.SelectByPosition=function(e){this.ItemControls.forEach(function(t){t.getIntersectingActivityRect(e)&&t.Select()})},this.SelectByItem=function(e){this.ItemControls.forEach(function(t){t.item==e&&t.Select()})},this.ObjectMove=function(e){this.ItemControls.forEach(function(t){t.selected&&e.sender!=t&&t.ObjectMove(e.changepos)}),this.redrawTransitions()},this.createTransitionAndActivity=function(e){var t={x:e.control.getX()+e.rectangle.attrs.width+100,y:e.control.getY()},i=this.CreateNewActivity(t);this.graph.GetComponentByType("WorkflowDesignerTransitionManager").CreateNewTransition(e,i),this.graph.redrawAll()},this.createTransition=function(e){return this.graph.GetComponentByType("WorkflowDesignerTransitionManager").CreateNewTransition(e)},this.Clone=function(e){var t=JSON.parse(JSON.stringify(e.item));t.DesignerSettings.Y+=160,t.Name=this.CopySelectedGenUniqueValue(t.Name,this.graph.data.Activities,"Name"),this.graph.data.Activities.push(t),this.graph.Draw(this.graph.data),this.SelectByItem(t)},this.CopySelectedGenUniqueValue=function(e,t,i){for(var n=e,o=1;!0;o++){for(var r=!1,a=0;a<t.length;a++)if(t[a][i]==n){r=!0;break}if(!r)break;n=e+"_"+o}return n}}function WorkflowDesignerBackground(){this.type="WorkflowDesignerBackground",this.init=function(e){var t=this;this.graph=e,this.BackgroundLayer=new Konva.Layer,this.graph.Stage.add(this.BackgroundLayer),this.BackgroundLayer.setZIndex(0),this.SelectionLayer=new Konva.Layer,this.graph.Stage.add(this.SelectionLayer),this.SelectionLayer.setZIndex(1),WorkflowDesignerCommon.loadImage(this.graph.Settings.imagefolder+"wfe.grid.png",function(e){t.RectBG.setFillPatternImage(e),t.BackgroundLayer.batchDraw()}),this.RectBG=new Konva.Rect({x:0,y:0,width:5e3,height:5e3,draggable:!1,dragBoundFunc:function(e){var i=t.graph.Settings.DefaultMoveStep*t.BackgroundLayer.getScaleX(),n=t.graph.Settings.DefaultMoveStep*t.BackgroundLayer.getScaleY(),o={x:Math.round(e.x/i)*i,y:Math.round(e.y/n)*n},r=t.BackgroundLayer.getScaleX(),a=t.BackgroundLayer.getScaleY(),s=t.graph.Stage.width()/r,l=t.graph.Stage.height()/a;return t.RectBG.width()+e.x/r-s<0&&t.RectBG.width(t.RectBG.width()+s),t.RectBG.height()+e.y/a-l<0&&t.RectBG.height(t.RectBG.height()+l),t.graph.GraphLayerSetOffset(-o.x/r,-o.y/a),o},designerparam:"background"}),this.BackgroundLayer.add(this.RectBG),this.BackgroundLayer.batchDraw(),this.graph.Stage.on("mousedown.background",function(e){"background"===e.target.attrs.designerparam&&(1!=t._movemodeenabled?t._mousedownpos=t.graph.CorrectPossition({x:e.evt.offsetX,y:e.evt.offsetY},t.SelectionLayer):t.graph.DeselectAll())}),this.graph.Stage.on("mousemove.background",function(e){if(1!=t._movemodeenabled&&void 0!=t._mousedownpos){var i=t.graph.CorrectPossition({x:e.evt.offsetX,y:e.evt.offsetY},t.SelectionLayer);t.DrawSelectionRect(i)}}),this.graph.Stage.on("mouseup.background",function(e){if(!t._movemodeenabled&&void 0!=t._mousedownpos){var i=t.getSelectionRectPos();void 0==i?e.evt.ctrlKey||t.graph.DeselectAll():(Math.abs(i.xl-i.xr)>10||Math.abs(i.yl-i.yr)>10)&&(t.graph.DeselectAll(),t.graph.ComponentsExecute("SelectByPosition",i),t.graph.onSelectionChanged())}t._mousedownpos=void 0,t.DeleteSelectionRect()})},this.setMoveModeEnabled=function(e){this._movemodeenabled=Boolean(e),this.RectBG.setDraggable(this._movemodeenabled),this.graph.setParam("movemodeenabled",this._movemodeenabled)},this.updatePosition=function(e){var t=this.RectBG.getPosition(),i={x:-t.x-e.x,y:-t.y-e.y};this.RectBG.setPosition({x:-i.x,y:-i.y}),this.graph.ComponentsExecute("LayerSetOffset",{x:i.x,y:i.y})},this.setPosition=function(e){this.RectBG.setPosition({x:-e.x,y:-e.y}),this.graph.ComponentsExecute("LayerSetOffset",{x:e.x,y:e.y})},this.LayerScale=function(e){var t=(e.scale,e.delta);this.BackgroundLayer.setScale({x:this.BackgroundLayer.getScale().x+t,y:this.BackgroundLayer.getScale().y+t})},this.LayerScaleNorm=function(){this.BackgroundLayer.setScale({x:1,y:1}),this.SelectionLayer.setScale({x:1,y:1}),this.RectBG.setPosition({x:0,y:0})},this.DrawSelectionRect=function(e){void 0==this.RectSelection?(this.RectSelection=new Konva.Rect({x:this._mousedownpos.x,y:this._mousedownpos.y,width:e.x-this._mousedownpos.x,height:e.y-this._mousedownpos.y,draggable:!1,fill:"#66CCFF",opacity:.2}),this.SelectionLayer.add(this.RectSelection)):(this.RectSelection.setWidth(e.x-this._mousedownpos.x),this.RectSelection.setHeight(e.y-this._mousedownpos.y)),this.SelectionLayer.batchDraw()},this.DeleteSelectionRect=function(e){this.RectSelection&&(this.RectSelection.destroy(),this.RectSelection=void 0,this.SelectionLayer.batchDraw())},this.getSelectionRectPos=function(){if(void 0!=this.RectSelection){var e=this.RectSelection.getAbsolutePosition(),t=e.x,i=e.y,n=t+this.RectSelection.getWidth()*this.SelectionLayer.getScaleX(),o=i+this.RectSelection.getHeight()*this.SelectionLayer.getScaleX();return{xl:Math.min(t,n),yl:Math.min(i,o),xr:Math.max(t,n),yr:Math.max(i,o)}}}}function WorkflowDesignerTooltip(e,t,i,n,o,r){var a=function(e,t){if(0==t.getScaleX()||0==t.getScaleY())return{x:t.getOffsetX(),y:0};var i=void 0==o?0:o;return{x:e.x/t.getScaleX()+t.getOffsetX()+i,y:e.y/t.getScaleY()+t.getOffsetY()}};t.on("mouseover",function(){if(void 0!=t.ToolTip){var o=a(t.getAbsolutePosition(),e);t.ToolTip.position({x:o.x+t.getWidth()/2,y:o.y+n,opacity:1}),t.ToolTip.show()}else{var o=a(t.getAbsolutePosition(),e),s=new Konva.Label({x:o.x+t.getWidth()/2,y:o.y+n,opacity:1});s.add(new Konva.Tag({fill:"#3D4D59",pointerDirection:void 0==r?"up":r,pointerWidth:13,pointerHeight:7,lineJoin:"round",shadowColor:"#3D4D59",shadowBlur:10,shadowOffset:10,shadowOpacity:0,cornerRadius:5})),s.add(new Konva.Text({text:i,fontFamily:"Arial",fontSize:12,padding:5,fill:"white"})),e.add(s),t.ToolTip=s}e.batchDraw()}),t.on("mouseleave",function(){void 0!=t.ToolTip&&(t.ToolTip.hide(),e.batchDraw())})}function WorkflowDesignerBar(e,t,i,n){var o="v"===n,r=new Konva.Group({x:i.x,y:i.y}),a=new Konva.Rect({x:0,y:0,width:o?30:30*t.length,height:o?30*t.length:30,fill:WorkflowDesignerConstants.BarColor,cornerRadius:5});r.add(a);var s=0;return t.forEach(function(t){if(t.offset=s,t.separator){s+=10;var i=o?[5,t.offset+5,25,t.offset+5]:[t.offset+5,5,t.offset+5,25];t.cObject=new Konva.Line({points:i,stroke:WorkflowDesignerConstants.BarSeparatorColor,strokeWidth:2}),r.add(t.cObject)}else s+=30,WorkflowDesignerCommon.loadImage(t.img,function(i){if(!e.destroyed){var n=o?{x:5,y:t.offset+5}:{x:5+t.offset,y:5};t.offset,t.offset,t.group=new Konva.Group({x:n.x-5,y:n.y-5,width:30,height:30}),t.bg=new Konva.Rect({x:0,y:0,width:30,height:30,cornerRadius:5}),1==t.active&&t.bg.setFill(WorkflowDesignerConstants.ButtonActive),t.group.add(t.bg),t.cImageToolbar=new Konva.Image({x:5,y:5,image:i,width:20,height:20,strokeWidth:0}),t.group.add(t.cImageToolbar);var a=function(){void 0!=t.cImageToolbar.ToolTip&&t.cImageToolbar.ToolTip.hide(),void 0!=t.click&&t.click()};t.group.on("click",a),t.group.on("touchend",a),t.group.on("mouseover",function(){t.bg.setFill(WorkflowDesignerConstants.ButtonActive),e.batchDraw()}),t.group.on("mouseleave",function(){void 0!=t.active&&0!=t.active||(t.bg.setFill(""),e.batchDraw())}),t.group.add(t.cImageToolbar),r.add(t.group),void 0!=t.title&&""!=t.title&&WorkflowDesignerTooltip(e,t.cImageToolbar,t.title,30),e.batchDraw()}})}),1==o?a.setHeight(s):a.setWidth(s),r}function WorkflowDesignerToolbar(){this.type="WorkflowDesignerToolbar",this.graph=void 0;var e=this;this.init=function(t){this.graph=t,this.Layer=new Konva.Layer,this.graph.Stage.add(this.Layer),this.Layer.setZIndex(10),this.InitItems(),this.MainToolbarDraw(20,20),this.SideToolbarDraw(e.graph.Settings.graphwidth-70,90),this.graph.Settings.hideInfoBlock||this.CreateInfoBlock();var i=this.GetWorkflowDesignerBackground();void 0!=i&&i.RectBG.setDraggable(!1),this.graph.getParam("movemodeenabled")&&e.ToolbarMovePress(),this.graph.getParam("exinfo")&&e.ToolbarExInfoPress()},this.MainToolbarDraw=function(e,t){var i=0;for(var n in this.Items)Array.isArray(this.Items[n])&&this.Items[n].length>0&&(i=this.ToolbarDraw(this.Items[n],e+i,t),i+=10)},this.SideToolbarDraw=function(t,i){var n=this.SideItems,o=new Konva.Group({x:t,y:i}),r=new Konva.Rect({x:0,y:0,width:50,fill:"#FFFFFF",shadowEnabled:!0,shadowBlur:10,shadowOpacity:.3,cornerRadius:4});o.add(r);var a=0;n.forEach(function(t){t.offset=a,1==t.separator?(a+=1,t.cObject=new Konva.Line({points:[10,t.offset+3,40,t.offset+3],stroke:WorkflowDesignerConstants.BarSeparatorColor,strokeWidth:2}),o.add(t.cObject)):(a+=45,e.loadImageHandler(void 0,{item:t,x:0,y:t.offset,container:o,tooltipX:25,tooltipY:-25,direction:"right"}),WorkflowDesignerCommon.loadImage(t.img,function(e,t){t.container.image(e),this.Layer.destroyed||this.Layer.batchDraw()}.bind(e),{container:t.cImageToolbar}))}),o.add(new Konva.Line({points:[10,a+3,40,a+3],stroke:WorkflowDesignerConstants.BarSeparatorColor,strokeWidth:2})),this.scaleText=new Konva.Text({text:"100%",fontFamily:"Arial",fontStyle:"Bold",fontSize:12,padding:5,fill:"black",x:4,y:a+16,align:"center",width:41}),o.add(this.scaleText),a+=40,r.height(a+5),this.Layer.add(o),this.SideToolbar=o},this.ToolbarDraw=function(t,i,n){var o=new Konva.Group({x:i,y:n}),r=new Konva.Rect({x:0,y:0,height:50,fill:"#FFFFFF",shadowEnabled:!0,shadowBlur:10,shadowOpacity:.3,cornerRadius:4});o.add(r);var a=0;return t.forEach(function(t){t.offset=a,1==t.separator?(a+=1,t.cObject=new Konva.Line({points:[t.offset+3,10,t.offset+3,40],stroke:WorkflowDesignerConstants.BarSeparatorColor,strokeWidth:2}),o.add(t.cObject)):(a+=45,e.loadImageHandler(void 0,{item:t,x:t.offset,y:0,container:o}),WorkflowDesignerCommon.loadImage(t.img,function(e,t){t.container.image(e),this.Layer.destroyed||this.Layer.batchDraw()}.bind(e),{container:t.cImageToolbar}))}),r.width(a+5),this.Layer.add(o),i+a},this.loadImageHandler=function(t,i){var n=i.item;n.group=new Konva.Group({x:i.x,y:i.y,width:40,height:40}),n.bg=new Konva.Rect({x:5,y:5,width:40,height:40,cornerRadius:4}),n.group.add(n.bg),1==n.active&&n.bg.setFill(WorkflowDesignerConstants.ButtonActive),n.cImageToolbar=new Konva.Image({x:15,y:15,image:t,width:20,height:20,strokeWidth:0}),1==n.disabled&&n.cImageToolbar.opacity(.3),n.group.add(n.cImageToolbar),n.group.on("click",function(){n.disabled!==!0&&void 0!=n.click&&n.click(n)}),n.group.on("touchend",function(){n.disabled!==!0&&void 0!=n.click&&n.click(n)}),n.group.on("mouseover",function(){1!=n.disabled&&(n.bg.setFill(WorkflowDesignerConstants.ButtonActive),e.Layer.batchDraw())}),n.group.on("mouseleave",function(){void 0!=n.active&&0!=n.active||(n.bg.setFill(""),e.Layer.batchDraw())}),i.container.add(n.group),WorkflowDesignerTooltip(this.Layer,n.group,n.title,void 0==i.tooltipX?55:i.tooltipX,void 0==i.tooltipY?5:i.tooltipY,i.direction),this.Layer.batchDraw()},this.draw=function(){this.GraphRedrawAll()},this.GraphRedrawAll=function(){this.UpdateInfoBlock(),this.Layer.batchDraw()},this.changeSize=function(e,t){void 0!=this.info&&this.info.position({x:e-320,y:t-70}),void 0!=this.SideToolbar&&this.SideToolbar.position({x:e-70,y:90})},this.CreateInfoBlock=function(){var e=this.graph.Settings.imagefolder,t=e+"wfe.add.png",i=e+"wfe.transitons2.png",n=e+"wfe.commands.png",o={x:0,y:0};this.info=new Konva.Group(o);var r=new Konva.Rect({x:0,y:0,height:50,width:300,fill:"#FFFFFF",shadowEnabled:!0,shadowBlur:10,shadowOpacity:.3,cornerRadius:4});this.info.add(r);var a=5;this.infoText1=new Konva.Text({fontFamily:"Arial",fontStyle:"Bold",fontSize:12,padding:5,fill:"black",x:a,y:16,align:"center",width:60}),this.info.add(this.infoText1),a+=this.infoText1.width()+5,WorkflowDesignerCommon.loadImage(t,function(e,t){t.container.add(new Konva.Image({x:t.x,y:t.y,image:e,width:20,height:20,strokeWidth:0}))},{container:this.info,x:a,y:15}),a+=30,this.info.add(new Konva.Line({points:[a,10,a,40],stroke:WorkflowDesignerConstants.BarSeparatorColor,strokeWidth:2})),a+=5,this.infoText2=new Konva.Text({fontFamily:"Arial",fontStyle:"Bold",fontSize:12,padding:5,fill:"black",x:a,y:16,align:"center",width:60}),this.info.add(this.infoText2),a+=this.infoText2.width()+5,WorkflowDesignerCommon.loadImage(i,function(e,t){t.container.add(new Konva.Image({x:t.x,y:t.y,image:e,width:20,height:20,strokeWidth:0}))},{container:this.info,x:a,y:15}),a+=30,this.info.add(new Konva.Line({points:[a,10,a,40],stroke:WorkflowDesignerConstants.BarSeparatorColor,strokeWidth:2})),a+=5,this.infoText3=new Konva.Text({fontFamily:"Arial",fontStyle:"Bold",fontSize:12,padding:5,fill:"black",x:a,y:16,align:"center",width:60}),this.info.add(this.infoText3),a+=this.infoText3.width()+5,WorkflowDesignerCommon.loadImage(n,function(e,t){t.container.add(new Konva.Image({x:t.x,y:t.y,image:e,width:20,height:20,strokeWidth:0}))},{container:this.info,x:a,y:15}),a+=30,r.width(a),this.UpdateInfoBlock(),o={x:this.graph.Settings.graphwidth-320,y:this.graph.Settings.graphheight-70},this.info.position(o),this.Layer.add(this.info)},this.UpdateInfoBlock=function(){var e=this.GetInfoBlockTextValue();if(void 0!=this.infoText1){var t=String(e.activity),i="black";void 0!=e.activityLimit&&(t+="/"+e.activityLimit,e.activityLimit<e.activity&&(i="#C0392B")),this.infoText1.setText(t),this.infoText1.setFill(i)}if(void 0!=this.infoText2){var n=String(e.transition),i="black";void 0!=e.transitionLimit&&(n+="/"+e.transitionLimit,e.transitionLimit<e.transition&&(i="#C0392B")),this.infoText2.setText(n),this.infoText2.setFill(i)}if(void 0!=this.infoText3){var o=String(e.command),i="black";void 0!=e.commandLimit&&(o+="/"+e.commandLimit,e.commandLimit<e.command&&(i="#C0392B")),this.infoText3.setText(o),this.infoText3.setFill(i)}},this.GetInfoBlockTextValue=function(){var e={activity:0,transition:0,command:0,activityLimit:void 0,transitionLimit:void 0,commandLimit:void 0};if(void 0!=this.graph.data&&(e.activity=this.graph.data.Activities.length,e.transition=this.graph.data.Transitions.length,e.command=this.graph.data.Commands.length,void 0!=this.graph.data.AdditionalParams)){var t=this.graph.data.AdditionalParams;void 0!=t.MaxNumberOfActivities&&t.MaxNumberOfActivities!=-1&&(e.activityLimit=t.MaxNumberOfActivities),void 0!=t.MaxNumberOfTransitions&&t.MaxNumberOfTransitions!=-1&&(e.transitionLimit=t.MaxNumberOfTransitions),void 0!=t.MaxNumberOfCommands&&t.MaxNumberOfCommands!=-1&&(e.commandLimit=t.MaxNumberOfCommands)}return e},this.ToolbarMovePress=function(){var e=this.GetWorkflowDesignerBackground();e.setMoveModeEnabled(!e._movemodeenabled);var t=this.GetItemByCode("move");e._movemodeenabled?(t.active=!0,void 0!=t.bg&&t.bg.setFill(WorkflowDesignerConstants.ButtonActive)):(t.active=void 0,void 0!=t.bg&&t.bg.setFill("")),this.Layer.batchDraw()},this.ToolbarExInfoPress=function(){var e=this.GetItemByCode("exinfo");this.exinfo?(e.active=void 0,void 0!=e.bg&&e.bg.setFill(""),this.exinfo=!1,this.graph.setParam("exinfo",!1)):(e.active=!0,void 0!=e.bg&&e.bg.setFill(WorkflowDesignerConstants.ButtonActive),this.exinfo=!0,this.graph.setParam("exinfo",!0)),void 0!=this.graph.Draw&&this.graph.Draw(this.graph.data)},this.ToolbarInlinePress=function(){this.graph.data.CanBeInlined?this.graph.setInlinedFlag(!1):this.graph.setInlinedFlag(!0)},this.onChangeScheme=function(){var t=this.GetItemByCode("inline");if(void 0!=t&&void 0!=t.cImageToolbar){var i=this.graph.data.CanBeInlined?t.img2:t.img;WorkflowDesignerCommon.loadImage(i,function(e,t){t.container.image(e),this.Layer.destroyed||this.Layer.batchDraw()}.bind(e),{container:t.cImageToolbar})}},this.GetWorkflowDesignerBackground=function(){return this.graph.GetComponentByType("WorkflowDesignerBackground")},this.CreateActivity=function(){this.graph.GetComponentByType("WorkflowDesignerActivityManager").CreateNewActivity(),this.graph.redrawAll(),this.graph.StoreGraphData()},this.CreateInline=function(){this.graph.GetComponentByType("WorkflowDesignerActivityManager").CreateNewInline(),this.graph.redrawAll(),this.graph.StoreGraphData()},this.AutoArrangement=function(){if(0!=e.graph.data.Activities.length){var t=new Array,i=new Array;if(e.graph.data.Activities.forEach(function(n){(void 0==n.DesignerSettings||n.DesignerSettings.Group==e.graph.Settings.group||void 0!=n.DesignerSettings.InlineElementSettings&&n.DesignerSettings.InlineElementSettings.Group==e.graph.Settings.group)&&(t.push(n),n.IsInitial&&i.push(n))}),0!=t.length){t.forEach(function(t){if(!t.IsInitial){for(var n=!0,o=0;o<e.graph.data.Transitions.length;o++){var r=e.graph.data.Transitions[o];if("Direct"==r.Classifier&&r.To==t){n=!1;break}}n&&i.push(t)}}),0==i.length&&i.push(t[0]);var n={x:80,y:120},o={x:300,y:140},r=Array(),a=function(t,i,n){var s={x:i.x,y:i.y};n||(s.x+=o.x);for(var l=new Array,d=0;d<t.length;d++){var c=t[d];void 0==c.DesignerSettings&&(c.DesignerSettings={}),!n&&$.inArray(c,r)>=0||(c.DesignerSettings.Group==e.graph.Settings.group?c.DesignerSettings.X=s.x:void 0!=c.DesignerSettings.InlineElementSettings&&c.DesignerSettings.InlineElementSettings.Group==e.graph.Settings.group&&(c.DesignerSettings.InlineElementSettings.X=s.x),r.push(c),l.push(c))}for(var d=0;d<l.length;d++){var c=l[d];d>0&&(s.y+=o.y);var h=new Array;e.graph.data.Transitions.forEach(function(e){"Direct"==e.Classifier&&e.From==c&&h.push(e.To)}),c.DesignerSettings.Group==e.graph.Settings.group?c.DesignerSettings.Y=s.y:void 0!=c.DesignerSettings.InlineElementSettings&&c.DesignerSettings.InlineElementSettings.Group==e.graph.Settings.group&&(c.DesignerSettings.InlineElementSettings.Y=s.y);var u=a(h,{x:s.x,y:s.y});s.y=u.y}return{x:s.x,y:s.y}};a(i,n,!0),e.graph.data.Transitions.forEach(function(t){void 0==t.DesignerSettings&&(t.DesignerSettings={}),void 0!=t.From.DesignerSettings&&void 0!=t.To.DesignerSettings&&t.From.DesignerSettings.Group!=e.graph.Settings.group&&t.To.DesignerSettings.Group!=e.graph.Settings.group||(t.DesignerSettings.X=void 0,t.DesignerSettings.Y=void 0)}),e.graph.Draw(e.graph.data),this.graph.StoreGraphData()}}},this.CopySelectedGenUniqueValue=function(e,t,i){for(var n=e,o=1;!0;o++){for(var r=!1,a=0;a<t.length;a++)if(t[a][i]==n){r=!0;break}if(!r)break;n=e+"_"+o}return n},this.CopySelected=function(){var t=this.graph.GetComponentByType("WorkflowDesignerActivityManager"),i=this.graph.GetComponentByType("WorkflowDesignerTransitionManager"),n=t.GetSelected(),o=i.GetSelected();if(0!=n.length||0!=o.length){var r=[];n.forEach(function(t){if(!t.group){var i=JSON.parse(JSON.stringify(t.item));i.DesignerSettings.Y+=160,i.Name=e.CopySelectedGenUniqueValue(i.Name,e.graph.data.Activities,"Name"),r.push({oldItem:t.item,newItem:i}),e.graph.data.Activities.push(i)}});var a=[];o.forEach(function(t){for(var i=t.item.From,n=t.item.To,o=0;o<r.length;o++)i==r[o].oldItem&&(i=r[o].newItem),n==r[o].oldItem&&(n=r[o].newItem);var s=JSON.parse(JSON.stringify(t.item));s.Name=e.CopySelectedGenUniqueValue(s.Name,e.graph.data.Transitions,"Name"),s.From=i,s.To=n,a.push({oldItem:t.item,newItem:s}),e.graph.data.Transitions.push(s)}),WorkflowDesignerCommon.DataCorrection(e.graph.data),e.graph.Draw(e.graph.data),r.forEach(function(e){t.SelectByItem(e.newItem)}),a.forEach(function(e){i.SelectByItem(e.newItem)}),this.graph.StoreGraphData(),this.graph.onSelectionChanged(!0)}},this.EditLocalization=function(){var e=this,t=WorkflowDesignerConstants.LocalizationFormLabel,i={type:"table",title:t.Title,width:"800px",data:this.graph.data.Localization,datadefault:{Culture:WorkflowDesignerConstants.DefaultCulture,Type:"State"},elements:[{name:t.ObjectName,field:"ObjectName",type:"input"},{name:t.Type,field:"Type",type:"select",displayfield:"Name",valuefield:"Value",datasource:[{Name:t.Types[0],Value:"Command"},{Name:t.Types[1],Value:"State"},{Name:t.Types[2],Value:"Parameter"}]},{name:t.IsDefault,field:"IsDefault",type:"checkbox"},{name:t.Culture,field:"Culture",type:"input"},{name:t.Value,field:"Value",type:"input"}],readonly:this.graph.Settings.readonly,saveFunc:function(t){e.SyncTable(e.graph.data.Localization,t,i),e.graph.StoreGraphData()}};if(void 0!=this.graph.Settings.forms&&void 0!=this.graph.Settings.forms.localization)return void this.graph.Settings.forms.localization(i);var n=new WorkflowDesignerForm(i),o=function(e,t){return!(!n.CheckRequired(e,["ObjectName","Type","Culture","Value"],WorkflowDesignerConstants.FieldIsRequired)||!n.CheckUnique(e,["ObjectName","Type","Culture"],WorkflowDesignerConstants.FieldMustBeUnique))&&(n.ClearTempField(e),n.parameters.saveFunc(e),!0)};n.showModal(o)},this.EditParameters=function(){var e=WorkflowDesignerConstants.ParameterFormLabel,t=this,i=function(e,i,n){for(var o=void 0,r=e.getEditData(e.parameters),a=0;a<r.length;a++){var s=r[a];if(s.control_InitialValue.id===i.id){o=s.Type;break}}void 0!=o&&t.graph.designer.getemptytype(encodeURIComponent(o),n)},n={type:"table",title:e.Title,data:this.graph.data.Parameters,datadefault:{Purpose:"Persistence"},keyproperty:"Name",elements:[{name:e.Name,field:"Name",type:"input"},{name:e.Type,field:"Type",type:"input",datasource:this.graph.getTypeNames(),width:"35%"},{name:e.Purpose,field:"Purpose",type:"select",displayfield:"Name",datasource:[{Name:"Temporary"},{Name:"Persistence"},{Name:"System"}]},{name:e.InitialValue,field:"InitialValue",type:"json",width:"25%",getemptytype:i}],top:$('<div style="float: right; margin-bottom: 15px;"></div>'),beforerowadded:function(e){void 0!=e.Type&&(e.Type=decodeURIComponent(e.Type))},onrowadded:function(e){var t=e.find("[name=Purpose]"),i=t[0].firstChild;t.change(function(){a(e)}),void 0!=i&&"System"!==i.value&&e.find('[name=Purpose] option[value="System"]').remove(),a(e)},graph:t.graph,readonly:this.graph.Settings.readonly,saveFunc:function(e){t.SyncTable(t.graph.data.Parameters,e,n);for(var i=0;i<t.graph.data.Parameters.length;i++){var o=t.graph.data.Parameters[i].Type;t.graph.data.Parameters[i].Type=encodeURIComponent(o)}t.graph.Draw(t.graph.data),t.graph.StoreGraphData()},cancelFunc:function(e){for(var i=0;i<t.graph.data.Parameters.length;i++){var n=t.graph.data.Parameters[i].Type;t.graph.data.Parameters[i].Type=encodeURIComponent(n)}}};if(void 0!=this.graph.Settings.forms&&void 0!=this.graph.Settings.forms.parameters)return void this.graph.Settings.forms.parameters(n);var o=function(){for(var e=$(c.window.find(".WorkflowDesignerTable"))[0],t=0;t<e.rows.length;t++){var i=$(e.rows[t]),n=i.find("[name=Purpose]")[0];void 0!=n&&(n=n.firstChild),void 0!=n&&"System"===n.value&&i.hide()}},r=function(){for(var e=$(c.window.find(".WorkflowDesignerTable"))[0],t=0;t<e.rows.length;t++){var i=$(e.rows[t]),n=i.find("[name=Purpose]")[0];void 0!=n&&(n=n.firstChild),void 0!=n&&"System"===n.value&&i.show()}},a=function(e){var t=e.find("[name=Purpose]")[0];void 0!=t&&(t=t.firstChild),void 0!=t&&"System"===t.value?(e.find(":input").attr("readonly",!0),e.find("[name=Purpose]").addClass("disabled"),e.find("[name=InitialValue]").val(""),e.find(".btnDelete").remove()):void 0!=t&&"Temporary"===t.value?(e.find("[name=InitialValue]").attr("readonly",!0),e.find("[name=InitialValue]").val("")):void 0!=t&&"Persistence"===t.value&&e.find("[name=InitialValue]").attr("readonly",!1)},s=function(){for(var e=$(c.window.find(".WorkflowDesignerTable"))[0],t=0;t<e.rows.length;t++){a($(e.rows[t]))}},l=function(e,t){return!(!c.CheckRequired(e,["Name","Type","Purpose","Parameter"],WorkflowDesignerConstants.FieldIsRequired)||!c.CheckUnique(e,["Name"],WorkflowDesignerConstants.FieldMustBeUnique))&&(c.ClearTempField(e),c.parameters.saveFunc(e),!0)},d=function(e,t){c.parameters.cancelFunc(e)},c=new WorkflowDesignerForm(n),h=$('<div class="ui slider checkbox"></div>'),u=$('<input type="checkbox" />');u.click(function(e,t){u[0].checked?r():o(),WorkflowDesignerCommon.modal(c.window,"refresh")}),h.append(u),h.append("<label>"+WorkflowDesignerConstants.ParameterFormLabel.ShowSystemParameters+"</label>"),n.top.append(h),c.showModal(l,!1,d),o(),s(),WorkflowDesignerCommon.modal(c.window,"refresh")},this.getGlobalCodeActionsForDelete=function(e,t){var i=[];return e.forEach(function(n){if(n.IsGlobal){for(var o=!1,r=0;r<e.length;r++)if(n.Name==e[r].Name&&n.IsGlobal!=e[r].IsGlobal){o=!0;break}for(var a=!1,r=0;r<t.length;r++)if(1==o){if(n.Name==t[r].Name&&t[r].IsGlobal){a=!0;break}}else if(n.Name==t[r].Name){a=!0;break}0==a&&i.push(n.Name)}}),i},this._prepareTempTagsToEditing=function(){var e=this,t=function(){var t=e.graph.data.Tags;return t&&0!=t.length?t.reduce(function(e,t){return e+","+t}):""};e.graph.data._tempTagsAsStr={tagsAsStr:t()}},this._updateTags=function(e){if(!e)return void(this.graph.data.Tags=[]);this.graph.data.Tags=e.split(",")},this.EditDefinitionProcessInfo=function(){var e=WorkflowDesignerConstants.ProcessInfoFormLabel,t=this;t._prepareTempTagsToEditing();var i={type:"form",title:e.TagsTabName,width:"95%",readonly:!1,graph:t.graph,data:t.graph.data._tempTagsAsStr,elements:[{name:e.TagsLabel,field:"tagsAsStr",type:"input"}]},n=new WorkflowDesignerForm(i),o=function(e){return t.graph.data._tempTagsAsStr=e.tagsAsStr,t._updateTags(e.tagsAsStr),t.graph.StoreGraphData(),!0};n.showModal(o)},this.EditProcessInfo=function(){function e(e){return $.extend({type:"table",elements:[{name:r.ParametersNameLabel,field:"Name",type:"input"},{name:r.ParametersValueLabel,field:"Value",type:"json"}]},e)}function t(e,t,i){$.each(i,function(i,n){"System"===n.Purpose?e.push(n):t.push(n)})}function i(){return a?{type:"accordion",data:s.systemParameters,elements:[e({name:r.SystemParametersTabName})]}:e({data:s.systemParameters,name:r.SystemParametersTabName})}function n(){return a?{type:"accordion",name:r.ProcessParametersTabName,data:s.processParameters,tabKey:"ProcessParameters",elements:[e(null)]}:e({data:s.processParameters,name:r.ProcessParametersTabName,tabKey:"ProcessParameters"})}function o(e,t,i,n){function o(e,t){return $.extend({type:"table",elements:e},t)}if(a){var s={};return s[r.RootProcess]=l.graph.data.AdditionalParams[e],$.each(l.graph.data.AdditionalParams.SubprocessInfo,function(t,i){s[t]=i[e]}),{type:"accordion",name:t,data:s,tabKey:i,elements:[o(n,null)]}}return o(n,{data:l.graph.data.AdditionalParams[e],name:t,tabKey:i})}var r=WorkflowDesignerConstants.ProcessInfoFormLabel,a=this.graph.data.AdditionalParams.SubprocessCurrentActivities.length,s={systemParameters:{},processParameters:{}};a?(s.systemParameters[r.RootProcess]=new Array,s.processParameters[r.RootProcess]=new Array,t(s.systemParameters[r.RootProcess],s.processParameters[r.RootProcess],this.graph.data.AdditionalParams.ProcessParameters),$.each(this.graph.data.AdditionalParams.SubprocessInfo,function(e,i){s.systemParameters[e]=new Array,s.processParameters[e]=new Array,t(s.systemParameters[e],s.processParameters[e],i.ProcessParameters)})):(s.systemParameters=new Array,s.processParameters=new Array,t(s.systemParameters,s.processParameters,this.graph.data.AdditionalParams.ProcessParameters));var l=this;l._prepareTempTagsToEditing();var d={type:"tabs",title:r.Title,width:"95%",readonly:!0,graph:l.graph,elements:[{name:r.SystemParametersTabName,type:"form",tabKey:"SystemParameters",data:this.graph.data.AdditionalParams,elements:[{name:r.IsObsolete,field:"IsObsolete",type:"checkbox"},{name:r.DefiningParameters,field:"DefiningParameters",type:"textarea"},i()]},n(),o("ProcessHistory",r.HistoryTabName,"History",[{name:r.HistoryTabFromLabel,field:"FromActivityName",type:"input"},{name:r.HistoryTabFromStateLabel,field:"FromStateName",type:"input"},{name:r.HistoryTabToLabel,field:"ToActivityName",type:"input"},{name:r.HistoryTabToStateLabel,field:"ToStateName",type:"input"},{name:r.HistoryTabExecutorIdLabel,field:"ExecutorIdentityId",type:"input"},{name:r.HistoryTabActorIdLabel,field:"ActorIdentityId",type:"input"},{name:r.HistoryTabTimeLabel,field:"TransitionTime",type:"input"},{name:r.HistoryTabTriggerNameLabel,field:"TriggerName",type:"input"},{name:r.HistoryTabTransitionClassifierNameLabel,field:"TransitionClassifier",type:"transitionclassifier"}]),o("ProcessTimers",r.TimersTabName,"Timers",[{name:r.TimersTabNameLabel,field:"Name",type:"input"},{name:r.TimersTabValueLabel,field:"NextExecutionDateTime",type:"input"}]),{name:r.TagsTabName,type:"form",tabKey:"Tags",data:this.graph.data._tempTagsAsStr,elements:[{name:r.TagsLabel,field:"tagsAsStr",type:"input"}]}]};if(void 0!=this.graph.Settings.forms&&void 0!=this.graph.Settings.forms.processinfo)return void this.graph.Settings.forms.processinfo(d);var c=new WorkflowDesignerForm(d),h=function(e,t){return!0};c.showModal(h)},this.Items={First:[],Second:[],Third:[]},this.SideItems=[],this.InitItems=function(){var t=this.graph.Settings.imagefolder;if(this.graph.Settings.readonly||(this.Items.First.push({code:"undo",title:WorkflowDesignerConstants.ToolbarLabel.Undo,img:t+"wfe.undo.png",click:function(){e.graph.Undo()}}),this.Items.First.push({code:"redo",title:WorkflowDesignerConstants.ToolbarLabel.Redo,img:t+"wfe.redo.png",click:function(){e.graph.Redo()}}),this.Items.First.push({separator:!0}),this.Items.First.push({title:WorkflowDesignerConstants.ToolbarLabel.CreateActivity,img:t+"wfe.add.png",click:function(){e.CreateActivity()}}),this.Items.First.push({title:WorkflowDesignerConstants.ToolbarLabel.CreateInline,img:t+"wfe.inline.png",click:function(){e.CreateInline()}}),this.Items.First.push({code:"copy",disabled:!0,title:WorkflowDesignerConstants.ToolbarLabel.CopySelected,img:t+"wfe.copy.png",click:function(){e.CopySelected()}}),this.Items.First.push({code:"delete",disabled:!0,title:WorkflowDesignerConstants.ToolbarLabel.Delete,img:t+"wfe.remove.png",click:function(){e.graph.DeleteSelected()}})),!this.graph.Settings.hideElementsToolbar&&!this.graph.Settings.notshowwindows){this.Items.Second.push({title:WorkflowDesignerConstants.ToolbarLabel.Actors,img:t+"wfe.actors.png",click:function(){WorkflowDesignerWindows.EditActors(e)}}),this.Items.Second.push({title:WorkflowDesignerConstants.ToolbarLabel.Commands,img:t+"wfe.commands.png",click:function(){WorkflowDesignerWindows.EditCommands(e)}}),this.Items.Second.push({title:WorkflowDesignerConstants.ToolbarLabel.Timers,img:t+"wfe.timers.png",click:function(){WorkflowDesignerWindows.EditTimer(e)}}),this.graph.Settings.disableCodeActions!==!0&&this.Items.Second.push({title:WorkflowDesignerConstants.ToolbarLabel.CodeActions,img:t+"wfe.codeactions.png",click:function(){WorkflowDesignerWindows.EditCodeActions(e)}}),this.Items.Second.push({title:WorkflowDesignerConstants.ToolbarLabel.Parameters,img:t+"wfe.parameters.png",click:function(){e.EditParameters()}}),this.Items.Second.push({title:WorkflowDesignerConstants.ToolbarLabel.Localization,img:t+"wfe.localization.png",click:function(){e.EditLocalization()}});var i=!(this.graph.designer&&this.graph.designer.data&&this.graph.designer.data.AdditionalParams&&this.graph.designer.data.AdditionalParams.ProcessParameters);this.Items.Second.push({title:WorkflowDesignerConstants.ToolbarLabel.ProcessInfo,img:t+"wfe.context.png",click:function(){
i?e.EditDefinitionProcessInfo():e.EditProcessInfo()}})}this.graph.Settings.readonly||this.Items.Second.push({code:"inline",title:WorkflowDesignerConstants.ToolbarLabel.Inline,img:t+"wfe.inline.off.png",img2:t+"wfe.inline.on.png",click:function(){e.ToolbarInlinePress()}}),void 0!=this.graph.Settings.apiurl&&this.Items.Third.push({title:WorkflowDesignerConstants.ToolbarLabel.Refresh,img:t+"wfe.refresh.png",click:function(){e.graph.Refresh()}}),this.graph.Settings.disableobjectmovements||this.Items.Third.push({title:WorkflowDesignerConstants.ToolbarLabel.AutoArrangement,img:t+"wfe.autoarrangment.png",click:function(){e.AutoArrangement()}}),this.Items.Third.length>0&&this.Items.Third.push({separator:!0}),this.Items.Third.push({code:"exinfo",title:WorkflowDesignerConstants.ToolbarLabel.Info,img:t+"wfe.information.png",click:function(){e.ToolbarExInfoPress()}}),this.graph.Settings.hideLegend||this.Items.Third.push({title:WorkflowDesignerConstants.ToolbarLabel.Legend,img:t+"wfe.help.png",click:function(){e.ShowLegend()}}),this.SideItems=[{code:"move",title:WorkflowDesignerConstants.ToolbarLabel.Move,img:t+"wfe.move.png",click:function(){e.ToolbarMovePress()}},{separator:!0}],void 0==this.graph.Settings.group&&this.SideItems.push({code:"fullscreen",title:WorkflowDesignerConstants.ToolbarLabel.FullScreen,img:t+"wfe.fullscreen.png",click:function(){e.graph.onFullScreenClick()}}),this.SideItems.push({title:WorkflowDesignerConstants.ToolbarLabel.ZoomPositionDefault,img:t+"wfe.defaultzoom.png",click:function(){e.graph.GraphLayerScaleNorm()}}),this.SideItems.push({title:WorkflowDesignerConstants.ToolbarLabel.ZoomIn,img:t+"wfe.zoomin.png",click:function(){e.graph.GraphLayerScale(.1)}}),this.SideItems.push({title:WorkflowDesignerConstants.ToolbarLabel.ZoomOut,img:t+"wfe.zoomout.png",click:function(){e.graph.GraphLayerScale(-.1)}}),e.graph.Stage.getContent().addEventListener("wheel",function(t){var i=e.GetWorkflowDesignerBackground(),n=i.BackgroundLayer.scaleX(),o={x:t.offsetX/n-i.RectBG.x(),y:t.offsetY/n-i.RectBG.y()},r=t.deltaY>0?-.1:.1,a=n+r,s={x:o.x-o.x/a,y:o.y-o.y/a},l={x:((1-n)*t.offsetX/n-i.RectBG.x())/a,y:((1-n)*t.offsetY/n-i.RectBG.y())/a};s.x+=l.x,s.y+=l.y,e.graph.GraphLayerScale(r,s)})},this.LayerScaleNorm=function(e){this.updateScaleText(e)},this.LayerScale=function(e){var t=e.scale,i=e.delta;this.updateScaleText(t+i)},this.updateScaleText=function(t){void 0!=e.graph._bg&&this.scaleText.text(Math.floor(100*t)+"%")},this.GetItemByCode=function(e){for(var t in this.Items)for(var i=0;i<this.Items[t].length;i++){var n=this.Items[t][i];if(n.code==e)return n}for(var i=0;i<this.SideItems.length;i++){var n=this.SideItems[i];if(n.code==e)return n}},this.SyncTable=function(e,t,i){if(void 0==i.keyproperty){e.splice(0,e.length);for(var n=0;n<t.length;n++){var o={};i.elements.forEach(function(e){o[e.field]=t[n][e.field]}),e.push(o)}}else{for(var n=e.length-1;n>=0;n--){var r=$.grep(t,function(t){return e[n][i.keyproperty]==t.keyproperty});0==r.length?e.splice(n,1):i.elements.forEach(function(t){e[n][t.field]=r[0][t.field]})}for(var n=0;n<t.length;n++){var r=$.grep(e,function(e){return t[n][i.keyproperty]==e[i.keyproperty]});if(0==r.length){var o={};i.elements.forEach(function(e){o[e.field]=t[n][e.field]}),e.push(o)}}}},this.ShowLegend=function(){if(void 0!=this.graph.Settings.forms&&void 0!=this.graph.Settings.forms.legend)return void this.graph.Settings.forms.legend();var e=this.graph.Settings.imagefolder,t=$('<image src="'+e+'wfe.legend.png" height="'+.7*this.graph.Stage.getHeight()+'"/>'),i=$('<div class="ui modal"></div>').append($('<div class="content" style="text-align: center;"></div>').append(t));WorkflowDesignerCommon.modal(i,"show"),WorkflowDesignerCommon.modal(i,"refresh")},this.setItemDisabled=function(e,t){for(var i in this.Items)for(var n=0;n<this.Items[i].length;n++){var o=this.Items[i][n];if(o.code==e){o.disabled=t,void 0!=o.cImageToolbar&&o.cImageToolbar.opacity(t?.3:1);break}}for(var n=0;n<this.SideItems.length;n++)if(this.SideItems[n].code==e){this.SideItems[n].disabled=t,void 0!=this.Items[n].cImageToolbar&&this.Items[n].cImageToolbar.opacity(t?.3:1);break}},this.setItemActive=function(e,t){for(var i in this.Items)for(var n=0;n<this.Items[i].length;n++){var o=this.Items[i][n];if(o.code==e){o.active=t,void 0!=o.bg&&o.bg.setFill(t?WorkflowDesignerConstants.ButtonActive:"");break}}for(var n=0;n<this.SideItems.length;n++)if(this.SideItems[n].code==e){this.SideItems[n].active=t,void 0!=this.SideItems[n].bg&&this.SideItems[n].bg.setFill(t?WorkflowDesignerConstants.ButtonActive:"");break}},this.destroy=function(){this.Layer.destroyed=!0,void 0!==e&&(void 0!==e.Layer&&null!==e.Layer&&e.Layer.destroy(),e=void 0)}}function WorkflowDesignerKeyboard(){this.type="WorkflowDesignerKeyboard",this.init=function(e){this.graph=e,this.subscribe()},this.destroy=function(){this.unsubscribe()},this.subscribe=function(){var e=this.graph.container,t=$("#"+e);this.ev=!1;var i=this;t.on("mouseover",function(){i.ev=!0}),t.on("mouseout",function(){i.ev=!1}),this._keyProcessing=function(e){i.keyProcessing(e)},document.addEventListener("keydown",this._keyProcessing,!1)},this.unsubscribe=function(){var e=this.graph.container,t=document.getElementById(e);void 0!=t&&(t.onmouseover=void 0,t.onmouseout=void 0),document.removeEventListener("keydown",this._keyProcessing)},this.keyProcessing=function(e){if(this.ev!==!1){var t=e.key;if("Control"!==t){var i=!1;return e.ctrlKey?"a"==t?this.graph.SelectAll():"c"==t?this.toolbarExec("CopySelected"):"e"!=t||this.graph.Settings.readonly?"i"==t?this.toolbarExec("ToolbarExInfoPress"):"m"==t?this.toolbarExec("ToolbarMovePress"):"y"!=t||this.graph.Settings.readonly?"z"!=t||this.graph.Settings.readonly?i=!0:this.graph.Undo():this.graph.Redo():this.toolbarExec("CreateActivity"):e.altKey&&"Enter"==t?this.graph.onFullScreenClick():"Delete"!=t||this.graph.Settings.readonly?"ArrowUp"==t?this.objectsMove(0,-1):"ArrowDown"==t?this.objectsMove(0,1):"ArrowLeft"==t?this.objectsMove(-1,0):"ArrowRight"==t?this.objectsMove(1,0):i=!0:this.graph.DeleteSelected(),0==i?void e.preventDefault():void 0}}},this.objectsMove=function(e,t){var i=this.graph.GetComponentByType("WorkflowDesignerActivityManager");if(void 0!=i){var n=this.graph.Settings.DefaultMoveStep;0==i.GetSelected().length?this.graph.GraphUpdatePosition({x:e*n,y:t*n}):(i.ObjectMove({changepos:{x:e*n,y:t*n}}),i.batchDraw())}},this.toolbarExec=function(e){var t=this.graph.GetComponentByType("WorkflowDesignerToolbar");void 0!=t&&void 0!=t[e]&&t[e]()}}ace.define("ace/snippets",["require","exports","module","ace/lib/oop","ace/lib/event_emitter","ace/lib/lang","ace/range","ace/range_list","ace/keyboard/hash_handler","ace/tokenizer","ace/clipboard","ace/lib/dom","ace/editor"],function(e,t,i){"use strict";function n(e){var t=(new Date).toLocaleString("en-us",e);return 1==t.length?"0"+t:t}var o=e("./lib/oop"),r=e("./lib/event_emitter").EventEmitter,a=e("./lib/lang"),s=e("./range").Range,l=e("./range_list").RangeList,d=e("./keyboard/hash_handler").HashHandler,c=e("./tokenizer").Tokenizer,h=e("./clipboard"),u={CURRENT_WORD:function(e){return e.session.getTextRange(e.session.getWordRange())},SELECTION:function(e,t,i){var n=e.session.getTextRange();return i?n.replace(/\n\r?([ \t]*\S)/g,"\n"+i+"$1"):n},CURRENT_LINE:function(e){return e.session.getLine(e.getCursorPosition().row)},PREV_LINE:function(e){return e.session.getLine(e.getCursorPosition().row-1)},LINE_INDEX:function(e){return e.getCursorPosition().row},LINE_NUMBER:function(e){return e.getCursorPosition().row+1},SOFT_TABS:function(e){return e.session.getUseSoftTabs()?"YES":"NO"},TAB_SIZE:function(e){return e.session.getTabSize()},CLIPBOARD:function(e){return h.getText&&h.getText()},FILENAME:function(e){return/[^\/\\]*$/.exec(this.FILEPATH(e))[0]},FILENAME_BASE:function(e){return/[^\/\\]*$/.exec(this.FILEPATH(e))[0].replace(/\.[^.]*$/,"")},DIRECTORY:function(e){return this.FILEPATH(e).replace(/[^\/\\]*$/,"")},FILEPATH:function(e){return"/not implemented.txt"},WORKSPACE_NAME:function(){return"Unknown"},FULLNAME:function(){return"Unknown"},BLOCK_COMMENT_START:function(e){var t=e.session.$mode||{};return t.blockComment&&t.blockComment.start||""},BLOCK_COMMENT_END:function(e){var t=e.session.$mode||{};return t.blockComment&&t.blockComment.end||""},LINE_COMMENT:function(e){return(e.session.$mode||{}).lineCommentStart||""},CURRENT_YEAR:n.bind(null,{year:"numeric"}),CURRENT_YEAR_SHORT:n.bind(null,{year:"2-digit"}),CURRENT_MONTH:n.bind(null,{month:"numeric"}),CURRENT_MONTH_NAME:n.bind(null,{month:"long"}),CURRENT_MONTH_NAME_SHORT:n.bind(null,{month:"short"}),CURRENT_DATE:n.bind(null,{day:"2-digit"}),CURRENT_DAY_NAME:n.bind(null,{weekday:"long"}),CURRENT_DAY_NAME_SHORT:n.bind(null,{weekday:"short"}),CURRENT_HOUR:n.bind(null,{hour:"2-digit",hour12:!1}),CURRENT_MINUTE:n.bind(null,{minute:"2-digit"}),CURRENT_SECOND:n.bind(null,{second:"2-digit"})};u.SELECTED_TEXT=u.SELECTION;var m=function(){this.snippetMap={},this.snippetNameMap={}};(function(){o.implement(this,r),this.getTokenizer=function(){return m.$tokenizer||this.createTokenizer()},this.createTokenizer=function(){function e(e){return e=e.substr(1),/^\d+$/.test(e)?[{tabstopId:parseInt(e,10)}]:[{text:e}]}function t(e){return"(?:[^\\\\"+e+"]|\\\\.)"}var i={regex:"/("+t("/")+"+)/",onMatch:function(e,t,i){var n=i[0];return n.fmtString=!0,n.guard=e.slice(1,-1),n.flag="",""},next:"formatString"};return m.$tokenizer=new c({start:[{regex:/\\./,onMatch:function(e,t,i){var n=e[1];return"}"==n&&i.length?e=n:"`$\\".indexOf(n)!=-1&&(e=n),[e]}},{regex:/}/,onMatch:function(e,t,i){return[i.length?i.shift():e]}},{regex:/\$(?:\d+|\w+)/,onMatch:e},{regex:/\$\{[\dA-Z_a-z]+/,onMatch:function(t,i,n){var o=e(t.substr(1));return n.unshift(o[0]),o},next:"snippetVar"},{regex:/\n/,token:"newline",merge:!1}],snippetVar:[{regex:"\\|"+t("\\|")+"*\\|",onMatch:function(e,t,i){var n=e.slice(1,-1).replace(/\\[,|\\]|,/g,function(e){return 2==e.length?e[1]:"\0"}).split("\0");return i[0].choices=n,[n[0]]},next:"start"},i,{regex:"([^:}\\\\]|\\\\.)*:?",token:"",next:"start"}],formatString:[{regex:/:/,onMatch:function(e,t,i){return i.length&&i[0].expectElse?(i[0].expectElse=!1,i[0].ifEnd={elseEnd:i[0]},[i[0].ifEnd]):":"}},{regex:/\\./,onMatch:function(e,t,i){var n=e[1];return"}"==n&&i.length?e=n:"`$\\".indexOf(n)!=-1?e=n:"n"==n?e="\n":"t"==n?e="\t":"ulULE".indexOf(n)!=-1&&(e={changeCase:n,local:n>"a"}),[e]}},{regex:"/\\w*}",onMatch:function(e,t,i){var n=i.shift();return n&&(n.flag=e.slice(1,-1)),this.next=n&&n.tabstopId?"start":"",[n||e]},next:"start"},{regex:/\$(?:\d+|\w+)/,onMatch:function(e,t,i){return[{text:e.slice(1)}]}},{regex:/\${\w+/,onMatch:function(e,t,i){var n={text:e.slice(2)};return i.unshift(n),[n]},next:"formatStringVar"},{regex:/\n/,token:"newline",merge:!1},{regex:/}/,onMatch:function(e,t,i){var n=i.shift();return this.next=n&&n.tabstopId?"start":"",[n||e]},next:"start"}],formatStringVar:[{regex:/:\/\w+}/,onMatch:function(e,t,i){return i[0].formatFunction=e.slice(2,-1),[i.shift()]},next:"formatString"},i,{regex:/:[\?\-+]?/,onMatch:function(e,t,i){"+"==e[1]&&(i[0].ifEnd=i[0]),"?"==e[1]&&(i[0].expectElse=!0)},next:"formatString"},{regex:"([^:}\\\\]|\\\\.)*:?",token:"",next:"formatString"}]}),m.$tokenizer},this.tokenizeTmSnippet=function(e,t){return this.getTokenizer().getLineTokens(e,t).tokens.map(function(e){return e.value||e})},this.getVariableValue=function(e,t,i){if(/^\d+$/.test(t))return(this.variables.__||{})[t]||"";if(/^[A-Z]\d+$/.test(t))return(this.variables[t[0]+"__"]||{})[t.substr(1)]||"";if(t=t.replace(/^TM_/,""),!this.variables.hasOwnProperty(t))return"";var n=this.variables[t];return"function"==typeof n&&(n=this.variables[t](e,t,i)),null==n?"":n},this.variables=u,this.tmStrFormat=function(e,t,i){if(!t.fmt)return e;var n=t.flag||"",o=t.guard;o=new RegExp(o,n.replace(/[^gim]/g,""));var r="string"==typeof t.fmt?this.tokenizeTmSnippet(t.fmt,"formatString"):t.fmt,a=this;return e.replace(o,function(){var e=a.variables.__;a.variables.__=[].slice.call(arguments);for(var t=a.resolveVariables(r,i),n="E",o=0;o<t.length;o++){var s=t[o];if("object"==typeof s)if(t[o]="",s.changeCase&&s.local){var l=t[o+1];l&&"string"==typeof l&&("u"==s.changeCase?t[o]=l[0].toUpperCase():t[o]=l[0].toLowerCase(),t[o+1]=l.substr(1))}else s.changeCase&&(n=s.changeCase);else"U"==n?t[o]=s.toUpperCase():"L"==n&&(t[o]=s.toLowerCase())}return a.variables.__=e,t.join("")})},this.tmFormatFunction=function(e,t,i){return"upcase"==t.formatFunction?e.toUpperCase():"downcase"==t.formatFunction?e.toLowerCase():e},this.resolveVariables=function(e,t){function i(t){var i=e.indexOf(t,a+1);i!=-1&&(a=i)}for(var n=[],o="",r=!0,a=0;a<e.length;a++){var s=e[a];if("string"!=typeof s){if(s){if(r=!1,s.fmtString){var l=e.indexOf(s,a+1);l==-1&&(l=e.length),s.fmt=e.slice(a+1,l),a=l}if(s.text){var d=this.getVariableValue(t,s.text,o)+"";s.fmtString&&(d=this.tmStrFormat(d,s,t)),s.formatFunction&&(d=this.tmFormatFunction(d,s,t)),d&&!s.ifEnd?(n.push(d),i(s)):!d&&s.ifEnd&&i(s.ifEnd)}else s.elseEnd?i(s.elseEnd):null!=s.tabstopId?n.push(s):null!=s.changeCase&&n.push(s)}}else n.push(s),"\n"==s?(r=!0,o=""):r&&(o=/^\t*/.exec(s)[0],r=/\S/.test(s))}return n},this.insertSnippetForSelection=function(e,t){function i(e){for(var t=[],i=0;i<e.length;i++){var n=e[i];if("object"==typeof n){if(d[n.tabstopId])continue;n=t[e.lastIndexOf(n,i-1)]||{tabstopId:n.tabstopId}}t[i]=n}return t}var n=e.getCursorPosition(),o=e.session.getLine(n.row),r=e.session.getTabString(),a=o.match(/^\s*/)[0];n.column<a.length&&(a=a.slice(0,n.column)),t=t.replace(/\r/g,"");var s=this.tokenizeTmSnippet(t);s=this.resolveVariables(s,e),s=s.map(function(e){return"\n"==e?e+a:"string"==typeof e?e.replace(/\t/g,r):e});var l=[];s.forEach(function(e,t){if("object"==typeof e){var i=e.tabstopId,n=l[i];if(n||(n=l[i]=[],n.index=i,n.value="",n.parents={}),n.indexOf(e)===-1){e.choices&&!n.choices&&(n.choices=e.choices),n.push(e);var o=s.indexOf(e,t+1);if(o!==-1){var r=s.slice(t+1,o);r.some(function(e){return"object"==typeof e})&&!n.value?n.value=r:!r.length||n.value&&"string"==typeof n.value||(n.value=r.join(""))}}}}),l.forEach(function(e){e.length=0});for(var d={},c=0;c<s.length;c++){var h=s[c];if("object"==typeof h){var u=h.tabstopId,m=l[u],f=s.indexOf(h,c+1);if(d[u])d[u]===h&&(delete d[u],Object.keys(d).forEach(function(e){m.parents[e]=!0}));else{d[u]=h;var p=m.value;"string"!=typeof p?p=i(p):h.fmt&&(p=this.tmStrFormat(p,h,e)),s.splice.apply(s,[c+1,Math.max(0,f-c)].concat(p,h)),m.indexOf(h)===-1&&m.push(h)}}}var v=0,y=0,w="";s.forEach(function(e){if("string"==typeof e){var t=e.split("\n");t.length>1?(y=t[t.length-1].length,v+=t.length-1):y+=e.length,w+=e}else e&&(e.start?e.end={row:v,column:y}:e.start={row:v,column:y})});var b=e.getSelectionRange(),C=e.session.replace(b,w),S=new g(e),k=e.inVirtualSelectionMode&&e.selection.index;S.addTabstops(l,b.start,C,k)},this.insertSnippet=function(e,t){var i=this;if(e.inVirtualSelectionMode)return i.insertSnippetForSelection(e,t);e.forEachSelection(function(){i.insertSnippetForSelection(e,t)},null,{keepOrder:!0}),e.tabstopManager&&e.tabstopManager.tabNext()},this.$getScope=function(e){var t=e.session.$mode.$id||"";if(t=t.split("/").pop(),"html"===t||"php"===t){"php"!==t||e.session.$mode.inlinePhp||(t="html");var i=e.getCursorPosition(),n=e.session.getState(i.row);"object"==typeof n&&(n=n[0]),n.substring&&("js-"==n.substring(0,3)?t="javascript":"css-"==n.substring(0,4)?t="css":"php-"==n.substring(0,4)&&(t="php"))}return t},this.getActiveScopes=function(e){var t=this.$getScope(e),i=[t],n=this.snippetMap;return n[t]&&n[t].includeScopes&&i.push.apply(i,n[t].includeScopes),i.push("_"),i},this.expandWithTab=function(e,t){var i=this,n=e.forEachSelection(function(){return i.expandSnippetForSelection(e,t)},null,{keepOrder:!0});return n&&e.tabstopManager&&e.tabstopManager.tabNext(),n},this.expandSnippetForSelection=function(e,t){var i,n=e.getCursorPosition(),o=e.session.getLine(n.row),r=o.substring(0,n.column),a=o.substr(n.column),s=this.snippetMap;return this.getActiveScopes(e).some(function(e){var t=s[e];return t&&(i=this.findMatchingSnippet(t,r,a)),!!i},this),!!i&&(!(!t||!t.dryRun)||(e.session.doc.removeInLine(n.row,n.column-i.replaceBefore.length,n.column+i.replaceAfter.length),this.variables.M__=i.matchBefore,this.variables.T__=i.matchAfter,this.insertSnippetForSelection(e,i.content),this.variables.M__=this.variables.T__=null,!0))},this.findMatchingSnippet=function(e,t,i){for(var n=e.length;n--;){var o=e[n];if((!o.startRe||o.startRe.test(t))&&(!o.endRe||o.endRe.test(i))&&(o.startRe||o.endRe))return o.matchBefore=o.startRe?o.startRe.exec(t):[""],o.matchAfter=o.endRe?o.endRe.exec(i):[""],o.replaceBefore=o.triggerRe?o.triggerRe.exec(t)[0]:"",o.replaceAfter=o.endTriggerRe?o.endTriggerRe.exec(i)[0]:"",o}},this.snippetMap={},this.snippetNameMap={},this.register=function(e,t){function i(e){return e&&!/^\^?\(.*\)\$?$|^\\b$/.test(e)&&(e="(?:"+e+")"),e||""}function n(e,t,n){return e=i(e),t=i(t),n?(e=t+e,e&&"$"!=e[e.length-1]&&(e+="$")):(e+=t,e&&"^"!=e[0]&&(e="^"+e)),new RegExp(e)}function o(e){e.scope||(e.scope=t||"_"),t=e.scope,r[t]||(r[t]=[],s[t]={});var i=s[t];if(e.name){var o=i[e.name];o&&l.unregister(o),i[e.name]=e}r[t].push(e),e.tabTrigger&&!e.trigger&&(!e.guard&&/^\w/.test(e.tabTrigger)&&(e.guard="\\b"),e.trigger=a.escapeRegExp(e.tabTrigger)),(e.trigger||e.guard||e.endTrigger||e.endGuard)&&(e.startRe=n(e.trigger,e.guard,!0),e.triggerRe=new RegExp(e.trigger),e.endRe=n(e.endTrigger,e.endGuard,!0),e.endTriggerRe=new RegExp(e.endTrigger))}var r=this.snippetMap,s=this.snippetNameMap,l=this;e||(e=[]),e&&e.content?o(e):Array.isArray(e)&&e.forEach(o),this._signal("registerSnippets",{scope:t})},this.unregister=function(e,t){function i(e){var i=o[e.scope||t];if(i&&i[e.name]){delete i[e.name];var r=n[e.scope||t],a=r&&r.indexOf(e);a>=0&&r.splice(a,1)}}var n=this.snippetMap,o=this.snippetNameMap;e.content?i(e):Array.isArray(e)&&e.forEach(i)},this.parseSnippetFile=function(e){e=e.replace(/\r/g,"");for(var t,i=[],n={},o=/^#.*|^({[\s\S]*})\s*$|^(\S+) (.*)$|^((?:\n*\t.*)+)/gm;t=o.exec(e);){if(t[1])try{n=JSON.parse(t[1]),i.push(n)}catch(e){}if(t[4])n.content=t[4].replace(/^\t/gm,""),i.push(n),n={};else{var r=t[2],a=t[3];if("regex"==r){var s=/\/((?:[^\/\\]|\\.)*)|$/g;n.guard=s.exec(a)[1],n.trigger=s.exec(a)[1],n.endTrigger=s.exec(a)[1],n.endGuard=s.exec(a)[1]}else"snippet"==r?(n.tabTrigger=a.match(/^\S*/)[0],n.name||(n.name=a)):n[r]=a}}return i},this.getSnippetByName=function(e,t){var i,n=this.snippetNameMap;return this.getActiveScopes(t).some(function(t){var o=n[t];return o&&(i=o[e]),!!i},this),i}}).call(m.prototype);var g=function(e){if(e.tabstopManager)return e.tabstopManager;e.tabstopManager=this,this.$onChange=this.onChange.bind(this),this.$onChangeSelection=a.delayedCall(this.onChangeSelection.bind(this)).schedule,this.$onChangeSession=this.onChangeSession.bind(this),this.$onAfterExec=this.onAfterExec.bind(this),this.attach(e)};(function(){this.attach=function(e){this.index=0,this.ranges=[],this.tabstops=[],this.$openTabstops=null,this.selectedTabstop=null,this.editor=e,this.editor.on("change",this.$onChange),this.editor.on("changeSelection",this.$onChangeSelection),this.editor.on("changeSession",this.$onChangeSession),this.editor.commands.on("afterExec",this.$onAfterExec),this.editor.keyBinding.addKeyboardHandler(this.keyboardHandler)},this.detach=function(){this.tabstops.forEach(this.removeTabstopMarkers,this),this.ranges=null,this.tabstops=null,this.selectedTabstop=null,this.editor.removeListener("change",this.$onChange),this.editor.removeListener("changeSelection",this.$onChangeSelection),this.editor.removeListener("changeSession",this.$onChangeSession),this.editor.commands.removeListener("afterExec",this.$onAfterExec),this.editor.keyBinding.removeKeyboardHandler(this.keyboardHandler),this.editor.tabstopManager=null,this.editor=null},this.onChange=function(e){for(var t="r"==e.action[0],i=this.selectedTabstop&&this.selectedTabstop.parents||{},n=(this.tabstops||[]).slice(),o=0;o<n.length;o++){var r=n[o],a=r==this.selectedTabstop||i[r.index];if(r.rangeList.$bias=a?0:1,"remove"==e.action&&r!==this.selectedTabstop){var s=r.parents&&r.parents[this.selectedTabstop.index],l=r.rangeList.pointIndex(e.start,s);l=l<0?-l-1:l+1;var d=r.rangeList.pointIndex(e.end,s);d=d<0?-d-1:d-1;for(var c=r.rangeList.ranges.slice(l,d),h=0;h<c.length;h++)this.removeRange(c[h])}r.rangeList.$onChange(e)}var u=this.editor.session;this.$inChange||!t||1!=u.getLength()||u.getValue()||this.detach()},this.updateLinkedFields=function(){var e=this.selectedTabstop;if(e&&e.hasLinkedRanges&&e.firstNonLinked){this.$inChange=!0;for(var i=this.editor.session,n=i.getTextRange(e.firstNonLinked),o=0;o<e.length;o++){var r=e[o];if(r.linked){var a=r.original,s=t.snippetManager.tmStrFormat(n,a,this.editor);i.replace(r,s)}}this.$inChange=!1}},this.onAfterExec=function(e){e.command&&!e.command.readOnly&&this.updateLinkedFields()},this.onChangeSelection=function(){if(this.editor){for(var e=this.editor.selection.lead,t=this.editor.selection.anchor,i=this.editor.selection.isEmpty(),n=0;n<this.ranges.length;n++)if(!this.ranges[n].linked){var o=this.ranges[n].contains(e.row,e.column),r=i||this.ranges[n].contains(t.row,t.column);if(o&&r)return}this.detach()}},this.onChangeSession=function(){this.detach()},this.tabNext=function(e){var t=this.tabstops.length,i=this.index+(e||1);i=Math.min(Math.max(i,1),t),i==t&&(i=0),this.selectTabstop(i),0===i&&this.detach()},this.selectTabstop=function(e){this.$openTabstops=null;var t=this.tabstops[this.index];if(t&&this.addTabstopMarkers(t),this.index=e,t=this.tabstops[this.index],t&&t.length){this.selectedTabstop=t;var i=t.firstNonLinked||t;if(this.editor.inVirtualSelectionMode)this.editor.selection.setRange(i);else{var n=this.editor.multiSelect;n.toSingleRange(i.clone());for(var o=0;o<t.length;o++)t.hasLinkedRanges&&t[o].linked||n.addRange(t[o].clone(),!0);n.ranges[0]&&n.addRange(n.ranges[0].clone())}this.editor.keyBinding.addKeyboardHandler(this.keyboardHandler),this.selectedTabstop&&this.selectedTabstop.choices&&this.editor.execCommand("startAutocomplete",{matches:this.selectedTabstop.choices})}},this.addTabstops=function(e,t,i){var n=this.useLink||!this.editor.getOption("enableMultiselect");if(this.$openTabstops||(this.$openTabstops=[]),!e[0]){var o=s.fromPoints(i,i);p(o.start,t),p(o.end,t),e[0]=[o],e[0].index=0}var r=this.index,a=[r+1,0],d=this.ranges;e.forEach(function(e,i){var o=this.$openTabstops[i]||e;e.rangeList=new l,e.rangeList.$bias=0;for(var r=0;r<e.length;r++){var c=e[r],h=s.fromPoints(c.start,c.end||c.start);f(h.start,t),f(h.end,t),h.original=c,h.tabstop=o,d.push(h),e.rangeList.ranges.push(h),o!=e?o.unshift(h):o[r]=h,c.fmtString||o.firstNonLinked&&n?(h.linked=!0,o.hasLinkedRanges=!0):o.firstNonLinked||(o.firstNonLinked=h)}o.firstNonLinked||(o.hasLinkedRanges=!1),o===e&&(a.push(o),this.$openTabstops[i]=o),this.addTabstopMarkers(o)},this),a.length>2&&(this.tabstops.length&&a.push(a.splice(2,1)[0]),this.tabstops.splice.apply(this.tabstops,a))},this.addTabstopMarkers=function(e){var t=this.editor.session;e.forEach(function(e){e.markerId||(e.markerId=t.addMarker(e,"ace_snippet-marker","text"))})},this.removeTabstopMarkers=function(e){var t=this.editor.session;e.forEach(function(e){t.removeMarker(e.markerId),e.markerId=null})},this.removeRange=function(e){var t=e.tabstop.indexOf(e);t!=-1&&e.tabstop.splice(t,1),t=this.ranges.indexOf(e),t!=-1&&this.ranges.splice(t,1),t=e.tabstop.rangeList.ranges.indexOf(e),t!=-1&&e.tabstop.splice(t,1),this.editor.session.removeMarker(e.markerId),e.tabstop.length||(t=this.tabstops.indexOf(e.tabstop),t!=-1&&this.tabstops.splice(t,1),this.tabstops.length||this.detach())},this.keyboardHandler=new d,this.keyboardHandler.bindKeys({Tab:function(e){t.snippetManager&&t.snippetManager.expandWithTab(e)||e.tabstopManager.tabNext(1)},"Shift-Tab":function(e){e.tabstopManager.tabNext(-1)},Esc:function(e){e.tabstopManager.detach()},Return:function(e){return!1}})}).call(g.prototype);var f=function(e,t){0==e.row&&(e.column+=t.column),e.row+=t.row},p=function(e,t){e.row==t.row&&(e.column-=t.column),e.row-=t.row};e("./lib/dom").importCssString(".ace_snippet-marker {    -moz-box-sizing: border-box;    box-sizing: border-box;    background: rgba(194, 193, 208, 0.09);    border: 1px dotted rgba(211, 208, 235, 0.62);    position: absolute;}"),t.snippetManager=new m;var v=e("./editor").Editor;(function(){this.insertSnippet=function(e,i){return t.snippetManager.insertSnippet(this,e,i)},this.expandSnippet=function(e){return t.snippetManager.expandWithTab(this,e)}}).call(v.prototype)}),ace.define("ace/autocomplete/popup",["require","exports","module","ace/virtual_renderer","ace/editor","ace/range","ace/lib/event","ace/lib/lang","ace/lib/dom"],function(e,t,i){"use strict";var n=e("../virtual_renderer").VirtualRenderer,o=e("../editor").Editor,r=e("../range").Range,a=e("../lib/event"),s=e("../lib/lang"),l=e("../lib/dom"),d=function(e){var t=new n(e);t.$maxLines=4;var i=new o(t);return i.setHighlightActiveLine(!1),i.setShowPrintMargin(!1),i.renderer.setShowGutter(!1),i.renderer.setHighlightGutterLine(!1),i.$mouseHandler.$focusTimeout=0,i.$highlightTagPending=!0,i},c=function(e){var t=l.createElement("div"),i=new d(t);e&&e.appendChild(t),t.style.display="none",i.renderer.content.style.cursor="default",i.renderer.setStyle("ace_autocomplete"),i.setOption("displayIndentGuides",!1),i.setOption("dragDelay",150);var n=function(){};i.focus=n,i.$isFocused=!0,i.renderer.$cursorLayer.restartTimer=n,i.renderer.$cursorLayer.element.style.opacity=0,i.renderer.$maxLines=8,i.renderer.$keepTextAreaAtCursor=!1,i.setHighlightActiveLine(!1),i.session.highlight(""),i.session.$searchHighlight.clazz="ace_highlight-marker",i.on("mousedown",function(e){var t=e.getDocumentPosition();i.selection.moveToPosition(t),h.start.row=h.end.row=t.row,e.stop()});var o,c=new r(-1,0,-1,1/0),h=new r(-1,0,-1,1/0);h.id=i.session.addMarker(h,"ace_active-line","fullLine"),i.setSelectOnHover=function(e){e?c.id&&(i.session.removeMarker(c.id),c.id=null):c.id=i.session.addMarker(c,"ace_line-hover","fullLine")},i.setSelectOnHover(!1),i.on("mousemove",function(e){if(!o)return void(o=e);if(o.x!=e.x||o.y!=e.y){o=e,o.scrollTop=i.renderer.scrollTop;var t=o.getDocumentPosition().row;c.start.row!=t&&(c.id||i.setRow(t),m(t))}}),i.renderer.on("beforeRender",function(){if(o&&c.start.row!=-1){o.$pos=null;var e=o.getDocumentPosition().row;c.id||i.setRow(e),m(e,!0)}}),i.renderer.on("afterRender",function(){var e=i.getRow(),t=i.renderer.$textLayer,n=t.element.childNodes[e-t.config.firstRow];n!==t.selectedNode&&t.selectedNode&&l.removeCssClass(t.selectedNode,"ace_selected"),t.selectedNode=n,n&&l.addCssClass(n,"ace_selected")});var u=function(){m(-1)},m=function(e,t){e!==c.start.row&&(c.start.row=c.end.row=e,t||i.session._emit("changeBackMarker"),i._emit("changeHoverMarker"))};i.getHoveredRow=function(){return c.start.row},a.addListener(i.container,"mouseout",u),i.on("hide",u),i.on("changeSelection",u),i.session.doc.getLength=function(){return i.data.length},i.session.doc.getLine=function(e){var t=i.data[e];return"string"==typeof t?t:t&&t.value||""};var g=i.session.bgTokenizer;return g.$tokenizeRow=function(e){function t(e,t){e&&o.push({type:(n.className||"")+(t||""),value:e})}var n=i.data[e],o=[];if(!n)return o;"string"==typeof n&&(n={value:n});for(var r=n.caption||n.value||n.name,a=r.toLowerCase(),s=(i.filterText||"").toLowerCase(),l=0,d=0,c=0;c<=s.length;c++)if(c!=d&&(n.matchMask&1<<c||c==s.length)){var h=s.slice(d,c);d=c;var u=a.indexOf(h,l);if(u==-1)continue;t(r.slice(l,u),""),l=u+h.length,t(r.slice(u,l),"completion-highlight")}return t(r.slice(l,r.length),""),n.meta&&o.push({type:"completion-meta",value:n.meta}),n.message&&o.push({type:"completion-message",value:n.message}),o},g.$updateOnChange=n,g.start=n,i.session.$computeWidth=function(){return this.screenWidth=0},i.isOpen=!1,i.isTopdown=!1,i.autoSelect=!0,i.filterText="",i.data=[],i.setData=function(e,t){i.filterText=t||"",i.setValue(s.stringRepeat("\n",e.length),-1),i.data=e||[],i.setRow(0)},i.getData=function(e){return i.data[e]},i.getRow=function(){return h.start.row},i.setRow=function(e){e=Math.max(this.autoSelect?0:-1,Math.min(this.data.length,e)),h.start.row!=e&&(i.selection.clearSelection(),h.start.row=h.end.row=e||0,i.session._emit("changeBackMarker"),i.moveCursorTo(e||0,0),i.isOpen&&i._signal("select"))},i.on("changeSelection",function(){i.isOpen&&i.setRow(i.selection.lead.row),i.renderer.scrollCursorIntoView()}),i.hide=function(){this.container.style.display="none",this._signal("hide"),i.isOpen=!1},i.show=function(e,t,n){var r=this.container,a=window.innerHeight,s=window.innerWidth,l=this.renderer,d=l.$maxLines*t*1.4,c=e.top+this.$borderSize;c>a/2&&!n&&c+t+d>a?(l.$maxPixelHeight=c-2*this.$borderSize,r.style.top="",r.style.bottom=a-c+"px",i.isTopdown=!1):(c+=t,l.$maxPixelHeight=a-c-.2*t,r.style.top=c+"px",r.style.bottom="",i.isTopdown=!0),r.style.display="";var h=e.left;h+r.offsetWidth>s&&(h=s-r.offsetWidth),r.style.left=h+"px",this._signal("show"),o=null,i.isOpen=!0},i.goTo=function(e){var t=this.getRow(),i=this.session.getLength()-1;switch(e){case"up":t=t<=0?i:t-1;break;case"down":t=t>=i?-1:t+1;break;case"start":t=0;break;case"end":t=i}this.setRow(t)},i.getTextLeftOffset=function(){return this.$borderSize+this.renderer.$padding+this.$imageSize},i.$imageSize=0,i.$borderSize=1,i};l.importCssString(".ace_editor.ace_autocomplete .ace_marker-layer .ace_active-line {    background-color: #CAD6FA;    z-index: 1;}.ace_dark.ace_editor.ace_autocomplete .ace_marker-layer .ace_active-line {    background-color: #3a674e;}.ace_editor.ace_autocomplete .ace_line-hover {    border: 1px solid #abbffe;    margin-top: -1px;    background: rgba(233,233,253,0.4);    position: absolute;    z-index: 2;}.ace_dark.ace_editor.ace_autocomplete .ace_line-hover {    border: 1px solid rgba(109, 150, 13, 0.8);    background: rgba(58, 103, 78, 0.62);}.ace_completion-meta {    opacity: 0.5;    margin: 0.9em;}.ace_completion-message {    color: blue;}.ace_editor.ace_autocomplete .ace_completion-highlight{    color: #2d69c7;}.ace_dark.ace_editor.ace_autocomplete .ace_completion-highlight{    color: #93ca12;}.ace_editor.ace_autocomplete {    width: 300px;    z-index: 200000;    border: 1px lightgray solid;    position: fixed;    box-shadow: 2px 3px 5px rgba(0,0,0,.2);    line-height: 1.4;    background: #fefefe;    color: #111;}.ace_dark.ace_editor.ace_autocomplete {    border: 1px #484747 solid;    box-shadow: 2px 3px 5px rgba(0, 0, 0, 0.51);    line-height: 1.4;    background: #25282c;    color: #c1c1c1;}","autocompletion.css"),t.AcePopup=c,t.$singleLineEditor=d}),ace.define("ace/autocomplete/util",["require","exports","module"],function(e,t,i){"use strict";t.parForEach=function(e,t,i){var n=0,o=e.length;0===o&&i();for(var r=0;r<o;r++)t(e[r],function(e,t){n++,n===o&&i(e,t)})};var n=/[a-zA-Z_0-9\$\-\u00A2-\uFFFF]/;t.retrievePrecedingIdentifier=function(e,t,i){i=i||n;for(var o=[],r=t-1;r>=0&&i.test(e[r]);r--)o.push(e[r]);return o.reverse().join("")},t.retrieveFollowingIdentifier=function(e,t,i){i=i||n;for(var o=[],r=t;r<e.length&&i.test(e[r]);r++)o.push(e[r]);return o},t.getCompletionPrefix=function(e){var t,i=e.getCursorPosition(),n=e.session.getLine(i.row);return e.completers.forEach(function(e){e.identifierRegexps&&e.identifierRegexps.forEach(function(e){!t&&e&&(t=this.retrievePrecedingIdentifier(n,i.column,e))}.bind(this))}.bind(this)),t||this.retrievePrecedingIdentifier(n,i.column)}}),ace.define("ace/autocomplete",["require","exports","module","ace/keyboard/hash_handler","ace/autocomplete/popup","ace/autocomplete/util","ace/lib/lang","ace/lib/dom","ace/snippets","ace/config"],function(e,t,i){"use strict";var n=e("./keyboard/hash_handler").HashHandler,o=e("./autocomplete/popup").AcePopup,r=e("./autocomplete/util"),a=e("./lib/lang"),s=e("./lib/dom"),l=e("./snippets").snippetManager,d=e("./config"),c=function(){this.autoInsert=!1,this.autoSelect=!0,this.exactMatch=!1,this.gatherCompletionsId=0,
this.keyboardHandler=new n,this.keyboardHandler.bindKeys(this.commands),this.blurListener=this.blurListener.bind(this),this.changeListener=this.changeListener.bind(this),this.mousedownListener=this.mousedownListener.bind(this),this.mousewheelListener=this.mousewheelListener.bind(this),this.changeTimer=a.delayedCall(function(){this.updateCompletions(!0)}.bind(this)),this.tooltipTimer=a.delayedCall(this.updateDocTooltip.bind(this),50)};(function(){this.$init=function(){return this.popup=new o(document.body||document.documentElement),this.popup.on("click",function(e){this.insertMatch(),e.stop()}.bind(this)),this.popup.focus=this.editor.focus.bind(this.editor),this.popup.on("show",this.tooltipTimer.bind(null,null)),this.popup.on("select",this.tooltipTimer.bind(null,null)),this.popup.on("changeHoverMarker",this.tooltipTimer.bind(null,null)),this.popup},this.getPopup=function(){return this.popup||this.$init()},this.openPopup=function(e,t,i){this.popup||this.$init(),this.popup.autoSelect=this.autoSelect,this.popup.setData(this.completions.filtered,this.completions.filterText),e.keyBinding.addKeyboardHandler(this.keyboardHandler);var n=e.renderer;if(this.popup.setRow(this.autoSelect?0:-1),i)i&&!t&&this.detach();else{this.popup.setTheme(e.getTheme()),this.popup.setFontSize(e.getFontSize());var o=n.layerConfig.lineHeight,r=n.$cursorLayer.getPixelPosition(this.base,!0);r.left-=this.popup.getTextLeftOffset();var a=e.container.getBoundingClientRect();r.top+=a.top-n.layerConfig.offset,r.left+=a.left-e.renderer.scrollLeft,r.left+=n.gutterWidth,this.popup.show(r,o)}},this.detach=function(){this.editor.keyBinding.removeKeyboardHandler(this.keyboardHandler),this.editor.off("changeSelection",this.changeListener),this.editor.off("blur",this.blurListener),this.editor.off("mousedown",this.mousedownListener),this.editor.off("mousewheel",this.mousewheelListener),this.changeTimer.cancel(),this.hideDocTooltip(),this.gatherCompletionsId+=1,this.popup&&this.popup.isOpen&&this.popup.hide(),this.base&&this.base.detach(),this.activated=!1,this.completions=this.base=null},this.changeListener=function(e){var t=this.editor.selection.lead;(t.row!=this.base.row||t.column<this.base.column)&&this.detach(),this.activated?this.changeTimer.schedule():this.detach()},this.blurListener=function(e){var t=document.activeElement,i=this.editor.textInput.getElement(),n=e.relatedTarget&&this.tooltipNode&&this.tooltipNode.contains(e.relatedTarget),o=this.popup&&this.popup.container;t==i||t.parentNode==o||n||t==this.tooltipNode||e.relatedTarget==i||this.detach()},this.mousedownListener=function(e){this.detach()},this.mousewheelListener=function(e){this.detach()},this.goTo=function(e){this.popup.goTo(e)},this.insertMatch=function(e,t){if(e||(e=this.popup.getData(this.popup.getRow())),!e)return!1;if(e.completer&&e.completer.insertMatch)e.completer.insertMatch(this.editor,e);else{if(this.completions.filterText)for(var i,n=this.editor.selection.getAllRanges(),o=0;i=n[o];o++)i.start.column-=this.completions.filterText.length,this.editor.session.remove(i);e.snippet?l.insertSnippet(this.editor,e.snippet):this.editor.execCommand("insertstring",e.value||e)}this.detach()},this.commands={Up:function(e){e.completer.goTo("up")},Down:function(e){e.completer.goTo("down")},"Ctrl-Up|Ctrl-Home":function(e){e.completer.goTo("start")},"Ctrl-Down|Ctrl-End":function(e){e.completer.goTo("end")},Esc:function(e){e.completer.detach()},Return:function(e){return e.completer.insertMatch()},"Shift-Return":function(e){e.completer.insertMatch(null,{deleteSuffix:!0})},Tab:function(e){var t=e.completer.insertMatch();if(t||e.tabstopManager)return t;e.completer.goTo("down")},PageUp:function(e){e.completer.popup.gotoPageUp()},PageDown:function(e){e.completer.popup.gotoPageDown()}},this.gatherCompletions=function(e,t){var i=e.getSession(),n=e.getCursorPosition(),o=r.getCompletionPrefix(e);this.base=i.doc.createAnchor(n.row,n.column-o.length),this.base.$insertRight=!0;var a=[],s=e.completers.length;return e.completers.forEach(function(l,d){l.getCompletions(e,i,n,o,function(i,n){!i&&n&&(a=a.concat(n)),t(null,{prefix:r.getCompletionPrefix(e),matches:a,finished:0===--s})})}),!0},this.showPopup=function(e,t){this.editor&&this.detach(),this.activated=!0,this.editor=e,e.completer!=this&&(e.completer&&e.completer.detach(),e.completer=this),e.on("changeSelection",this.changeListener),e.on("blur",this.blurListener),e.on("mousedown",this.mousedownListener),e.on("mousewheel",this.mousewheelListener),this.updateCompletions(!1,t)},this.updateCompletions=function(e,t){if(e&&this.base&&this.completions){var i=this.editor.getCursorPosition(),n=this.editor.session.getTextRange({start:this.base,end:i});if(n==this.completions.filterText)return;return this.completions.setFilter(n),this.completions.filtered.length&&(1!=this.completions.filtered.length||this.completions.filtered[0].value!=n||this.completions.filtered[0].snippet)?void this.openPopup(this.editor,n,e):this.detach()}if(t&&t.matches){var i=this.editor.getSelectionRange().start;return this.base=this.editor.session.doc.createAnchor(i.row,i.column),this.base.$insertRight=!0,this.completions=new h(t.matches),this.openPopup(this.editor,"",e)}var o=this.gatherCompletionsId;this.gatherCompletions(this.editor,function(t,i){var n=function(){if(i.finished)return this.detach()}.bind(this),r=i.prefix,a=i&&i.matches;if(!a||!a.length)return n();if(0===r.indexOf(i.prefix)&&o==this.gatherCompletionsId){this.completions=new h(a),this.exactMatch&&(this.completions.exactMatch=!0),this.completions.setFilter(r);var s=this.completions.filtered;return s.length&&(1!=s.length||s[0].value!=r||s[0].snippet)?this.autoInsert&&1==s.length&&i.finished?this.insertMatch(s[0]):void this.openPopup(this.editor,r,e):n()}}.bind(this))},this.cancelContextMenu=function(){this.editor.$mouseHandler.cancelContextMenu()},this.updateDocTooltip=function(){var e=this.popup,t=e.data,i=t&&(t[e.getHoveredRow()]||t[e.getRow()]),n=null;return i&&this.editor&&this.popup.isOpen?(this.editor.completers.some(function(e){return e.getDocTooltip&&(n=e.getDocTooltip(i)),n}),n||"string"==typeof i||(n=i),"string"==typeof n&&(n={docText:n}),n&&(n.docHTML||n.docText)?void this.showDocTooltip(n):this.hideDocTooltip()):this.hideDocTooltip()},this.showDocTooltip=function(e){this.tooltipNode||(this.tooltipNode=s.createElement("div"),this.tooltipNode.className="ace_tooltip ace_doc-tooltip",this.tooltipNode.style.margin=0,this.tooltipNode.style.pointerEvents="auto",this.tooltipNode.tabIndex=-1,this.tooltipNode.onblur=this.blurListener.bind(this),this.tooltipNode.onclick=this.onTooltipClick.bind(this));var t=this.tooltipNode;e.docHTML?t.innerHTML=e.docHTML:e.docText&&(t.textContent=e.docText),t.parentNode||document.body.appendChild(t);var i=this.popup,n=i.container.getBoundingClientRect();t.style.top=i.container.style.top,t.style.bottom=i.container.style.bottom,t.style.display="block",window.innerWidth-n.right<320?n.left<320?i.isTopdown?(t.style.top=n.bottom+"px",t.style.left=n.left+"px",t.style.right="",t.style.bottom=""):(t.style.top=i.container.offsetTop-t.offsetHeight+"px",t.style.left=n.left+"px",t.style.right="",t.style.bottom=""):(t.style.right=window.innerWidth-n.left+"px",t.style.left=""):(t.style.left=n.right+1+"px",t.style.right="")},this.hideDocTooltip=function(){if(this.tooltipTimer.cancel(),this.tooltipNode){var e=this.tooltipNode;this.editor.isFocused()||document.activeElement!=e||this.editor.focus(),this.tooltipNode=null,e.parentNode&&e.parentNode.removeChild(e)}},this.onTooltipClick=function(e){for(var t=e.target;t&&t!=this.tooltipNode;){if("A"==t.nodeName&&t.href){t.rel="noreferrer",t.target="_blank";break}t=t.parentNode}},this.destroy=function(){if(this.detach(),this.popup){this.popup.destroy();var e=this.popup.container;e&&e.parentNode&&e.parentNode.removeChild(e)}this.editor&&this.editor.completer==this&&this.editor.completer,this.popup=null}}).call(c.prototype),c.for=function(e){return e.completer?e.completer:(d.get("sharedPopups")?(c.$shared||(c.$sharedInstance=new c),e.completer=c.$sharedInstance):(e.completer=new c,e.once("destroy",function(e,t){t.completer.destroy()})),e.completer)},c.startCommand={name:"startAutocomplete",exec:function(e,t){var i=c.for(e);i.autoInsert=!1,i.autoSelect=!0,i.showPopup(e,t),i.cancelContextMenu()},bindKey:"Ctrl-Space|Ctrl-Shift-Space|Alt-Space"};var h=function(e,t){this.all=e,this.filtered=e,this.filterText=t||"",this.exactMatch=!1};(function(){this.setFilter=function(e){if(e.length>this.filterText&&0===e.lastIndexOf(this.filterText,0))var t=this.filtered;else var t=this.all;this.filterText=e,t=this.filterCompletions(t,this.filterText),t=t.sort(function(e,t){return t.exactMatch-e.exactMatch||t.$score-e.$score||(e.caption||e.value).localeCompare(t.caption||t.value)});var i=null;t=t.filter(function(e){var t=e.snippet||e.caption||e.value;return t!==i&&(i=t,!0)}),this.filtered=t},this.filterCompletions=function(e,t){var i=[],n=t.toUpperCase(),o=t.toLowerCase();e:for(var r,a=0;r=e[a];a++){var s=r.caption||r.value||r.snippet;if(s){var l,d,c=-1,h=0,u=0;if(this.exactMatch){if(t!==s.substr(0,t.length))continue e}else{var m=s.toLowerCase().indexOf(o);if(m>-1)u=m;else for(var g=0;g<t.length;g++){var f=s.indexOf(o[g],c+1),p=s.indexOf(n[g],c+1);if(l=f>=0&&(p<0||f<p)?f:p,l<0)continue e;d=l-c-1,d>0&&(c===-1&&(u+=10),u+=d,h|=1<<g),c=l}}r.matchMask=h,r.exactMatch=u?0:1,r.$score=(r.score||0)-u,i.push(r)}}return i}}).call(h.prototype),t.Autocomplete=c,t.FilteredList=h}),ace.define("ace/autocomplete/text_completer",["require","exports","module","ace/range"],function(e,t,i){function n(e,t){return e.getTextRange(r.fromPoints({row:0,column:0},t)).split(a).length-1}function o(e,t){var i=n(e,t),o=e.getValue().split(a),r=Object.create(null),s=o[i];return o.forEach(function(e,t){if(e&&e!==s){var n=Math.abs(i-t),a=o.length-n;r[e]?r[e]=Math.max(a,r[e]):r[e]=a}}),r}var r=e("../range").Range,a=/[^a-zA-Z_0-9\$\-\u00C0-\u1FFF\u2C00-\uD7FF\w]+/;t.getCompletions=function(e,t,i,n,r){var a=o(t,i);r(null,Object.keys(a).map(function(e){return{caption:e,value:e,score:a[e],meta:"local"}}))}}),ace.define("ace/ext/language_tools",["require","exports","module","ace/snippets","ace/autocomplete","ace/config","ace/lib/lang","ace/autocomplete/util","ace/autocomplete/text_completer","ace/editor","ace/config"],function(e,t,i){"use strict";var n=e("../snippets").snippetManager,o=e("../autocomplete").Autocomplete,r=e("../config"),a=e("../lib/lang"),s=e("../autocomplete/util"),l=e("../autocomplete/text_completer"),d={getCompletions:function(e,t,i,n,o){if(t.$mode.completer)return t.$mode.completer.getCompletions(e,t,i,n,o);var r=e.session.getState(i.row);o(null,t.$mode.getCompletions(r,t,i,n))}},c={getCompletions:function(e,t,i,o,r){var a=[],s=t.getTokenAt(i.row,i.column);s&&s.type.match(/(tag-name|tag-open|tag-whitespace|attribute-name|attribute-value)\.xml$/)?a.push("html-tag"):a=n.getActiveScopes(e);var l=n.snippetMap,d=[];a.forEach(function(e){for(var t=l[e]||[],i=t.length;i--;){var n=t[i],o=n.name||n.tabTrigger;o&&d.push({caption:o,snippet:n.content,meta:n.tabTrigger&&!n.name?n.tabTrigger+"⇥ ":"snippet",type:"snippet"})}},this),r(null,d)},getDocTooltip:function(e){"snippet"!=e.type||e.docHTML||(e.docHTML=["<b>",a.escapeHTML(e.caption),"</b>","<hr></hr>",a.escapeHTML(e.snippet)].join(""))}},h=[c,l,d];t.setCompleters=function(e){h.length=0,e&&h.push.apply(h,e)},t.addCompleter=function(e){h.push(e)},t.textCompleter=l,t.keyWordCompleter=d,t.snippetCompleter=c;var u={name:"expandSnippet",exec:function(e){return n.expandWithTab(e)},bindKey:"Tab"},m=function(e,t){g(t.session.$mode)},g=function(e){var t=e.$id;n.files||(n.files={}),f(t),e.modes&&e.modes.forEach(g)},f=function(e){if(e&&!n.files[e]){var t=e.replace("mode","snippets");n.files[e]={},r.loadModule(t,function(t){t&&(n.files[e]=t,!t.snippets&&t.snippetText&&(t.snippets=n.parseSnippetFile(t.snippetText)),n.register(t.snippets||[],t.scope),t.includeScopes&&(n.snippetMap[t.scope].includeScopes=t.includeScopes,t.includeScopes.forEach(function(e){f("ace/mode/"+e)})))})}},p=function(e){return!!e&&e.match(/^[0-9a-zA-Z(\.]+$/)},v=function(e){var t=e.editor,i=t.completer&&t.completer.activated;if("backspace"===e.command.name)i&&!s.getCompletionPrefix(t)&&t.completer.detach();else if("insertstring"===e.command.name){if(!p(e.args))return;var n=o.for(t);n.autoInsert=!1,n.showPopup(t)}},y=e("../editor").Editor;e("../config").defineOptions(y.prototype,"editor",{enableBasicAutocompletion:{set:function(e){e?(this.completers||(this.completers=Array.isArray(e)?e:h),this.commands.addCommand(o.startCommand)):this.commands.removeCommand(o.startCommand)},value:!1},enableLiveAutocompletion:{set:function(e){e?(this.completers||(this.completers=Array.isArray(e)?e:h),this.commands.on("afterExec",v)):this.commands.removeListener("afterExec",v)},value:!1},enableSnippets:{set:function(e){e?(this.commands.addCommand(u),this.on("changeMode",m),m(null,this)):(this.commands.removeCommand(u),this.off("changeMode",m))},value:!1}})}),function(){ace.require(["ace/ext/language_tools"],function(e){"object"==typeof module&&"object"==typeof exports&&module&&(module.exports=e)})}();var WorkflowDesignerWindows=WorkflowDesignerWindows||{};WorkflowDesignerWindows.getVariablesList=function(e,t){var i=[{name:"processInstance",shortType:"ProcessInstance",type:"OptimaJet.Workflow.Core.Model.ProcessInstance"},{name:"runtime",shortType:"WorkflowRuntime",type:"OptimaJet.Workflow.Core.Runtime.WorkflowRuntime"},{name:"parameter",shortType:"string",type:"System.String"}];e||(e=""),e=e.toLowerCase();var n=[];switch(e){case"action":case"condition":case"ruleget":n=i;break;case"rulecheck":n=i.concat({name:"identityId",shortType:"string",type:"System.String"})}return t?n.concat({name:"token",shortType:"CancellationToken",type:"System.Threading.CancellationToken"}):n},WorkflowDesignerWindows.getVariablesDefinitionStr=function(e,t){var i=WorkflowDesignerWindows.getVariablesList(e,t);return i&&0!==i.length?"("+i.map(function(e){return e.shortType+" "+e.name}).reduce(function(e,t){return e+", "+t})+")":"()"},WorkflowDesignerWindows.Autocompleter={apiurl:null,cacheTimeout:3e5,callbackRequestServer:null,autocompleteId:0,lastCallback:null,lastPatternHash:null,serverInited:!1,initByCallback:function(e){var t=WorkflowDesignerWindows.Autocompleter;t.callbackRequestServer=function(i,n,o,r){try{e({request:{pattern:i,usings:n,variables:o,id:r},onSuccess:function(e){t.serverAnsweredCallback(e)}})}catch(e){console.log("autocomplete error",e)}},t.serverInited=!0},initSignalRCore:function(e){function t(t,i){return e[t]?e[t]:i}var i=WorkflowDesignerWindows.Autocompleter;try{var n=e.connectionBuilder,o=e.url,r=t("serverResponseMethodName","LoadData"),a=t("serverRequestMethodName","Get"),s=n.withUrl(o).build();s.on(r,function(e){i.serverAnsweredCallback(e)}),s.start().then(function(){i.callbackRequestServer=function(e,t,i,n){s.invoke(a,e,t,i,n).catch(function(e){console.error(e.toString())})}}),i.serverInited=!0}catch(e){console.log("autocomplete error",e)}},enableAceEditor:function(e){var t=WorkflowDesignerWindows.Autocompleter;try{t.serverInited||this.initAjax(t.apiurl);var i=e.editor,n=e.getUsingsCallback,o=e.getVariablesCallback;i.setOptions({enableBasicAutocompletion:!0,enableLiveAutocompletion:!0}),i.completers=[t.makeReflectionCompleter(n,o),t.keywordsCompleter],i.getSession().setMode("ace/mode/csharp")}catch(e){console.log("autocomplete error",e)}},makeReflectionCompleter:function(e,t){return{getCompletions:function(i,n,o,r,a){try{var s=n.getLine(o.row);WorkflowDesignerWindows.Autocompleter.subscribe(s,o.column,a,e,t)}catch(e){console.log(e)}},getDocTooltip:function(e){e.docHTML||(e.docHTML=WorkflowDesignerWindows.Autocompleter.getTooltip(e.reflection))}}},getTooltip:function(e){if(e&&e.kind){var t=e.fullName;Array.isArray(e.typeParameters)&&e.typeParameters.length>0&&(t=t+"&lt;"+e.typeParameters.join(",")+"&gt;");var i="<strong>"+WorkflowDesignerWindows.Autocompleter.getKind(e.kind).name+"</strong> "+t;if(e.type){var n=e.type;Array.isArray(e.typeArguments)&&e.typeArguments.length>0&&(n=n+"&lt;"+e.typeArguments.join(",")+"&gt;"),i+=": <i> "+n+"</i>"}return Array.isArray(e.parameters)&&e.parameters.length>0&&(i+="<br /><br /><u>overrides:</u><ul>",i+=e.parameters.map(function(e){if(e&&0!==e.length){return"<li>("+e.map(function(e){return e.name+": <i>"+e.type+"</i>"}).reduce(function(e,t){return e+", "+t})+")</li>"}return"<li>(no parameters)</li>"}).reduce(function(e,t){return e+t})),i}},kinds:[{name:"Namespace",value:10},{name:"Class",value:20},{name:"Struct",value:30},{name:"Method",value:40},{name:"Parameter",value:50},{name:"Variable",value:60},{name:"Property",value:70},{name:"Field",value:80},{name:"Const",value:90},{name:"Event",value:100}],getKind:function(e){return WorkflowDesignerWindows.Autocompleter.kinds.filter(function(t){return t.value===e})[0]},keywordsCompleter:{getCompletions:function(e,t,i,n,o){var r=WorkflowDesignerWindows.Autocompleter,a=t.getLine(i.row),s=r.getSearchPatterns(a,i.column);!s||s.length>1||o(null,r.CSharp.ace_suggestions())}},initAjax:function(e){var t=WorkflowDesignerWindows.Autocompleter;t.callbackRequestServer=function(i,n,o,r){var a=new Array,s={pattern:i,usings:n,variables:o,id:r};s=JSON.stringify(s),a.push({name:"data",value:s}),a.push({name:"operation",value:"getcodeautocomplete"}),$.ajax({url:e,data:a,type:"post",async:!0,success:function(e){var i={};try{i=JSON.parse(e),t.serverAnsweredCallback(i)}catch(t){return void console.log("autocomplete error",t,e)}},error:function(e,t,i){console.log("autocomplete error",t,i)}})},t.serverInited=!0},serverAnsweredCallback:function(e){var t=WorkflowDesignerWindows.Autocompleter;if(e.id===t.autocompleteId){var i=t.processResponse(e.data);t.lastCallback(null,i),t.callbackRequestAddCache(t.lastPatternHash,i)}},getMeta:function(e){return WorkflowDesignerWindows.Autocompleter.kinds.filter(function(t){return t.value==e.kind})[0].name.toLowerCase()},processResponse:function(e){return e.map(function(e){var t=e.name;return Array.isArray(e.typeParameters)&&e.typeParameters.length>0&&(t=t+"<"+e.typeParameters.join(",")+">"),{caption:t,value:t,meta:WorkflowDesignerWindows.Autocompleter.getMeta(e),reflection:e}})},patternToServerRequest:function(e){return e.filter(function(e){return"."!=e}).reverse().map(function(e){return e.toString()}).join(".")},subscribe:function(e,t,i,n,o){var r=WorkflowDesignerWindows.Autocompleter,a=r.getSearchPatterns(e,t);if(a){var s=r.patternToServerRequest(a),l=r.prepareUsings(n),d=r.prepareVariables(o),c=WorkflowDesignerCommon.getHash([s,l,d]);if(r.callbackRequestCheckCache(c))return void r.callbackRequestCache(c,i);r.autocompleteId+=1,r.lastCallback=i,r.lastPatternHash=c,r.callbackRequestServer&&r.callbackRequestServer(s,l,d,r.autocompleteId)}},internalCache:{},callbackRequestCheckCache:function(e){return!!WorkflowDesignerWindows.Autocompleter.internalCache[e]},callbackRequestCache:function(e,t){t(null,WorkflowDesignerWindows.Autocompleter.internalCache[e])},callbackRequestAddCache:function(e,t){if(Array.isArray(t)&&t.length>0){var i=WorkflowDesignerWindows.Autocompleter;i.internalCache[e]=t,i.cacheTimeout&&setTimeout(function(){delete i.internalCache[e]},i.cacheTimeout)}},getSearchPatterns:function(e,t){for(var i=WorkflowDesignerWindows.Autocompleter,n=[],o="",r=!1,a=t-1;a>=0;a--){var s=e.charAt(a);if(!i.alphaNumberDot(s))break;if("."===s){if(a>0){var l=e.charAt(a-1);if(!i.alphaNumber(l)){r=!0;break}}n.push(o),o=""}else o=s+o}return r&&0===n.length?null:(o&&(n.length>0||o.trim()!=o)&&n.push(o),n)},alphaNumberDot:function(e){return"."===e||WorkflowDesignerWindows.Autocompleter.alphaNumber(e)},alphaNumber:function(e){return e&&e.match(/^[0-9a-zA-Z]+$/)},prepareUsings:function(e){if(!e)return[];var t=e();return t?t.split(";").filter(function(e){return e&&e.trim()}).map(function(e){return e.trim()}).filter(function(e,t,i){return i.indexOf(e)==t}):[]},prepareVariables:function(e){if(!e)return[];var t=e();return t?t:[]},CSharp:{cycles:["for","do","foreach","while","continue","break"],flow:["case","switch","if","else","else if","return"],try:["try","catch","finally","throw"],declare:["new","var","const"],types:["int","short","long","byte","string","bool","object","decimal","float","double","dynamic"],values:["true","false","null","default"],oop:["this","typeof"],macro:["nameof"],thread:["lock"],suggestions:function(){var e=WorkflowDesignerWindows.Autocompleter.CSharp;return[].concat(e.cycles,e.flow,e.try,e.declare,e.types,e.values,e.oop,e.macro,e.threadhread)},ace_suggestions:function(){return WorkflowDesignerWindows.Autocompleter.CSharp.suggestions().map(function(e){return{caption:e,value:e,meta:"keyword"}})}}};var WorkflowDesignerConstants={ActivityColor:"#ECF0F1",ActivityTextColor:"#2D3436",ActivityInitialColor:"#27AE60",ActivityInitialTextColor:"#FFFFFF",ActivityFinalColor:"#2980B9",ActivityFinalTextColor:"#FFFFFF",ActivityShape:"#CECECE",SelectColor:"#F39C12",SelectTextColor:"#FFFFFF",SelectSubProcessColor:"#e3b015",SelectSubProcessTextColor:"#FFFFFF",ButtonActive:"#D4D8D9",BarColor:"#EDF1F2",BarSeparatorColor:"#D9DEE0",DeleteConfirm:"Are you sure you want to delete selected item(s)?",DeleteConfirmCurrent:"Are you sure you want to delete this item?",FieldIsRequired:"Field is required!",FieldMustBeUnique:"Field must be unique!",ButtonTextDelete:"Delete",ButtonTextCreate:"Create",ButtonTextSave:"Save",ButtonTextYes:"Yes",ButtonTextNo:"No",ButtonTextCancel:"Cancel",ButtonTextClose:"Close",ButtonTextUndo:"Undo",ButtonTextRedo:"Redo",SaveConfirm:"Save changes?",CloseWithoutSaving:"Close without saving?",TransitionAuto:"Auto",DialogConfirmText:"Question",None:"None",Warning:"Warning",InfoBlockLabel:{Activity:"Activities: ",Transition:"Transitions: ",Command:"Commands: "},ActivityNamePrefix:"Activity_",ActivityFormLabel:{Title:"Activity",TitleForInline:"Activity Inline",Name:"Name",State:"State",IsInitial:"Initial",IsFinal:"Final",IsForSetState:"For set state",IsAutoSchemeUpdate:"Auto scheme update",Implementation:"Implementation",PreExecutionImplementation:"PreExecution Implementation",ImpOrder:"Order",ImpAction:"Action",ImpActionParameter:"Action parameter",AlwaysConditionShouldBeSingle:"Always condition should be single",OtherwiseConditionShouldBeSingle:"Otherwise condition should be single",Annotations:"Annotations",AnnotationName:"Name",AnnotationValue:"Value",Scheme:"Inline scheme"},TransitionFormLabel:{Title:"Transition",Name:"Name",From:"From activity",To:"To activity",Classifier:"Classifier",Restrictions:"Restrictions",RestrictionsType:"Type",RestrictionsActor:"Actor",Condition:"Condition",ConditionType:"Type",ConditionAction:"Action",ResultOnPreExecution:"PreExec. Result",Trigger:"Trigger",TriggerType:"Type",TriggerCommand:"Command",TriggerTimer:"Timer",ConditionActionParameter:"Action parameter",ConditionExpression:"Expression",ConditionInversion:"Invert result",ConditionsConcatenationType:"Conditions concatenation type",AllowConcatenationType:"Concat allow as",RestrictConcatenationType:"Concat restrict as",ConditionsListShouldNotBeEmpty:"Conditions list should not be empty",IsFork:"Is fork",MergeViaSetState:"Merge subprocess via set state",DisableParentStateControl:"Disable parent process control",ShowConcatParameters:"Show concatenation",HideConcatParameters:"Hide concatenation",Annotations:"Annotations",AnnotationName:"Name",AnnotationValue:"Value",InlinedFinalActivityName:"Inlined Final Activity Name"},LocalizationFormLabel:{Title:"Localization",ObjectName:"ObjectName",Type:"Type",IsDefault:"IsDefault",Culture:"Culture",Value:"Value",Types:["Command","State","Parameter"]},TimerFormLabel:{Title:"Timers",Name:"Name",Type:"Type",Value:"Value",Types:["Command","State","Parameter"],NotOverrideIfExists:"Do not override timer if exists"},ParameterFormLabel:{Title:"Parameters",Name:"Name",Type:"Type",Purpose:"Purpose",Value:"Value",InitialValue:"InitialValue",ShowSystemParameters:"Show system parameters"},ActorFormLabel:{Title:"Actors",Name:"Name",Rule:"Rule",Value:"Value"},CommandFormLabel:{Title:"Command",Name:"Name",InputParameters:"Input Parameters",InputParametersName:"Name",InputParametersIsRequired:"Required",InputParametersParameter:"Parameter",InputParametersDefaultValue:"Default"},ProcessInfoFormLabel:{Title:"Additional Parameters",IsObsolete:"IsObsolete",DefiningParameters:"Defining parameters",ProcessParameters:"Process parameters",SystemParametersTabName:"System Parameters",ProcessParametersTabName:"Process Parameters",HistoryTabName:"History",TimersTabName:"Timers",TagsTabName:"Tags",HistoryTabFromLabel:"From",HistoryTabFromStateLabel:"From State",HistoryTabToLabel:"To",HistoryTabToStateLabel:"To State",HistoryTabExecutorIdLabel:"Executor Id",HistoryTabActorIdLabel:"Actor Id",HistoryTabTimeLabel:"Time",HistoryTabTriggerNameLabel:"Trigger Name",HistoryTabTransitionClassifierNameLabel:"",ParametersNameLabel:"Name",ParametersValueLabel:"Value",TimersTabNameLabel:"Name",TimersTabValueLabel:"Value",RootProcess:"Root Process",TagsLabel:"Tags (separated by commas)"},CodeActionsFormLabel:{Title:"Code actions",Name:"Name",ActionCode:"Action code",IsGlobal:"Is global",IsAsync:"Async",Type:"Type",GlobalDeleteMessage:"You've deleted the Global CodeAction.<br/><b>Other schemes won't be able to call this CodeAction!</b>",UnGlobalMessage:"You've changed the state of the global flag.<br/>There will be created a Local CodeAction based on this Global CodeAction after saving this scheme.",EditParameters:"Edit parameters",Parameters:"Parameters",Text:"Text",TextArea:"TextArea",Number:"Number",Checkbox:"Checkbox",Dropdown:"Dropdown",MultiSelect:"MultiSelect",DateTime:"Date/Time",Values:"Values",DropdownName:"Name",DropdownValue:"Value",DropdownShouldContainValues:"Dropdown should contain values",IsRequired:"Required",DefaultValue:"Default value",Json:"Json"},EditParametersFormlabel:{Title:"Edit parameter values",NumberRequired:"Should be a numeric value",DateShouldBeInISOFormat:"Date/Time parameter should be in ISO8601 format",SwitchToJson:"Switch to JSON editor",SwitchToConstructor:"Switch to parameter values editor",InvalidJson:"JSON object is invalid or does not match the model"},ToolbarLabel:{CreateActivity:"Create activity",CreateInline:"Create inline (template)",CopySelected:"Copy selected",Undo:"Undo",Redo:"Redo",Move:"Move",ZoomIn:"Zoom In",ZoomOut:"Zoom Out",ZoomPositionDefault:"Zoom default",FullScreen:"Full Screen",Refresh:"Refresh",AutoArrangement:"Auto arrangement",Actors:"Actors",Commands:"Commands",Parameters:"Parameters",Localization:"Localization",Timers:"Timers",AdditionalParameters:"Additional Parameters",CodeActions:"Code actions",Info:"Extended info",Delete:"Delete",Clone:"Clone",Settings:"Settings",CreateTransition:"Create a transition",CreateActivityTransition:"Create an activity and a transition",Legend:"Legend",ProcessInfo:"Process Info",Inline:"The scheme can be inlined"},ErrorActivityIsInitialCountText:"One element must be marked flag Initial",ErrorActivityIsFinalCountText:"This scheme is Inlined. One or more elements must be marked flag Final",ErrorReadOnlySaveText:"The Designer in ReadOnly mode, you can't save it.",ErrorInvalidObjectsSaveText:function(e){return"Can't save the schema. Those objects are in invalid state: "+e},BrokenReferencesDialogText:"This schema contains references to Actions, Conditions or Rules that aren't defined by this schema or current action providers. Do you want to keep them?",EditCodeSettings:{Height:600,Width:1e3,CodeHeight:390,MessageBoxHeight:400,MessageBoxWidth:600,SuccessBoxHeight:150,SuccessBoxWidth:300},EditCodeLabel:{Title:"Edit code",EditCodeButton:"Edit code",Usings:"Usings",Compile:"Compile",CompileSucceeded:"Compilation succeeded.",Success:"Success",Error:"Error",OK:"OK",ShowUsings:"Show usings",HideUsings:"Hide usings"},EditJSONSettings:{Height:600,Width:1e3,CodeHeight:480},EditJSONLabel:{Title:"Edit value in JSON",CreateEmptyType:"Create",Format:"Format"},EditExpressionSettings:{Height:600,Width:1e3,CodeHeight:390,MessageBoxHeight:400,MessageBoxWidth:600,SuccessBoxHeight:150,SuccessBoxWidth:300},EditExpressionLabel:{Title:"Edit expression",Validate:"Validate",Succeeded:"Expression is valid.",Success:"Success",Error:"Error",OK:"OK"},OverviewMap:{show:!0,width:300,height:150},UndoDepth:200,DefaultCulture:"en-US",ErrorInBrowserConsole:"See more info in the browser console."},WorkflowDesignerErrors=WorkflowDesignerErrors||{};WorkflowDesignerErrors.ErrorWithAlert=function(){return function(e,t,i,n,o){function r(e){a.errorMessage=e,a.success=!1,o&&o(a)}var a=new Object;a.response=t;var s;try{s=JSON.parse(t)}catch(n){return r(n),WorkflowDesignerErrors.OutErrorMessage(e,n,null,i),WorkflowDesignerErrors.OutErrorMessage(null,t,null,!1),a}return s.isError?(r(s.errorMessage),WorkflowDesignerErrors.OutErrorMessage(e,s.errorMessage,null,i),void 0!==s.stackTrace&&null!==s.stackTrace&&console.error("Error stacktrace:\n",s.stackTrace),void 0!==s.details&&null!==s.details&&console.error("Error details:\n",s.details),a):(a.data=s,a.success=!0,n&&n(a),a)}}(),WorkflowDesignerErrors.OutErrorMessage=function(){return function(e,t,i,n){void 0==n&&(n=!0),n&&alert(t+" "+WorkflowDesignerConstants.ErrorInBrowserConsole),console.error("Error message:",t),e&&console.error("Request Parameters:",e),i&&console.error("Response text:\n",i)}}(),WorkflowDesignerErrors.GetErrorText=function(){return function(e,t,i){return e?t+" "+e.status+": "+i:t+": "+i}}();var WorkflowDesignerCommon={modal:function(e,t){var i=void 0;void 0!=e.semanticmodal?i="semanticmodal":void 0!=e.modal?i="modal":console.error("SemanticUI is not defined!"),void 0!=i&&(e[i](t),void 0==t||void 0==t.onApprove&&void 0==t.onDeny||void 0!=e.keyup&&e.keyup(function(n){if(13===n.keyCode){if(null!==n.originalEvent&&void 0!==n.originalEvent&&n.currentTarget!==n.originalEvent.target)return;void 0!=t.onApprove&&0!=t.onApprove()&&e[i]("hide")}else 27===n.keyCode&&(void 0!=t.onDeny?0!=t.onDeny()&&e[i]("hide"):e[i]("hide"))}))},createArrowByAngle:function(e,t,i,n,o){return void 0==o&&(o="red"),new Konva.Wedge({x:e,y:t,radius:n,angle:40,fill:o,rotation:180*i/Math.PI-200})},updateArrowByAngle:function(e,t,i,n,o,r){void 0==r&&(r="red"),e.setPosition({x:t,y:i}),e.setRadius(o),e.setFill(r),e.setRotation(180*n/Math.PI-200)},createUUID:function(){for(var e=[],t="0123456789abcdef",i=0;i<36;i++)e[i]=t.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")},DataCorrection:function(e){void 0==e.AdditionalParams&&(e.AdditionalParams={}),void 0==e.AdditionalParams.Actions&&(e.AdditionalParams.Actions=[]),void 0==e.AdditionalParams.Conditions&&(e.AdditionalParams.Conditions=[]),void 0==e.AdditionalParams.Rules&&(e.AdditionalParams.Rules=[]);var t=function(e,t,i){if(void 0!=e&&void 0!=t){var n=$.grep(t,function(t){return e==t[i]});return n.length>0?n[0]:void 0}};e.Transitions.forEach(function(i){void 0!=i.From&&(i.From=t(i.From.Name,e.Activities,"Name")),void 0!=i.To&&(i.To=t(i.To.Name,e.Activities,"Name")),void 0!=i.Restrictions&&i.Restrictions.forEach(function(i){i.Actor&&(i.Actor=t(i.Actor.Name,e.Actors,"Name"))}),void 0!=i.Trigger&&void 0!=i.Trigger.Command&&(i.Trigger.Command=t(i.Trigger.Command.Name,e.Commands,"Name"),i.Trigger.Command||(i.Trigger.NameRef=null)),void 0!=i.Trigger&&void 0!=i.Trigger.Timer&&(i.Trigger.Timer=t(i.Trigger.Timer.Name,e.Timers,"Name"),i.Trigger.Timer||(i.Trigger.NameRef=null))}),e.Commands.forEach(function(i){void 0!=i.InputParameters&&i.InputParameters.forEach(function(i){i.Parameter=t(i.Parameter.Name,e.Parameters,"Name")})})},download:function(e,t,i,n,o,r){if(t&&i){var a=new Array;i.forEach(function(e){var t=$('<input type="hidden"/>');t.attr("name",e.name),t.attr("value",e.value),a.push(t)});var s=$('<form action="'+t+'" method="'+(n||"post")+'"></form>');s.append(a),$.ajax({type:"POST",url:t,data:new FormData(s[0]),processData:!1,contentType:!1,success:function(t,i,n){var a=!1;try{JSON.parse(n.responseText),a=!0}catch(e){}if(a){
WorkflowDesignerErrors.ErrorWithAlert("Download",n.responseText,!0,o,r)}else{var s=document.createElement("a");s.setAttribute("href",window.URL.createObjectURL(new Blob([n.responseText],{type:"text/xml"}))),s.setAttribute("download",e),document.body.appendChild(s),s.onclick=function(e){document.body.removeChild(s)},s.click(),o&&o(n.responseText)}},error:function(e,t,i){var n=WorkflowDesignerErrors.GetErrorText(e,t,i);return WorkflowDesignerErrors.OutErrorMessage("Download",n,e.responseText),r&&r(n),!1}})}},defineLocalStorage:function(){Object.defineProperty(window,"localStorage",new function(){var e=[],t={};Object.defineProperty(t,"getItem",{value:function(e){return e?this[e]:null},writable:!1,configurable:!1,enumerable:!1}),Object.defineProperty(t,"key",{value:function(t){return e[t]},writable:!1,configurable:!1,enumerable:!1}),Object.defineProperty(t,"setItem",{value:function(e,t){e&&(document.cookie=escape(e)+"="+escape(t)+"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/")},writable:!1,configurable:!1,enumerable:!1}),Object.defineProperty(t,"length",{get:function(){return e.length},configurable:!1,enumerable:!1}),Object.defineProperty(t,"removeItem",{value:function(e){e&&(document.cookie=escape(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/")},writable:!1,configurable:!1,enumerable:!1}),Object.defineProperty(t,"clear",{value:function(){if(e.length)for(var t in e)document.cookie=escape(t)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/"},writable:!1,configurable:!1,enumerable:!1}),this.get=function(){var i;for(var n in t)i=e.indexOf(n),i===-1?t.setItem(n,t[n]):e.splice(i,1),delete t[n];for(e;e.length>0;e.splice(0,1))t.removeItem(e[0]);for(var o,r,a=0,s=document.cookie.split(/\s*;\s*/);a<s.length;a++)o=s[a].split(/\s*=\s*/),o.length>1&&(t[r=unescape(o[0])]=unescape(o[1]),e.push(r));return t},this.configurable=!1,this.enumerable=!0})},imageCache:[],loadImage:function(e,t,i){for(var n,o=0;o<WorkflowDesignerCommon.imageCache.length;o++){var r=WorkflowDesignerCommon.imageCache[o];if(r.src==e){n=r;break}}return void 0!=n?(void 0!=t&&t(n,i),n):(n=new Image,void 0!=t&&(n.onload=function(){t(n,i)}),n.src=e,n)},getTextWidth:function(e,t){var i=WorkflowDesignerCommon.TmpCanvas||(WorkflowDesignerCommon.TmpCanvas=document.createElement("canvas")),n=i.getContext("2d");return n.font=t,n.measureText(e).width},defineArrayIncludes:function(){Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(e,t){function i(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)}if(null==this)throw new TypeError('"this" is null or not defined');var n=Object(this),o=n.length>>>0;if(0===o)return!1;for(var r=0|t,a=Math.max(r>=0?r:o-Math.abs(r),0);a<o;){if(i(n[a],e))return!0;a++}return!1}})},getHash:function(e,t,i){Array.isArray(e)&&(e=e.join(""));var n,o,r=void 0===i?2166136261:i;for(n=0,o=e.length;n<o;n++)r^=e.charCodeAt(n),r+=(r<<1)+(r<<4)+(r<<7)+(r<<8)+(r<<24);return t?("0000000"+(r>>>0).toString(16)).substr(-8):r>>>0}},WorkflowDesignerWindows=WorkflowDesignerWindows||{};WorkflowDesignerWindows.getVariablesList=function(e,t){var i=[{name:"processInstance",shortType:"ProcessInstance",type:"OptimaJet.Workflow.Core.Model.ProcessInstance"},{name:"runtime",shortType:"WorkflowRuntime",type:"OptimaJet.Workflow.Core.Runtime.WorkflowRuntime"},{name:"parameter",shortType:"string",type:"System.String"}];e||(e=""),e=e.toLowerCase();var n=[];switch(e){case"action":case"condition":case"ruleget":n=i;break;case"rulecheck":n=i.concat({name:"identityId",shortType:"string",type:"System.String"})}return t?n.concat({name:"token",shortType:"CancellationToken",type:"System.Threading.CancellationToken"}):n},WorkflowDesignerWindows.getVariablesDefinitionStr=function(e,t){var i=WorkflowDesignerWindows.getVariablesList(e,t);return i&&0!==i.length?"("+i.map(function(e){return e.shortType+" "+e.name}).reduce(function(e,t){return e+", "+t})+")":"()"};var Validation={checkType:function(e,t){var i=WorkflowDesignerConstants.EditParametersFormlabel;switch(e){case"Number":if(isNaN(t)||t===!0||t===!1)return i.NumberRequired;break;case"DateTime":if(""!==t&&null!==t&&void 0!==t&&!moment(t,moment.ISO_8601).isValid())return i.DateShouldBeInISOFormat}return null}},WorkflowDesignerWindows=WorkflowDesignerWindows||{};WorkflowDesignerWindows.ConfirmDialog=function(){return function(e,t,i,n,o){var r=$('<div tabindex="0" class="ui mini modal WorkflowDesignerConfirmDialog"></div>');r.append($('<div class="header">'+WorkflowDesignerConstants.DialogConfirmText+"</div>")),r.append($('<div class="content scrolling"><p>'+e+"</p></div>"));var a=$('<div class="actions"></div>').append('<div tabindex="1" class="ui primary ok button">'+t+"</div>").append('<div class="ui secondary  cancel button">'+n+"</div>");r.append(a),WorkflowDesignerCommon.modal(r,{onApprove:function(){i()},onDeny:function(){o()},allowMultiple:!0,dimmerSettings:{opacity:.2,duration:{show:0,hide:0}},transition:"fade"}),WorkflowDesignerCommon.modal(r,"show"),WorkflowDesignerCommon.modal(r,"refresh")}}();var WorkflowDesignerWindows=WorkflowDesignerWindows||{};WorkflowDesignerWindows.EditActors=function(){return function(e){var t=WorkflowDesignerConstants.ActorFormLabel,i={type:"table",title:t.Title,width:"800px",data:e.graph.data.Actors,keyproperty:"Name",elements:[{name:t.Name,field:"Name",type:"input"},{name:t.Rule,field:"Rule",type:"select",datasource:e.graph.getActorNames(),onchange:function(e){var t=$(e),i=t.closest("tr").find("[name=actoractionparam]").closest("td"),n=i.children(),o=n[0].rebuild($(e).val(),n.find("input").val());n.remove(),i.append(o)}},{name:t.Value,field:"Value",type:"jsonparameter",code:"actoractionparam",graph:e.graph,parametertype:"RuleCheck",openautocompleteonclick:!0,datasource:function(t,i){var n=$(this).closest("tr"),o=n.find("[name=Rule]")[0].value;i(e.graph.getAutoCompleteSuggestions("ruleparameter",o,t))}}],graph:e.graph,readonly:e.graph.Settings.readonly,saveFunc:function(t){e.SyncTable(e.graph.data.Actors,t,i),WorkflowDesignerCommon.DataCorrection(e.graph.data),e.graph.Draw(e.graph.data),e.graph.StoreGraphData()}};if(void 0!=e.graph.Settings.forms&&void 0!=e.graph.Settings.forms.actors)return void e.graph.Settings.forms.actors(i);var n=new WorkflowDesignerForm(i),o=function(e,t){return!(!n.CheckRequired(e,["Name","Rule"],WorkflowDesignerConstants.FieldIsRequired)||!n.CheckUnique(e,["Name"],WorkflowDesignerConstants.FieldMustBeUnique))&&(n.ClearTempField(e),n.parameters.saveFunc(e),!0)};n.showModal(o)}}();var WorkflowDesignerWindows=WorkflowDesignerWindows||{};WorkflowDesignerWindows.EditCodeActions=function(){function e(e,t){var i=[];return e.forEach(function(n){if(n.IsGlobal){for(var o=!1,r=0;r<e.length;r++)if(n.Name==e[r].Name&&n.IsGlobal!=e[r].IsGlobal){o=!0;break}for(var a=!1,r=0;r<t.length;r++)if(o){if(n.Name==t[r].Name&&t[r].IsGlobal){a=!0;break}}else if(n.Name==t[r].Name){a=!0;break}a||i.push(n.Name)}}),i}function t(e,t){var i=0,n=0;$.each(t,function(t,o){switch(o.type){case"Action":for(i=0;i<e.Activities.length;i+=1){var r=e.Activities[i];if("Inline"!==r.ActivityType){if(r.Implementation)for(n=0;n<r.Implementation.length;n+=1)r.Implementation[n].ActionName===o.initial&&(r.Implementation[n].ActionName=o.current);if(r.Implementation)for(n=0;n<r.PreExecutionImplementation.length;n+=1)r.PreExecutionImplementation[n].ActionName===o.initial&&(r.PreExecutionImplementation[n].ActionName=o.current)}}break;case"Condition":for(i=0;i<e.Transitions.length;i+=1){var a=e.Transitions[i];for(n=0;n<a.Conditions.length;n+=1){var s=a.Conditions[n];"Action"===s.Type&&s.Action.ActionName===o.initial&&(s.Action.ActionName=o.current)}}break;case"RuleGet":case"RuleCheck":for(i=0;i<e.Actors.length;i+=1)e.Actors[i].Rule===o.initial&&(e.Actors[i].Rule=o.current)}})}return function(i){var n=WorkflowDesignerConstants.CodeActionsFormLabel,o={type:"table",title:n.Title,data:i.graph.data.CodeActions,datadefault:{},elements:[{name:n.Name,field:"Name",type:"input"},{name:n.Type,field:"Type",type:"select",displayfield:"Name",datasource:[{Name:"Action"},{Name:"Condition"},{Name:"RuleGet"},{Name:"RuleCheck"}]},{name:n.IsGlobal,field:"IsGlobal",type:"checkbox"},{name:n.IsAsync,field:"IsAsync",type:"checkbox"},{name:n.ActionCode,field:"ActionCode",type:"code"},{name:n.Parameters,field:"ParameterDefinitions",type:"parameters",graph:i.graph}],graph:i.graph,readonly:i.graph.Settings.readonly,onrowadded:function(e,t){e.find("[name=Type]").change(function(){a(e)}),a(e),e.find("[name=IsGlobal]").change(function(){this.checked||t.InfoDialog(WorkflowDesignerConstants.Warning,WorkflowDesignerConstants.CodeActionsFormLabel.UnGlobalMessage,"mini")})},onrowdelete:function(e,t){return e.find("[name=IsGlobal]")[0].checked&&t.InfoDialog(WorkflowDesignerConstants.Warning,WorkflowDesignerConstants.CodeActionsFormLabel.GlobalDeleteMessage,"mini"),!0},saveFunc:function(e,n){i.SyncTable(i.graph.data.CodeActions,e,o);for(var r=0;r<i.graph.data.CodeActions.length;r++){var a=i.graph.data.CodeActions[r].ActionCode,s=i.graph.data.CodeActions[r].ParameterDefinitions;if(i.graph.data.CodeActions[r].ActionCode=encodeURIComponent(a.code),i.graph.data.CodeActions[r].Usings=encodeURIComponent(a.usings),void 0!==s&&null!==s){var l={};i.graph.data.CodeActions[r].ParameterDefinitions=new Array,$.each(s,function(e,t){l={Name:t.Name,Type:t.Type,IsRequired:t.IsRequired,DefaultValue:t.DefaultValue},"Dropdown"!==l.Type&&"MultiSelect"!==l.Type||(l.DropdownValues=new Array,$.each(t.DropdownValues,function(e,t){l.DropdownValues.push({Name:t.Name,Value:t.Value})})),i.graph.data.CodeActions[r].ParameterDefinitions.push(l)})}}n.length&&t(i.graph.data,n),WorkflowDesignerCommon.DataCorrection(i.graph.data),i.graph.Draw(i.graph.data),i.graph.StoreGraphData()}};if(void 0!=i.graph.Settings.forms&&void 0!=i.graph.Settings.forms.codeactions)return void i.graph.Settings.forms.codeactions(o);var r=new WorkflowDesignerForm(o),a=function(e){e.find("[name=Type]")[0];e.find("[name=IsAsync]").attr("disabled",!1)},s=function(t,n){for(var o=0;o<t.length;o++){var a=t[o];void 0===a.ActionCode||void 0!==a.ActionCode.code&&a.ActionCode.code||("Action"===a.Type?a.ActionCode.code="return;":"Condition"===a.Type?a.ActionCode.code="return false;":"RuleGet"===a.Type?a.ActionCode.code="return new List<string>();":"RuleCheck"===a.Type&&(a.ActionCode.code="return false;"))}if(r.CheckRequired(t,["Name","Type","ActionCode.code"],WorkflowDesignerConstants.FieldIsRequired)&&r.CheckUnique(t,["Name","Type","IsGlobal"],WorkflowDesignerConstants.FieldMustBeUnique)){for(var s=new Array,o=0;o<t.length;o++){var a=t[o],l=$(a.control_Name).data("initial-value"),d=a.Name;l!==d&&s.push({initial:l,current:d,type:a.Type})}r.ClearTempField(t);var c=e(i.graph.data.CodeActions,t);return c.length>0&&i.graph.designer.deleteGlobalCodeAction(c),r.parameters.saveFunc(t,s),!0}return!1};r.showModal(s)}}();var WorkflowDesignerWindows=WorkflowDesignerWindows||{};WorkflowDesignerWindows.EditCommands=function(){return function(e){var t=WorkflowDesignerConstants.CommandFormLabel,i=function(t,i,n){for(var o=void 0,r=void 0,a=t.getEditData(t.parameters),s=0;s<a.length;s++){var l=a[s];if(void 0!=l.InputParameters)for(var d=0;d<l.InputParameters.length;d++)if(l.InputParameters[d].control_DefaultValue.id===i.id){r=l.InputParameters[d].Parameter.Name;break}}if(void 0!=r)for(var c=e.graph.data.Parameters,s=0;s<c.length;s++)if(c[s].Name===r){o=c[s].Type;break}void 0!=o&&e.graph.graph.getemptytype(o,n)},n={type:"table",title:t.Title,width:"900px",data:e.graph.data.Commands,datadefault:{},keyproperty:"Name",elements:[{name:t.Name,field:"Name",type:"input"},{name:t.InputParameters,field:"InputParameters",type:"table",elements:[{name:t.InputParametersName,code:"ipname",field:"Name",type:"input",width:"30%"},{name:t.InputParametersParameter,code:"ipparameter",field:"Parameter.Name",type:"select",displayfield:"Name",datasource:e.graph.getNonSystemParameters()},{name:t.InputParametersIsRequired,code:"iisrequired",field:"IsRequired",type:"checkbox"},{name:t.InputParametersDefaultValue,code:"idefaultvalue",field:"DefaultValue",type:"json",width:"40%",getemptytype:i}]}],graph:e.graph,readonly:e.graph.Settings.readonly,saveFunc:function(t){e.SyncTable(e.graph.data.Commands,t,n),WorkflowDesignerCommon.DataCorrection(e.graph.data),e.graph.Draw(e.graph.data),e.graph.StoreGraphData()}};if(void 0!=e.graph.Settings.forms&&void 0!=e.graph.Settings.forms.commands)return void e.graph.Settings.forms.commands(n);var o=new WorkflowDesignerForm(n),r=function(e,t){var i=!0;return i&=e.CheckRequired(t,["Name"],WorkflowDesignerConstants.FieldIsRequired),i&=e.CheckUnique(t,["Name"],WorkflowDesignerConstants.FieldMustBeUnique),t.forEach(function(t){e.CheckRequired(t.InputParameters,["Name","Parameter.Name"],WorkflowDesignerConstants.FieldIsRequired)||(i=!1)}),i},a=function(e){return!!r(o,e)&&(o.ClearTempField(e),o.parameters.saveFunc(e),!0)};o.showModal(a)}}();var WorkflowDesignerWindows=WorkflowDesignerWindows||{};WorkflowDesignerWindows.EditTimer=function(){return function(e){var t=WorkflowDesignerConstants.TimerFormLabel,i={type:"table",title:t.Title,width:"800px",data:e.graph.data.Timers,keyproperty:"Name",elements:[{name:t.Name,field:"Name",type:"input"},{name:t.Type,field:"Type",type:"select",datasource:e.graph.data.AdditionalParams.TimerTypes},{name:t.Value,field:"Value",type:"input"},{name:t.NotOverrideIfExists,field:"NotOverrideIfExists",type:"checkbox"}],readonly:e.graph.Settings.readonly,saveFunc:function(t){e.SyncTable(e.graph.data.Timers,t,i),WorkflowDesignerCommon.DataCorrection(e.graph.data),e.graph.Draw(e.graph.data),e.graph.StoreGraphData()}};if(void 0!=e.graph.Settings.forms&&void 0!=e.graph.Settings.forms.timers)return void e.graph.Settings.forms.timers(i);var n=new WorkflowDesignerForm(i),o=function(t,i){return!(!n.CheckRequired(t,["Name","Type","Value"],WorkflowDesignerConstants.FieldIsRequired)||!n.CheckUnique(t,["Name"],WorkflowDesignerConstants.FieldMustBeUnique))&&(n.ClearTempField(t),void 0==e.graph.data.Timers&&(e.graph.data.Timers=[]),n.parameters.saveFunc(t),!0)};n.showModal(o)}}();var WorkflowDesignerWindows=WorkflowDesignerWindows||{};WorkflowDesignerWindows.CheckboxControl=function(e){this.parentForm=e},WorkflowDesignerWindows.CheckboxControl.prototype.generate=function(e,t,i){var n=this,o=$('<input type="checkbox"></input>');return o[0].id=n.parentForm.generateid(e.field,i),null!==t&&void 0!==t&&""!==t&&(o[0].checked=JSON.parse(String(t).toLowerCase())),o[0].name=n.parentForm.getElementCode(e),n.parentForm.isReadOnly()&&o.attr("disabled","disabled"),o=$('<div class="ui checkbox"></div>').append(o).append("<label></label>"),!e.indeterminable||null!==t&&void 0!==t&&""!==t||o.checkbox("set indeterminate"),o};var WorkflowDesignerWindows=WorkflowDesignerWindows||{};WorkflowDesignerWindows.DefaultValueControl=function(e,t,i){this.parentForm=e,this.prefix=i,this.parameter=t},WorkflowDesignerWindows.DefaultValueControl.prototype.generate=function(e,t){return this.build(t.Type,e,t.DropdownValues)},WorkflowDesignerWindows.DefaultValueControl.prototype.build=function(e,t,i){var n=this,o=null;switch(e){case"Text":case"Number":case"DateTime":o=new WorkflowDesignerWindows.InputControl(n.parentForm).generate(n.parameter,t,n.prefix);break;case"TextArea":o=new WorkflowDesignerWindows.TextAreaControl(n.parentForm).generate(n.parameter,t,n.prefix);break;case"Checkbox":o=new WorkflowDesignerWindows.CheckboxControl(n.parentForm).generate($.extend({indeterminable:!0},n.parameter),t,n.prefix);break;case"Dropdown":o=new WorkflowDesignerWindows.SelectControl(n.parentForm).generate($.extend({displayfield:"Name",valuefield:"Value",datasource:i},n.parameter),t,n.prefix);break;case"MultiSelect":o=new WorkflowDesignerWindows.MultiSelectControl(n.parentForm).generate($.extend({displayfield:"Name",valuefield:"Value",datasource:i},n.parameter),t,n.prefix);break;case"Json":o=new WorkflowDesignerWindows.JsonControl(n.parentForm,n.parameter,n.prefix).generateBasicControl(t);break;default:o=$("<div></div>")}return o[0].rebuild=function(e,t,i){return n.build(e,t,i)},o};var WorkflowDesignerWindows=WorkflowDesignerWindows||{};WorkflowDesignerWindows.ExpressionControl=function(e,t,i){this.parentForm=e,this.prefix=i,this.parameter=t},function(){function e(e,i){var n=$('<div class="ui modal WorkflowDesignerDialogChild"><div class="header">'+WorkflowDesignerConstants.EditExpressionLabel.Title+'</div><div id="'+i[0].id+'_editor" style="height:'+WorkflowDesignerConstants.EditExpressionSettings.CodeHeight+'px">'+i[0].value+"</div></div>");n[0].id=i[0].id+"_form";var o=$('<div class="actions"></div>'),r=$('<div class="ui button">'+WorkflowDesignerConstants.EditExpressionLabel.Validate+"</div>");return r.click(function(){var n=ace.edit(i[0].id+"_editor").getValue().replace(/(?:\n)/g,"\\n"),o=new Object;o.expression=n;var r=function(e){return t(e.Success?WorkflowDesignerConstants.EditExpressionLabel.Success:WorkflowDesignerConstants.EditExpressionLabel.Error,e.Success?WorkflowDesignerConstants.EditExpressionLabel.Succeeded:e.Message,e.Success?"mini":void 0),!1};e.parameter.graph.designer.perform(o,r,r)}),o.append(r),o.append('<div class="ui primary ok button">'+WorkflowDesignerConstants.ButtonTextSave+"</div>"),o.append('<div class="ui secondary cancel button">'+WorkflowDesignerConstants.ButtonTextCancel+"</div>"),n.append(o),function(){WorkflowDesignerCommon.modal(n,{closable:!1,allowMultiple:!0,onApprove:function(){var e=ace.edit(i[0].id+"_editor").getValue();i[0].value=e.replace(/(?:\n)/g,"\\n")},onHidden:function(){$(".ace_editor").remove(),setTimeout(function(){WorkflowDesignerCommon.modal(e.parentForm.window,"show"),WorkflowDesignerCommon.modal(e.parentForm.window,"refresh")},10)},dimmerSettings:{opacity:.2,duration:{show:0,hide:0}},transition:"fade"}),WorkflowDesignerCommon.modal(n,"show"),WorkflowDesignerCommon.modal(n,"refresh");var t=ace.edit(i[0].id+"_editor");t.setOptions({readOnly:!1}),t.getSession().setMode("ace/mode/text"),t.setValue(i[0].value.replace(/(?:\\n)/g,"\n")),t.clearSelection()}}function t(e,t,i){var n="ui modal WorkflowDesignerConfirmDialog";void 0!=i&&(n+=" "+i);var o=$('<div tabindex="0" class="'+n+'"></div>');o.append($('<div class="header">'+e+"</div>")),o.append($('<div class="content scrolling"><p>'+t+"</p></div>"));var r=$('<div class="actions"></div>').append('<div tabindex="1" class="ui primary ok button">'+WorkflowDesignerConstants.EditCodeLabel.OK+"</div>");o.append(r),WorkflowDesignerCommon.modal(o,{allowMultiple:!0,dimmerSettings:{opacity:.2,duration:{show:0,hide:0}},transition:"fade"}),WorkflowDesignerCommon.modal(o,"show"),WorkflowDesignerCommon.modal(o,"refresh")}WorkflowDesignerWindows.ExpressionControl.prototype.generate=function(t){var i=this,n=$('<input type="text"></input>');n[0].id=i.parentForm.generateid(i.parameter.field,i.prefix),n[0].name=i.parentForm.getElementCode(i.parameter);var o=$('<a class="btnCodeActions"></a>');return o[0].id=n[0].id+"_button",void 0!==t&&(n[0].value=t),o.on("click",function(){e(i,n)()}),$('<div style="width:100%;"></div>').append($('<div style="width:16px; float:right; margin-right:7px;margin-top: 10px;"></div>').append(o)).append($('<div style="margin-right:30px"></div>').append(n))}}();var WorkflowDesignerWindows=WorkflowDesignerWindows||{};WorkflowDesignerWindows.InputControl=function(e){this.parentForm=e},WorkflowDesignerWindows.InputControl.prototype.generate=function(e,t,i){var n=this,o=$('<input type="text"></input>');return o[0].id=n.parentForm.generateid(e.field,i),o[0].name=n.parentForm.getElementCode(e),void 0!==t&&(o[0].value=t),n.parentForm.isReadOnly()&&o.attr("readonly",!0),n.parentForm.addAutoComplete(e,o),void 0!==e.onchange&&o.on("change",function(){e.onchange(o)}),o.data("initial-value",t),o};var WorkflowDesignerWindows=WorkflowDesignerWindows||{};WorkflowDesignerWindows.JsonControl=function(e,t,i){this.parentForm=e,this.prefix=i,this.parameter=t},function(){function e(e,o,r,a){var s=!1,l=null,d=WorkflowDesignerConstants.EditParametersFormlabel,c=$('<div style="float: right; margin-bottom: 15px;"></div>'),h=$('<a href="#" class="btnAdd"></a>');h[0].innerHTML=d.SwitchToJson,h.on("click",function(){return s=!0,WorkflowDesignerCommon.modal(l.window,"hide"),!1}),c.append(h);var u={type:"form",title:d.Title,readonly:e.parameter.graph.Settings.readonly,onHidden:function(){setTimeout(function(){if(s){s=!1;var t=l.getEditData(l.parameters),a={};$.each(r,function(e,n){paramValue=t[n.Name],a=i(n,paramValue,a)}),$(".ace_editor").remove(),n(e,o,{initialValue:JSON.stringify(a),paramsInfo:r})()}else WorkflowDesignerCommon.modal(e.parentForm.window,"show"),WorkflowDesignerCommon.modal(e.parentForm.window,"refresh")},10)},bottom:c[0],elements:new Array};if(void 0!==a)""===r[0].Name?(u.data={},u.data[""]=a):u.data=a;else if(""===r[0].Name){if(u.data={},o[0].value)try{u.data[""]=JSON.parse(o[0].value)}catch(e){"Text"===r[0].Type||"Dropdown"===r[0].Type||"DateTime"===r[0].Type||"MultiSelect"===r[0].Type?u.data[""]=o[0].value:"TextArea"===r[0].Type&&(u.data[""]=o.val().replace(/(?:\\n)/g,"\n"))}}else{if(o[0].value)try{u.data=JSON.parse(o[0].value)}catch(e){}u.data||(u.data={}),$.each(r,function(e,t){var i=u.data[t.Name];void 0!==i&&null!==i&&""!==i||(u.data[t.Name]=t.DefaultValue)})}$.each(r,function(e,t){var i=new Object;switch(i.name=null==t.Title?t.Name:t.Title,i.field=t.Name,i.parameters=t,t.Type){case"Text":case"Number":case"DateTime":i.type="input";break;case"TextArea":i.type="textarea";break;case"Checkbox":i.type="checkbox",i.indeterminable=!0;break;case"Dropdown":i.type="select",i.displayfield="Name",i.valuefield="Value",i.datasource=t.DropdownValues;break;case"MultiSelect":i.type="multiselect",i.displayfield="Name",i.valuefield="Value",i.datasource=t.DropdownValues;break;case"Json":i.type="json"}u.elements.push(i)}),l=new WorkflowDesignerForm(u);var m=function(n){var a=null,s=!0,l={};if($.each(r,function(o,r){a=n[r.Name];var d=t(a,r);d?(s=!1,e.parentForm.ControlAddError(n["control_"+r.Name],d)):l=i(r,a,l)}),s){var d=1===r.length&&""===r[0].Name;!d||"Text"!==r[0].Type&&"Dropdown"!==r[0].Type&&"DateTime"!==r[0].Type&&"MultiSelect"!==r[0].Type?d&&"TextArea"===r[0].Type?o.val(l.replace(/(?:\n)/g,"\\n")):o[0].value=JSON.stringify(l):o[0].value=l}return s};l.showModal(m)}function t(e,t){return!t.IsRequired||void 0!==e&&null!==e&&""!==e?Validation.checkType(t.Type,e):WorkflowDesignerConstants.FieldIsRequired}function i(e,t,i){if(""===e.Name)if("Text"!==e.Type&&"TextArea"!==e.Type&&""===t)i=null;else if("Number"===e.Type)i=Number(t);else if("Json"===e.Type)try{i=JSON.parse(t)}catch(e){i=t}else i=t;else if("Text"!==e.Type&&"TextArea"!==e.Type&&""===t)i[e.Name]=null;else if("Number"===e.Type)i[e.Name]=Number(t);else if("Json"===e.Type)try{i[e.Name]=JSON.parse(t)}catch(n){i[e.Name]=t}else i[e.Name]=t;return i}function n(i,n,r){var a=$('<div class="ui modal WorkflowDesignerDialogChild"><div class="header">'+WorkflowDesignerConstants.EditJSONLabel.Title+'</div><div id="'+n[0].id+'_editor" style="height:'+WorkflowDesignerConstants.EditJSONSettings.CodeHeight+'px">'+n[0].value+"</div></div>");a[0].id=n[0].id+"_form";var s=!1,l=$('<div class="actions"></div>');if(void 0!==r){var d=$('<div style="display: inline-block"></div>'),c=$('<a href="#" class="btnAdd"></a>');c[0].innerHTML=WorkflowDesignerConstants.EditParametersFormlabel.SwitchToConstructor,c.on("click",function(){return s=!0,WorkflowDesignerCommon.modal(a,"hide"),!1}),d.append(c),l.append(d)}if(!n[0].readOnly){var h=$('<div class="ui button">'+WorkflowDesignerConstants.EditJSONLabel.Format+"</div>");h.click(function(){var e=ace.edit(n[0].id+"_editor"),t=ace.edit(n[0].id+"_editor").getValue();e.setValue(i.parentForm.toPrettyJSON(t)),e.clearSelection()}),l.append(h)}if(void 0!=i.parameter.getemptytype&&!n[0].readOnly){var u=$('<div class="ui button">'+WorkflowDesignerConstants.EditJSONLabel.CreateEmptyType+"</div>");u.click(function(){var e=i.parameter;void 0!=e.getemptytype&&e.getemptytype(i.parentForm,n[0],function(e){if(void 0!=e&&""!==e){var t=ace.edit(n[0].id+"_editor");t.setValue(i.parentForm.toPrettyJSON(e)),t.clearSelection()}})}),l.append(u)}return n[0].readOnly?l.append('<div class="ui secondary cancel button">'+WorkflowDesignerConstants.ButtonTextClose+"</div>"):(l.append('<div class="ui primary ok button">'+WorkflowDesignerConstants.ButtonTextSave+"</div>"),l.append('<div class="ui secondary cancel button">'+WorkflowDesignerConstants.ButtonTextCancel+"</div>")),a.append(l),function(){void 0!==r&&WorkflowDesignerCommon.modal(i.parentForm.window,"hide"),WorkflowDesignerCommon.modal(a,{closable:!1,allowMultiple:!0,onApprove:function(){var e=ace.edit(n[0].id+"_editor").getValue();if(r){i.parentForm.ClearError();var s=null;try{s=JSON.parse(e)}catch(e){return o(a),!1}var l=""===r.paramsInfo[0].Name,d="Json"===r.paramsInfo[0].Type,c="TextArea"===r.paramsInfo[0].Type;if(l){if(t(s,r.paramsInfo[0]))return o(a),!1}else{var h=!1;if($.each(r.paramsInfo,function(e,i){if(t(s[i.Name],i))return h=!0,!1}),h)return o(a),!1}}l&&!d?c?n[0].value=i.parentForm.toCompactJSON(s).replace(/(?:\n)/g,"\\n"):n[0].value=i.parentForm.toCompactJSON(s):n[0].value=i.parentForm.toCompactJSON(e)},onHidden:function(){if(s){s=!1;var t=ace.edit(n[0].id+"_editor").getValue(),o=null;try{o=JSON.parse(t)}catch(e){}e(i,n,r.paramsInfo,o)}else setTimeout(function(){WorkflowDesignerCommon.modal(i.parentForm.window,"show"),WorkflowDesignerCommon.modal(i.parentForm.window,"refresh")},10)},dimmerSettings:{opacity:.2,duration:{show:0,hide:0}},transition:"fade"}),WorkflowDesignerCommon.modal(a,"show"),WorkflowDesignerCommon.modal(a,"refresh");var l=ace.edit(n[0].id+"_editor");n[0].readOnly?l.setOptions({readOnly:!0}):l.setOptions({readOnly:!1}),l.getSession().setMode("ace/mode/json"),l.setValue(i.parentForm.toPrettyJSON(void 0!==r?r.initialValue:n[0].value)),l.clearSelection()}}function o(e){$(".header",e).after('<div class="error-message" style="padding: 4px">'+WorkflowDesignerConstants.EditParametersFormlabel.InvalidJson+"</div>")}WorkflowDesignerWindows.JsonControl.prototype.generateParameterControl=function(e,t){var i=this,n=null;switch(i.parameter.parametertype){case"Action":n=t.ActionName;break;case"Condition":t.Action&&(n=t.Action.ActionName);break;case"RuleCheck":n=t.Rule}return i.build(n,e)},WorkflowDesignerWindows.JsonControl.prototype.generateBasicControl=function(e){var t=this,i=$('<input type="text"></input>');i[0].id=t.parentForm.generateid(t.parameter.field,t.prefix),i[0].name=t.parentForm.getElementCode(t.parameter),void 0!==e&&null!==e&&("object"==typeof e?i[0].value=JSON.stringify(e):i[0].value=e),t.parentForm.isReadOnly()&&i.attr("readonly",!0);var o=$('<a class="btnCodeActions"></a>');o[0].id=i[0].id+"_button",o.on("click",n(t,i)),t.parentForm.addAutoComplete(t.parameter,i);var r=$('<div style="width:100%;"></div>').append($('<div style="width:16px; float:right; margin-right:7px;margin-top: 10px;"></div>').append(o)).append($('<div style="margin-right:30px"></div>').append(i));return r[0].rebuild=function(e,i){return t.build(e,i)},r},WorkflowDesignerWindows.JsonControl.prototype.build=function(t,i){var n=this,o=null;if(t&&(o=n.parameter.graph.getActionParameterDefinition(t,n.parameter.parametertype)),!(o&&o.length||("RuleCheck"===n.parameter.parametertype&&(o=n.parameter.graph.getActionParameterDefinition(t,"RuleGet")),o&&o.length)))return n.generateBasicControl(i);null!==i&&""!==i||""!==o[0].Name||(i="TextArea"===o[0].Type?o[0].DefaultValue.replace(/(?:\n)/g,"\\n"):o[0].DefaultValue);var r=$('<input type="text"></input>');r[0].id=n.parentForm.generateid(n.parameter.field,n.prefix),r[0].name=n.parentForm.getElementCode(n.parameter),void 0!==i&&(r[0].value=i),n.parentForm.isReadOnly()&&r.attr("readonly",!0);var a=$('<a class="btnCodeActions"></a>');a[0].id=r[0].id+"_button",a.on("click",function(){e(n,r,o)});var s=$('<div style="width:100%;"></div>').append($('<div style="width:16px; float:right; margin-right:7px;margin-top: 10px;"></div>').append(a)).append($('<div style="margin-right:30px"></div>').append(r));return s[0].rebuild=function(e,t){return n.build(e,t)},s}}();var WorkflowDesignerWindows=WorkflowDesignerWindows||{};WorkflowDesignerWindows.MultiSelectControl=function(e){this.parentForm=e},WorkflowDesignerWindows.MultiSelectControl.prototype.generate=function(e,t,i){var n=this,o=$('<select class="ui search dropdown fluid" multiple=","></select>'),r=o.prop("type"),a=n.parentForm.getElementCode(e);return o.append($('<option value="">'+n.parentForm.getElementName(e)+"</option>")),void 0!==e.datasource&&e.datasource.forEach(function(i){var r=$("<option></option>");void 0===e.displayfield?(r[0].value=i,r[0].innerHTML=i):(r[0].innerHTML=i[e.displayfield],void 0!==e.valuefield?r[0].value=i[e.valuefield]:r[0].value=i[e.displayfield]),t&&t.length>0&&t.indexOf(r[0].value)!=-1&&(r[0].selected="selected",selected=!0),n.parentForm.isReadOnly()&&o.attr("disabled","disabled"),o.append(r)}),o=o.dropdown(),o.attr("id",n.parentForm.generateid(e.field,i)),o.attr("name",a),o.prop("type",r),void 0!==e.onchange&&o.on("change",function(){e.onchange(o)}),o};var WorkflowDesignerWindows=WorkflowDesignerWindows||{};WorkflowDesignerWindows.ParametersControl=function(e){this.parentForm=e},function(){function e(e){t(e);var i=e.parents("td").next().next(),n=i.children(),o=e.dropdown("get value"),r=n[0].rebuild(o);n.remove(),i.append(r)}function t(e){var t=e.parents("td").next().next().next().children(),i=e.dropdown("get value");"Dropdown"==i||"MultiSelect"==i?t.show():t.hide()}function i(e,t){return n(e,t,!0),!0}function n(e,t,i){var n=$(e).parents("table").first(),o=n.parents("td").prev().first(),r=t.getEditData({type:"table",control:n,elements:t.parameters.elements[4].elements});i&&r.splice(e[0].rowIndex-1,1);var o=n.parents("td").prev().first(),r=t.getEditData({type:"table",control:n,elements:t.parameters.elements[4].elements});i&&r.splice(e[0].rowIndex-1,1);var a=o.children().first(),s=a.dropdown("get value"),l="Dropdown",d=a.children("select")[0],c=d.type;if("select-multiple"==c&&(l="MultiSelect"),"select-one"==c&&""===s||"select-multiple"==c&&null==s){var h=!1;$.each(d.options,function(e,t){if(""===t.value)return h=!0,!1}),h||(s=void 0)}var u=a[0].rebuild(l,s,r);o.empty(),$(o).append(u[0])}WorkflowDesignerWindows.ParametersControl.prototype.generate=function(o,r,a){var s=this,l=$('<button class="ui button basic">'+WorkflowDesignerConstants.CodeActionsFormLabel.EditParameters+"</button>");return l[0].id=s.parentForm.generateid(o.field,a),l[0].name=s.parentForm.getElementCode(o),l[0].parameters=r,l.on("click",function(){var r=WorkflowDesignerConstants.CodeActionsFormLabel,a={type:"table",title:r.EditParameters,width:"800px",data:l[0].parameters,keyproperty:"Name",onrowadded:function(e){t(e.find("[name=Type]"))},elements:[{name:r.Name,field:"Name",type:"input"},{name:r.Type,field:"Type",type:"select",displayfield:"Name",valuefield:"Value",onchange:e,datasource:[{Name:r.Text,Value:"Text"},{Name:r.TextArea,Value:"TextArea"},{Name:r.Number,Value:"Number"},{Name:r.Checkbox,Value:"Checkbox"},{Name:r.Dropdown,Value:"Dropdown"},{Name:r.MultiSelect,Value:"MultiSelect"},{Name:r.DateTime,Value:"DateTime"},{Name:r.Json,Value:"Json"}]},{name:r.IsRequired,field:"IsRequired",type:"checkbox"},{name:r.DefaultValue,field:"DefaultValue",type:"defaultvalue",typeswitcher:"Type"},{name:r.Values,field:"DropdownValues",type:"table",onrowdelete:i,onrowchanged:n,elements:[{name:r.DropdownName,code:"DropdownValueName",field:"Name",type:"input"},{name:r.DropdownValue,code:"DropdownValueValue",field:"Value",type:"input"}]}],readonly:o.graph.Settings.readonly,onHidden:function(){setTimeout(function(){WorkflowDesignerCommon.modal(s.parentForm.window,"show"),WorkflowDesignerCommon.modal(s.parentForm.window,"refresh")},10)}},d=new WorkflowDesignerForm(a),c=function(e,t){var i=!0,n=null;return t.length>1?(i&=e.CheckRequired(t,["Name","Type"],WorkflowDesignerConstants.FieldIsRequired),
i&=e.CheckUnique(t,["Name"],WorkflowDesignerConstants.FieldMustBeUnique)):i&=e.CheckRequired(t,["Type"],WorkflowDesignerConstants.FieldIsRequired),i&&$.each(t,function(t,o){if("Dropdown"===o.Type||"MultiSelect"===o.Type){if(void 0===o.DropdownValues||!o.DropdownValues.length)return i=!1,$(o.control_DropdownValues).after('<div class="error-message">'+r.DropdownShouldContainValues+"</div>"),!1;if(!e.CheckUnique(o.DropdownValues,["Name"],WorkflowDesignerConstants.FieldMustBeUnique)||!e.CheckUnique(o.DropdownValues,["Value"],WorkflowDesignerConstants.FieldMustBeUnique))return i=!1,!1}if(""!==o.DefaultValue&&null!==o.DefaultValue&&(n=Validation.checkType(o.Type,o.DefaultValue)))return d.ControlAddError(o.control_DefaultValue,n),i=!1,!1}),i},h=function(e){return!!c(d,e)&&(d.ClearTempField(e),l[0].parameters=e,!0)};WorkflowDesignerCommon.modal(s.parentForm.window,"hide"),d.showModal(h),d.window.find("[name=Type]").each(function(e,i){t($(i))})}),l}}();var WorkflowDesignerWindows=WorkflowDesignerWindows||{};WorkflowDesignerWindows.SelectControl=function(e){this.parentForm=e},WorkflowDesignerWindows.SelectControl.prototype.generate=function(e,t,i){var n=this,o=$('<select class="ui search fluid dropdown "></select>'),r=o.prop("type"),a=!1,s=n.parentForm.getElementCode(e);return o.append($('<option value="">'+n.parentForm.getElementName(e)+"</option>")),void 0!==e.datasource&&e.datasource.forEach(function(i){var r=$("<option></option>");void 0===e.displayfield?(r[0].value=i,r[0].innerHTML=i):(r[0].innerHTML=i[e.displayfield],void 0!==e.valuefield?r[0].value=i[e.valuefield]:r[0].value=i[e.displayfield]),a||(r[0].value==t?(r[0].selected="selected",a=!0):void 0!==t&&null!==t&&void 0!==r[0].value&&null!==r[0].value&&r[0].value.toLowerCase()===t.toString().toLowerCase()&&(r[0].selected="selected",a=!0)),n.parentForm.isReadOnly()&&o.attr("disabled","disabled"),o.append(r)}),o=o.dropdown(),o.attr("id",n.parentForm.generateid(e.field,i)),o.attr("name",s),o.prop("type",r),o.css("min-width","150px"),void 0!=t&&this.onChange(o),void 0!==e.onchange?o.on("change",function(){n.onChange(o),e.onchange(o)}):o.on("change",function(){n.onChange(o)}),o},WorkflowDesignerWindows.SelectControl.prototype.onChange=function(e){void 0!=e.dropdown("get value")&&e.find(".dropdown.icon").removeClass("dropdown").addClass("delete").on("click",function(){e.dropdown("clear"),$(this).removeClass("delete").addClass("dropdown")})};var WorkflowDesignerWindows=WorkflowDesignerWindows||{};WorkflowDesignerWindows.TextAreaControl=function(e){this.parentForm=e},WorkflowDesignerWindows.TextAreaControl.prototype.generate=function(e,t,i){var n=this,o=$('<textarea type="text"></textarea>');return o[0].id=n.parentForm.generateid(e.field,i),o[0].name=n.parentForm.getElementCode(e),void 0!==t&&(o[0].value=t),n.parentForm.isReadOnly()&&o.attr("readonly",!0),n.parentForm.addAutoComplete(e,o),void 0!==e.onchange&&o.on("change",function(){e.onchange(o)}),o.data("initial-value",t),o},function(e,t,i,n){"use strict";t=void 0!==t&&t.Math==Math?t:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")(),e.fn.semanticmodal=function(n){var o,r=e(this),a=e(t),s=e(i),l=e("body"),d=r.selector||"",c=(new Date).getTime(),h=[],u=arguments[0],m="string"==typeof u,g=[].slice.call(arguments,1),f=t.requestAnimationFrame||t.mozRequestAnimationFrame||t.webkitRequestAnimationFrame||t.msRequestAnimationFrame||function(e){setTimeout(e,0)};return r.each(function(){var r,p,v,y,w,b,C,S,k,T=e.isPlainObject(n)?e.extend(!0,{},e.fn.modal.settings,n):e.extend({},e.fn.modal.settings),D=T.selector,x=T.className,A=T.namespace,_=T.error,W="."+A,I="module-"+A,N=e(this),P=e(T.context),E=N.find(D.close),M=this,F=N.data(I),L=!1;k={initialize:function(){k.verbose("Initializing dimmer",P),k.create.id(),k.create.dimmer(),k.refreshModals(),k.bind.events(),T.observeChanges&&k.observeChanges(),k.instantiate()},instantiate:function(){k.verbose("Storing instance of modal"),F=k,N.data(I,F)},create:{dimmer:function(){var t={debug:T.debug,variation:!T.centered&&"top aligned",dimmerName:"modals"},i=e.extend(!0,t,T.dimmerSettings);if(void 0===e.fn.dimmer)return void k.error(_.dimmer);k.debug("Creating dimmer"),y=P.dimmer(i),T.detachable?(k.verbose("Modal is detachable, moving content into dimmer"),y.dimmer("add content",N)):k.set.undetached(),w=y.dimmer("get dimmer")},id:function(){C=(Math.random().toString(16)+"000000000").substr(2,8),b="."+C,k.verbose("Creating unique id for element",C)}},destroy:function(){k.verbose("Destroying previous modal"),N.removeData(I).off(W),a.off(b),w.off(b),E.off(W),P.dimmer("destroy")},observeChanges:function(){"MutationObserver"in t&&(S=new MutationObserver(function(e){k.debug("DOM tree modified, refreshing"),k.refresh()}),S.observe(M,{childList:!0,subtree:!0}),k.debug("Setting up mutation observer",S))},refresh:function(){k.remove.scrolling(),k.cacheSizes(),k.can.useFlex()||k.set.modalOffset(),k.set.screenHeight(),k.set.type()},refreshModals:function(){p=N.siblings(D.modal),r=p.add(N)},attachEvents:function(t,i){var n=e(t);i=e.isFunction(k[i])?k[i]:k.toggle,n.length>0?(k.debug("Attaching modal events to element",t,i),n.off(W).on("click"+W,i)):k.error(_.notFound,t)},bind:{events:function(){k.verbose("Attaching events"),N.on("click"+W,D.close,k.event.close).on("click"+W,D.approve,k.event.approve).on("click"+W,D.deny,k.event.deny),a.on("resize"+b,k.event.resize)},scrollLock:function(){y.get(0).addEventListener("touchmove",k.event.preventScroll,{passive:!1})}},unbind:{scrollLock:function(){y.get(0).removeEventListener("touchmove",k.event.preventScroll,{passive:!1})}},get:{id:function(){return(Math.random().toString(16)+"000000000").substr(2,8)}},event:{approve:function(){if(L||T.onApprove.call(M,e(this))===!1)return void k.verbose("Approve callback returned false cancelling hide");L=!0,k.hide(function(){L=!1})},preventScroll:function(e){e.preventDefault()},deny:function(){if(L||T.onDeny.call(M,e(this))===!1)return void k.verbose("Deny callback returned false cancelling hide");L=!0,k.hide(function(){L=!1})},close:function(){k.hide()},click:function(t){if(!T.closable)return void k.verbose("Dimmer clicked but closable setting is disabled");var n=e(t.target),o=n.closest(D.modal).length>0,r=e.contains(i.documentElement,t.target);!o&&r&&k.is.active()&&(k.debug("Dimmer clicked, hiding all modals"),k.remove.clickaway(),T.allowMultiple?k.hide():k.hideAll())},debounce:function(e,t){clearTimeout(k.timer),k.timer=setTimeout(e,t)},keyboard:function(e){27==e.which&&(T.closable?(k.debug("Escape key pressed hiding modal"),k.hide()):k.debug("Escape key pressed, but closable is set to false"),e.preventDefault())},resize:function(){y.dimmer("is active")&&(k.is.animating()||k.is.active())&&f(k.refresh)}},toggle:function(){k.is.active()||k.is.animating()?k.hide():k.show()},show:function(t){t=e.isFunction(t)?t:function(){},k.refreshModals(),k.set.dimmerSettings(),k.set.dimmerStyles(),k.showModal(t)},hide:function(t){t=e.isFunction(t)?t:function(){},k.refreshModals(),k.hideModal(t)},showModal:function(t){t=e.isFunction(t)?t:function(){},k.is.animating()||!k.is.active()?(k.showDimmer(),k.cacheSizes(),k.can.useFlex()?k.remove.legacy():(k.set.legacy(),k.set.modalOffset(),k.debug("Using non-flex legacy modal positioning.")),k.set.screenHeight(),k.set.type(),k.set.clickaway(),!T.allowMultiple&&k.others.active()?k.hideOthers(k.showModal):(T.allowMultiple&&T.detachable&&N.detach().appendTo(w),T.onShow.call(M),T.transition&&void 0!==e.fn.transition&&N.transition("is supported")?(k.debug("Showing modal with css animations"),N.transition({debug:T.debug,animation:T.transition+" in",queue:T.queue,duration:T.duration,useFailSafe:!0,onComplete:function(){T.onVisible.apply(M),T.keyboardShortcuts&&k.add.keyboardShortcuts(),k.save.focus(),k.set.active(),T.autofocus&&k.set.autofocus(),t()}})):k.error(_.noTransition))):k.debug("Modal is already visible")},hideModal:function(t,i){if(t=e.isFunction(t)?t:function(){},k.debug("Hiding modal"),T.onHide.call(M,e(this))===!1)return void k.verbose("Hide callback returned false cancelling hide");(k.is.animating()||k.is.active())&&(T.transition&&void 0!==e.fn.transition&&N.transition("is supported")?(k.remove.active(),N.transition({debug:T.debug,animation:T.transition+" out",queue:T.queue,duration:T.duration,useFailSafe:!0,onStart:function(){k.others.active()||i||k.hideDimmer(),T.keyboardShortcuts&&k.remove.keyboardShortcuts()},onComplete:function(){T.onHidden.call(M),k.remove.dimmerStyles(),k.restore.focus(),t()}})):k.error(_.noTransition))},showDimmer:function(){y.dimmer("is animating")||!y.dimmer("is active")?(k.debug("Showing dimmer"),y.dimmer("show")):k.debug("Dimmer already visible")},hideDimmer:function(){if(!y.dimmer("is animating")&&!y.dimmer("is active"))return void k.debug("Dimmer is not visible cannot hide");k.unbind.scrollLock(),y.dimmer("hide",function(){k.remove.clickaway(),k.remove.screenHeight()})},hideAll:function(t){var i=r.filter("."+x.active+", ."+x.animating);t=e.isFunction(t)?t:function(){},i.length>0&&(k.debug("Hiding all visible modals"),k.hideDimmer(),i.modal("hide modal",t))},hideOthers:function(t){var i=p.filter("."+x.active+", ."+x.animating);t=e.isFunction(t)?t:function(){},i.length>0&&(k.debug("Hiding other modals",p),i.modal("hide modal",t,!0))},others:{active:function(){return p.filter("."+x.active).length>0},animating:function(){return p.filter("."+x.animating).length>0}},add:{keyboardShortcuts:function(){k.verbose("Adding keyboard shortcuts"),s.on("keyup"+W,k.event.keyboard)}},save:{focus:function(){e(i.activeElement).closest(N).length>0||(v=e(i.activeElement).blur())}},restore:{focus:function(){v&&v.length>0&&v.focus()}},remove:{active:function(){N.removeClass(x.active)},legacy:function(){N.removeClass(x.legacy)},clickaway:function(){w.off("click"+b)},dimmerStyles:function(){w.removeClass(x.inverted),y.removeClass(x.blurring)},bodyStyle:function(){""===l.attr("style")&&(k.verbose("Removing style attribute"),l.removeAttr("style"))},screenHeight:function(){k.debug("Removing page height"),l.css("height","")},keyboardShortcuts:function(){k.verbose("Removing keyboard shortcuts"),s.off("keyup"+W)},scrolling:function(){y.removeClass(x.scrolling),N.removeClass(x.scrolling)}},cacheSizes:function(){N.addClass(x.loading);var n=N.prop("scrollHeight"),o=N.outerWidth(),r=N.outerHeight();void 0!==k.cache&&0===r||(k.cache={pageHeight:e(i).outerHeight(),width:o,height:r+T.offset,scrollHeight:n+T.offset,contextHeight:"body"==T.context?e(t).height():y.height()},k.cache.topOffset=-(k.cache.height/2)),N.removeClass(x.loading),k.debug("Caching modal and container sizes",k.cache)},can:{useFlex:function(){return"auto"==T.useFlex?T.detachable&&!k.is.ie():T.useFlex},fit:function(){var e=k.cache.contextHeight,t=k.cache.contextHeight/2,i=k.cache.topOffset,n=k.cache.scrollHeight,o=k.cache.height,r=T.padding,a=t+i;return n>o?a+n+r<e:o+2*r<e}},is:{active:function(){return N.hasClass(x.active)},ie:function(){var e=!t.ActiveXObject&&"ActiveXObject"in t,i="ActiveXObject"in t;return e||i},animating:function(){return N.transition("is supported")?N.transition("is animating"):N.is(":visible")},scrolling:function(){return y.hasClass(x.scrolling)},modernBrowser:function(){return!(t.ActiveXObject||"ActiveXObject"in t)}},set:{autofocus:function(){var e=N.find("[tabindex], :input").filter(":visible"),t=e.filter("[autofocus]"),i=t.length>0?t.first():e.first();i.length>0&&i.focus()},clickaway:function(){w.on("click"+b,k.event.click)},dimmerSettings:function(){if(void 0===e.fn.dimmer)return void k.error(_.dimmer);var t={debug:T.debug,dimmerName:"modals",closable:"auto",useFlex:k.can.useFlex(),variation:!T.centered&&"top aligned",duration:{show:T.duration,hide:T.duration}},i=e.extend(!0,t,T.dimmerSettings);T.inverted&&(i.variation=void 0!==i.variation?i.variation+" inverted":"inverted"),P.dimmer("setting",i)},dimmerStyles:function(){T.inverted?w.addClass(x.inverted):w.removeClass(x.inverted),T.blurring?y.addClass(x.blurring):y.removeClass(x.blurring)},modalOffset:function(){var e=k.cache.width,t=k.cache.height;N.css({marginTop:T.centered&&k.can.fit()?-(t/2):0,marginLeft:-(e/2)}),k.verbose("Setting modal offset for legacy mode")},screenHeight:function(){k.can.fit()?l.css("height",""):(k.debug("Modal is taller than page content, resizing page height"),l.css("height",k.cache.height+2*T.padding))},active:function(){N.addClass(x.active)},scrolling:function(){y.addClass(x.scrolling),N.addClass(x.scrolling),k.unbind.scrollLock()},legacy:function(){N.addClass(x.legacy)},type:function(){k.can.fit()?(k.verbose("Modal fits on screen"),k.others.active()||k.others.animating()||(k.remove.scrolling(),k.bind.scrollLock())):(k.verbose("Modal cannot fit on screen setting to scrolling"),k.set.scrolling())},undetached:function(){y.addClass(x.undetached)}},setting:function(t,i){if(k.debug("Changing setting",t,i),e.isPlainObject(t))e.extend(!0,T,t);else{if(void 0===i)return T[t];e.isPlainObject(T[t])?e.extend(!0,T[t],i):T[t]=i}},internal:function(t,i){if(e.isPlainObject(t))e.extend(!0,k,t);else{if(void 0===i)return k[t];k[t]=i}},debug:function(){!T.silent&&T.debug&&(T.performance?k.performance.log(arguments):(k.debug=Function.prototype.bind.call(console.info,console,T.name+":"),k.debug.apply(console,arguments)))},verbose:function(){!T.silent&&T.verbose&&T.debug&&(T.performance?k.performance.log(arguments):(k.verbose=Function.prototype.bind.call(console.info,console,T.name+":"),k.verbose.apply(console,arguments)))},error:function(){T.silent||(k.error=Function.prototype.bind.call(console.error,console,T.name+":"),k.error.apply(console,arguments))},performance:{log:function(e){var t,i,n;T.performance&&(t=(new Date).getTime(),n=c||t,i=t-n,c=t,h.push({Name:e[0],Arguments:[].slice.call(e,1)||"",Element:M,"Execution Time":i})),clearTimeout(k.performance.timer),k.performance.timer=setTimeout(k.performance.display,500)},display:function(){var t=T.name+":",i=0;c=!1,clearTimeout(k.performance.timer),e.each(h,function(e,t){i+=t["Execution Time"]}),t+=" "+i+"ms",d&&(t+=" '"+d+"'"),(void 0!==console.group||void 0!==console.table)&&h.length>0&&(console.groupCollapsed(t),console.table?console.table(h):e.each(h,function(e,t){console.log(t.Name+": "+t["Execution Time"]+"ms")}),console.groupEnd()),h=[]}},invoke:function(t,i,n){var r,a,s,l=F;return i=i||g,n=M||n,"string"==typeof t&&void 0!==l&&(t=t.split(/[\. ]/),r=t.length-1,e.each(t,function(i,n){var o=i!=r?n+t[i+1].charAt(0).toUpperCase()+t[i+1].slice(1):t;if(e.isPlainObject(l[o])&&i!=r)l=l[o];else{if(void 0!==l[o])return a=l[o],!1;if(!e.isPlainObject(l[n])||i==r)return void 0!==l[n]&&(a=l[n],!1);l=l[n]}})),e.isFunction(a)?s=a.apply(n,i):void 0!==a&&(s=a),e.isArray(o)?o.push(s):void 0!==o?o=[o,s]:void 0!==s&&(o=s),a}},m?(void 0===F&&k.initialize(),k.invoke(u)):(void 0!==F&&F.invoke("destroy"),k.initialize())}),void 0!==o?o:this},e.fn.modal.settings={name:"Modal",namespace:"modal",useFlex:"auto",offset:0,silent:!1,debug:!1,verbose:!1,performance:!0,observeChanges:!1,allowMultiple:!1,detachable:!0,closable:!0,autofocus:!0,inverted:!1,blurring:!1,centered:!0,dimmerSettings:{closable:!1,useCSS:!0},keyboardShortcuts:!0,context:"body",queue:!1,duration:500,transition:"scale",padding:50,onShow:function(){},onVisible:function(){},onHide:function(){return!0},onHidden:function(){},onApprove:function(){return!0},onDeny:function(){return!0},selector:{close:"> .close",approve:".actions .positive, .actions .approve, .actions .ok",deny:".actions .negative, .actions .deny, .actions .cancel",modal:".ui.modal"},error:{dimmer:"UI Dimmer, a required component is not included in this page",method:"The method you called is not defined.",notFound:"The element you specified could not be found"},className:{active:"active",animating:"animating",blurring:"blurring",inverted:"inverted",legacy:"legacy",loading:"loading",scrolling:"scrolling",undetached:"undetached"}}}(jQuery,window,document),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.moment=t()}(this,function(){"use strict";function e(){return Qe.apply(null,arguments)}function t(e){return e instanceof Array||"[object Array]"===Object.prototype.toString.call(e)}function i(e){return null!=e&&"[object Object]"===Object.prototype.toString.call(e)}function n(e){return void 0===e}function o(e){return"number"==typeof e||"[object Number]"===Object.prototype.toString.call(e)}function r(e){return e instanceof Date||"[object Date]"===Object.prototype.toString.call(e)}function a(e,t){var i,n=[];for(i=0;i<e.length;++i)n.push(t(e[i],i));return n}function s(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function l(e,t){for(var i in t)s(t,i)&&(e[i]=t[i]);return s(t,"toString")&&(e.toString=t.toString),s(t,"valueOf")&&(e.valueOf=t.valueOf),e}function d(e,t,i,n){return pe(e,t,i,n,!0).utc()}function c(e){return null==e._pf&&(e._pf={empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],meridiem:null,rfc2822:!1,weekdayMismatch:!1}),e._pf}function h(e){if(null==e._isValid){var t=c(e),i=et.call(t.parsedDateParts,function(e){return null!=e}),n=!isNaN(e._d.getTime())&&t.overflow<0&&!t.empty&&!t.invalidMonth&&!t.invalidWeekday&&!t.weekdayMismatch&&!t.nullInput&&!t.invalidFormat&&!t.userInvalidated&&(!t.meridiem||t.meridiem&&i);if(e._strict&&(n=n&&0===t.charsLeftOver&&0===t.unusedTokens.length&&void 0===t.bigHour),null!=Object.isFrozen&&Object.isFrozen(e))return n;e._isValid=n}return e._isValid}function u(e){var t=d(NaN);return null!=e?l(c(t),e):c(t).userInvalidated=!0,t}function m(e,t){var i,o,r;if(n(t._isAMomentObject)||(e._isAMomentObject=t._isAMomentObject),n(t._i)||(e._i=t._i),n(t._f)||(e._f=t._f),n(t._l)||(e._l=t._l),n(t._strict)||(e._strict=t._strict),n(t._tzm)||(e._tzm=t._tzm),n(t._isUTC)||(e._isUTC=t._isUTC),n(t._offset)||(e._offset=t._offset),n(t._pf)||(e._pf=c(t)),n(t._locale)||(e._locale=t._locale),0<it.length)for(i=0;i<it.length;i++)n(r=t[o=it[i]])||(e[o]=r);return e}function g(t){m(this,t),this._d=new Date(null!=t._d?t._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),!1===nt&&(nt=!0,e.updateOffset(this),nt=!1)}function f(e){return e instanceof g||null!=e&&null!=e._isAMomentObject}function p(e){return e<0?Math.ceil(e)||0:Math.floor(e)}function v(e){var t=+e,i=0;return 0!==t&&isFinite(t)&&(i=p(t)),i}function y(e,t,i){var n,o=Math.min(e.length,t.length),r=Math.abs(e.length-t.length),a=0;for(n=0;n<o;n++)(i&&e[n]!==t[n]||!i&&v(e[n])!==v(t[n]))&&a++;return a+r}function w(t){!1===e.suppressDeprecationWarnings&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+t)}function b(t,i){var n=!0;return l(function(){if(null!=e.deprecationHandler&&e.deprecationHandler(null,t),n){for(var o,r=[],a=0;a<arguments.length;a++){if(o="","object"==typeof arguments[a]){for(var s in o+="\n["+a+"] ",arguments[0])o+=s+": "+arguments[0][s]+", ";o=o.slice(0,-2)}else o=arguments[a];r.push(o)}w(t+"\nArguments: "+Array.prototype.slice.call(r).join("")+"\n"+(new Error).stack),n=!1}return i.apply(this,arguments)},i)}function C(t,i){null!=e.deprecationHandler&&e.deprecationHandler(t,i),ot[t]||(w(i),ot[t]=!0)}function S(e){return e instanceof Function||"[object Function]"===Object.prototype.toString.call(e)}function k(e,t){var n,o=l({},e);for(n in t)s(t,n)&&(i(e[n])&&i(t[n])?(o[n]={},l(o[n],e[n]),l(o[n],t[n])):null!=t[n]?o[n]=t[n]:delete o[n]);for(n in e)s(e,n)&&!s(t,n)&&i(e[n])&&(o[n]=l({},o[n]));return o}function T(e){null!=e&&this.set(e)}function D(e,t){var i=e.toLowerCase();rt[i]=rt[i+"s"]=rt[t]=e}function x(e){return"string"==typeof e?rt[e]||rt[e.toLowerCase()]:void 0}function A(e){var t,i,n={};for(i in e)s(e,i)&&(t=x(i))&&(n[t]=e[i]);return n}function _(e,t){at[e]=t}function W(e,t,i){var n=""+Math.abs(e),o=t-n.length;return(0<=e?i?"+":"":"-")+Math.pow(10,Math.max(0,o)).toString().substr(1)+n}function I(e,t,i,n){var o=n;"string"==typeof n&&(o=function(){return this[n]()}),e&&(ct[e]=o),t&&(ct[t[0]]=function(){return W(o.apply(this,arguments),t[1],t[2])}),i&&(ct[i]=function(){return this.localeData().ordinal(o.apply(this,arguments),e)})}function N(e,t){return e.isValid()?(t=P(t,e.localeData()),dt[t]=dt[t]||function(e){var t,i,n,o=e.match(st);for(t=0,i=o.length;t<i;t++)ct[o[t]]?o[t]=ct[o[t]]:o[t]=(n=o[t]).match(/\[[\s\S]/)?n.replace(/^\[|\]$/g,""):n.replace(/\\/g,"");return function(t){var n,r="";for(n=0;n<i;n++)r+=S(o[n])?o[n].call(t,e):o[n];return r}}(t),dt[t](e)):e.localeData().invalidDate()}function P(e,t){function i(e){return t.longDateFormat(e)||e}var n=5;for(lt.lastIndex=0;0<=n&&lt.test(e);)e=e.replace(lt,i),lt.lastIndex=0,n-=1;return e}function E(e,t,i){Tt[e]=S(t)?t:function(e,n){return e&&i?i:t}}function M(e,t){return s(Tt,e)?Tt[e](t._strict,t._locale):new RegExp(F(e.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,i,n,o){return t||i||n||o})))}function F(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function L(e,t){var i,n=t;for("string"==typeof e&&(e=[e]),o(t)&&(n=function(e,i){i[t]=v(e)}),i=0;i<e.length;i++)Dt[e[i]]=n}function O(e,t){L(e,function(e,i,n,o){n._w=n._w||{},t(e,n._w,n,o)})}function R(e){return $(e)?366:365}function $(e){return e%4==0&&e%100!=0||e%400==0}function G(t,i){return function(n){return null!=n?(B(this,t,n),e.updateOffset(this,i),this):Y(this,t)}}function Y(e,t){return e.isValid()?e._d["get"+(e._isUTC?"UTC":"")+t]():NaN}function B(e,t,i){e.isValid()&&!isNaN(i)&&("FullYear"===t&&$(e.year())&&1===e.month()&&29===e.date()?e._d["set"+(e._isUTC?"UTC":"")+t](i,e.month(),V(i,e.month())):e._d["set"+(e._isUTC?"UTC":"")+t](i))}function V(e,t){if(isNaN(e)||isNaN(t))return NaN;var i,n=(t%(i=12)+i)%i;return e+=(t-n)/12,1===n?$(e)?29:28:31-n%7%2}function H(e,t){var i;if(!e.isValid())return e;if("string"==typeof t)if(/^\d+$/.test(t))t=v(t);else if(!o(t=e.localeData().monthsParse(t)))return e;return i=Math.min(e.date(),V(e.year(),t)),e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,i),e}function U(t){return null!=t?(H(this,t),e.updateOffset(this,!0),this):Y(this,"Month")}function j(){function e(e,t){return t.length-e.length}var t,i,n=[],o=[],r=[];for(t=0;t<12;t++)i=d([2e3,t]),n.push(this.monthsShort(i,"")),o.push(this.months(i,"")),r.push(this.months(i,"")),r.push(this.monthsShort(i,""));for(n.sort(e),o.sort(e),r.sort(e),t=0;t<12;t++)n[t]=F(n[t]),o[t]=F(o[t]);for(t=0;t<24;t++)r[t]=F(r[t]);this._monthsRegex=new RegExp("^("+r.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+o.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+n.join("|")+")","i")}function q(e){var t;if(e<100&&0<=e){var i=Array.prototype.slice.call(arguments);i[0]=e+400,t=new Date(Date.UTC.apply(null,i)),isFinite(t.getUTCFullYear())&&t.setUTCFullYear(e)}else t=new Date(Date.UTC.apply(null,arguments));return t}function z(e,t,i){var n=7+t-i;return-((7+q(e,0,n).getUTCDay()-t)%7)+n-1}function K(e,t,i,n,o){var r,a,s=1+7*(t-1)+(7+i-n)%7+z(e,n,o);return a=s<=0?R(r=e-1)+s:s>R(e)?(r=e+1,s-R(e)):(r=e,s),{year:r,dayOfYear:a}}function J(e,t,i){var n,o,r=z(e.year(),t,i),a=Math.floor((e.dayOfYear()-r-1)/7)+1;return a<1?n=a+X(o=e.year()-1,t,i):a>X(e.year(),t,i)?(n=a-X(e.year(),t,i),o=e.year()+1):(o=e.year(),n=a),{week:n,year:o}}function X(e,t,i){var n=z(e,t,i),o=z(e+1,t,i);return(R(e)-n+o)/7}function Z(e,t){return e.slice(t,7).concat(e.slice(0,t))}function Q(){function e(e,t){return t.length-e.length}var t,i,n,o,r,a=[],s=[],l=[],c=[];for(t=0;t<7;t++)i=d([2e3,1]).day(t),n=this.weekdaysMin(i,""),o=this.weekdaysShort(i,""),r=this.weekdays(i,""),a.push(n),s.push(o),l.push(r),c.push(n),c.push(o),c.push(r);for(a.sort(e),s.sort(e),l.sort(e),c.sort(e),t=0;t<7;t++)s[t]=F(s[t]),l[t]=F(l[t]),c[t]=F(c[t]);this._weekdaysRegex=new RegExp("^("+c.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+l.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+s.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+a.join("|")+")","i")}function ee(){return this.hours()%12||12}function te(e,t){I(e,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),t)})}function ie(e,t){return t._meridiemParse}function ne(e){return e?e.toLowerCase().replace("_","-"):e}function oe(e){var t=null;if(!Ot[e]&&"undefined"!=typeof module&&module&&module.exports)try{t=Mt._abbr,require("./locale/"+e),re(t)}catch(e){}return Ot[e]}function re(e,t){var i;return e&&((i=n(t)?se(e):ae(e,t))?Mt=i:"undefined"!=typeof console&&console.warn&&console.warn("Locale "+e+" not found. Did you forget to load it?")),Mt._abbr}function ae(e,t){if(null===t)return delete Ot[e],null;var i,n=Lt;if(t.abbr=e,null!=Ot[e])C("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),n=Ot[e]._config;else if(null!=t.parentLocale)if(null!=Ot[t.parentLocale])n=Ot[t.parentLocale]._config;else{if(null==(i=oe(t.parentLocale)))return Rt[t.parentLocale]||(Rt[t.parentLocale]=[]),Rt[t.parentLocale].push({name:e,config:t}),null;n=i._config}return Ot[e]=new T(k(n,t)),Rt[e]&&Rt[e].forEach(function(e){ae(e.name,e.config)}),re(e),Ot[e]}function se(e){var i;if(e&&e._locale&&e._locale._abbr&&(e=e._locale._abbr),!e)return Mt;if(!t(e)){if(i=oe(e))return i;e=[e]}return function(e){for(var t,i,n,o,r=0;r<e.length;){for(t=(o=ne(e[r]).split("-")).length,i=(i=ne(e[r+1]))?i.split("-"):null;0<t;){if(n=oe(o.slice(0,t).join("-")))return n;if(i&&i.length>=t&&y(o,i,!0)>=t-1)break;t--}r++}return Mt}(e)}function le(e){var t,i=e._a;return i&&-2===c(e).overflow&&(t=i[1]<0||11<i[1]?1:i[2]<1||i[2]>V(i[0],i[1])?2:i[3]<0||24<i[3]||24===i[3]&&(0!==i[4]||0!==i[5]||0!==i[6])?3:i[4]<0||59<i[4]?4:i[5]<0||59<i[5]?5:i[6]<0||999<i[6]?6:-1,c(e)._overflowDayOfYear&&(t<0||2<t)&&(t=2),c(e)._overflowWeeks&&-1===t&&(t=7),c(e)._overflowWeekday&&-1===t&&(t=8),c(e).overflow=t),e}function de(e,t,i){return null!=e?e:null!=t?t:i}function ce(t){var i,n,o,r,a,s=[];if(!t._d){var l,d;for(l=t,d=new Date(e.now()),o=l._useUTC?[d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()]:[d.getFullYear(),d.getMonth(),d.getDate()],t._w&&null==t._a[2]&&null==t._a[1]&&function(e){var t,i,n,o,r,a,s,l;if(null!=(t=e._w).GG||null!=t.W||null!=t.E)r=1,a=4,i=de(t.GG,e._a[0],J(ve(),1,4).year),n=de(t.W,1),((o=de(t.E,1))<1||7<o)&&(l=!0);else{r=e._locale._week.dow,a=e._locale._week.doy;var d=J(ve(),r,a);i=de(t.gg,e._a[0],d.year),n=de(t.w,d.week),null!=t.d?((o=t.d)<0||6<o)&&(l=!0):null!=t.e?(o=t.e+r,(t.e<0||6<t.e)&&(l=!0)):o=r}n<1||n>X(i,r,a)?c(e)._overflowWeeks=!0:null!=l?c(e)._overflowWeekday=!0:(s=K(i,n,o,r,a),e._a[0]=s.year,e._dayOfYear=s.dayOfYear)}(t),null!=t._dayOfYear&&(a=de(t._a[0],o[0]),(t._dayOfYear>R(a)||0===t._dayOfYear)&&(c(t)._overflowDayOfYear=!0),n=q(a,0,t._dayOfYear),t._a[1]=n.getUTCMonth(),t._a[2]=n.getUTCDate()),i=0;i<3&&null==t._a[i];++i)t._a[i]=s[i]=o[i];for(;i<7;i++)t._a[i]=s[i]=null==t._a[i]?2===i?1:0:t._a[i];24===t._a[3]&&0===t._a[4]&&0===t._a[5]&&0===t._a[6]&&(t._nextDay=!0,t._a[3]=0),t._d=(t._useUTC?q:function(e,t,i,n,o,r,a){var s;return e<100&&0<=e?(s=new Date(e+400,t,i,n,o,r,a),isFinite(s.getFullYear())&&s.setFullYear(e)):s=new Date(e,t,i,n,o,r,a),s}).apply(null,s),r=t._useUTC?t._d.getUTCDay():t._d.getDay(),null!=t._tzm&&t._d.setUTCMinutes(t._d.getUTCMinutes()-t._tzm),t._nextDay&&(t._a[3]=24),t._w&&void 0!==t._w.d&&t._w.d!==r&&(c(t).weekdayMismatch=!0)}}function he(e){var t,i,n,o,r,a,s=e._i,l=$t.exec(s)||Gt.exec(s);if(l){for(c(e).iso=!0,t=0,i=Bt.length;t<i;t++)if(Bt[t][1].exec(l[1])){o=Bt[t][0],n=!1!==Bt[t][2];break}if(null==o)return void(e._isValid=!1);if(l[3]){for(t=0,i=Vt.length;t<i;t++)if(Vt[t][1].exec(l[3])){r=(l[2]||" ")+Vt[t][0];break}if(null==r)return void(e._isValid=!1)}if(!n&&null!=r)return void(e._isValid=!1);if(l[4]){if(!Yt.exec(l[4]))return void(e._isValid=!1);a="Z"}e._f=o+(r||"")+(a||""),ge(e)}else e._isValid=!1}function ue(e,t,i,n,o,r){var a=[function(e){var t=parseInt(e,10);return t<=49?2e3+t:t<=999?1900+t:t}(e),It.indexOf(t),parseInt(i,10),parseInt(n,10),parseInt(o,10)];return r&&a.push(parseInt(r,10)),a}function me(e){var t,i,n,o=Ut.exec(e._i.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,""));if(o){var r=ue(o[4],o[3],o[2],o[5],o[6],o[7]);if(t=o[1],i=r,n=e,t&&Pt.indexOf(t)!==new Date(i[0],i[1],i[2]).getDay()&&(c(n).weekdayMismatch=!0,!(n._isValid=!1)))return;e._a=r,e._tzm=function(e,t,i){if(e)return jt[e];if(t)return 0;var n=parseInt(i,10),o=n%100;return(n-o)/100*60+o}(o[8],o[9],o[10]),e._d=q.apply(null,e._a),e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),c(e).rfc2822=!0}else e._isValid=!1}function ge(t){if(t._f!==e.ISO_8601)if(t._f!==e.RFC_2822){t._a=[],c(t).empty=!0;var i,n,o,r,a,l,d,h,u=""+t._i,m=u.length,g=0;for(o=P(t._f,t._locale).match(st)||[],i=0;i<o.length;i++)r=o[i],(n=(u.match(M(r,t))||[])[0])&&(0<(a=u.substr(0,u.indexOf(n))).length&&c(t).unusedInput.push(a),u=u.slice(u.indexOf(n)+n.length),g+=n.length),ct[r]?(n?c(t).empty=!1:c(t).unusedTokens.push(r),l=r,h=t,null!=(d=n)&&s(Dt,l)&&Dt[l](d,h._a,h,l)):t._strict&&!n&&c(t).unusedTokens.push(r);c(t).charsLeftOver=m-g,0<u.length&&c(t).unusedInput.push(u),t._a[3]<=12&&!0===c(t).bigHour&&0<t._a[3]&&(c(t).bigHour=void 0),c(t).parsedDateParts=t._a.slice(0),c(t).meridiem=t._meridiem,t._a[3]=function(e,t,i){var n;return null==i?t:null!=e.meridiemHour?e.meridiemHour(t,i):(null!=e.isPM&&((n=e.isPM(i))&&t<12&&(t+=12),n||12!==t||(t=0)),t)}(t._locale,t._a[3],t._meridiem),ce(t),le(t)}else me(t);else he(t)}function fe(s){var d,p,v,y,w=s._i,b=s._f;return s._locale=s._locale||se(s._l),null===w||void 0===b&&""===w?u({nullInput:!0}):("string"==typeof w&&(s._i=w=s._locale.preparse(w)),f(w)?new g(le(w)):(r(w)?s._d=w:t(b)?function(e){var t,i,n,o,r;if(0===e._f.length)return c(e).invalidFormat=!0,e._d=new Date(NaN);for(o=0;o<e._f.length;o++)r=0,t=m({},e),null!=e._useUTC&&(t._useUTC=e._useUTC),t._f=e._f[o],ge(t),h(t)&&(r+=c(t).charsLeftOver,r+=10*c(t).unusedTokens.length,c(t).score=r,(null==n||r<n)&&(n=r,i=t));l(e,i||t)}(s):b?ge(s):n(p=(d=s)._i)?d._d=new Date(e.now()):r(p)?d._d=new Date(p.valueOf()):"string"==typeof p?(v=d,null===(y=Ht.exec(v._i))?(he(v),!1===v._isValid&&(delete v._isValid,me(v),!1===v._isValid&&(delete v._isValid,e.createFromInputFallback(v)))):v._d=new Date(+y[1])):t(p)?(d._a=a(p.slice(0),function(e){return parseInt(e,10)}),ce(d)):i(p)?function(e){if(!e._d){var t=A(e._i);e._a=a([t.year,t.month,t.day||t.date,t.hour,t.minute,t.second,t.millisecond],function(e){return e&&parseInt(e,10)}),ce(e)}}(d):o(p)?d._d=new Date(p):e.createFromInputFallback(d),h(s)||(s._d=null),s))}function pe(e,n,o,r,a){var s,l={};return!0!==o&&!1!==o||(r=o,o=void 0),(i(e)&&function(e){if(Object.getOwnPropertyNames)return 0===Object.getOwnPropertyNames(e).length;var t;for(t in e)if(e.hasOwnProperty(t))return!1;return!0}(e)||t(e)&&0===e.length)&&(e=void 0),l._isAMomentObject=!0,l._useUTC=l._isUTC=a,l._l=o,l._i=e,l._f=n,l._strict=r,(s=new g(le(fe(l))))._nextDay&&(s.add(1,"d"),s._nextDay=void 0),s}function ve(e,t,i,n){return pe(e,t,i,n,!1)}function ye(e,i){var n,o;if(1===i.length&&t(i[0])&&(i=i[0]),!i.length)return ve();for(n=i[0],o=1;o<i.length;++o)i[o].isValid()&&!i[o][e](n)||(n=i[o]);return n}function we(e){var t=A(e),i=t.year||0,n=t.quarter||0,o=t.month||0,r=t.week||t.isoWeek||0,a=t.day||0,s=t.hour||0,l=t.minute||0,d=t.second||0,c=t.millisecond||0;this._isValid=function(e){for(var t in e)if(-1===xt.call(Kt,t)||null!=e[t]&&isNaN(e[t]))return!1;for(var i=!1,n=0;n<Kt.length;++n)if(e[Kt[n]]){if(i)return!1;parseFloat(e[Kt[n]])!==v(e[Kt[n]])&&(i=!0)}return!0}(t),this._milliseconds=+c+1e3*d+6e4*l+1e3*s*60*60,this._days=+a+7*r,this._months=+o+3*n+12*i,this._data={},this._locale=se(),this._bubble()}function be(e){return e instanceof we}function Ce(e){return e<0?-1*Math.round(-1*e):Math.round(e)}
function Se(e,t){I(e,0,0,function(){var e=this.utcOffset(),i="+";return e<0&&(e=-e,i="-"),i+W(~~(e/60),2)+t+W(~~e%60,2)})}function ke(e,t){var i=(t||"").match(e);if(null===i)return null;var n=((i[i.length-1]||[])+"").match(/([\+\-]|\d\d)/gi)||["-",0,0],o=60*n[1]+v(n[2]);return 0===o?0:"+"===n[0]?o:-o}function Te(t,i){var n,o;return i._isUTC?(n=i.clone(),o=(f(t)||r(t)?t.valueOf():ve(t).valueOf())-n.valueOf(),n._d.setTime(n._d.valueOf()+o),e.updateOffset(n,!1),n):ve(t).local()}function De(e){return 15*-Math.round(e._d.getTimezoneOffset()/15)}function xe(){return!!this.isValid()&&this._isUTC&&0===this._offset}function Ae(e,t){var i,n,r,a=e,l=null;return be(e)?a={ms:e._milliseconds,d:e._days,M:e._months}:o(e)?(a={},t?a[t]=e:a.milliseconds=e):(l=Jt.exec(e))?(i="-"===l[1]?-1:1,a={y:0,d:v(l[2])*i,h:v(l[3])*i,m:v(l[4])*i,s:v(l[5])*i,ms:v(Ce(1e3*l[6]))*i}):(l=Xt.exec(e))?(i="-"===l[1]?-1:1,a={y:_e(l[2],i),M:_e(l[3],i),w:_e(l[4],i),d:_e(l[5],i),h:_e(l[6],i),m:_e(l[7],i),s:_e(l[8],i)}):null==a?a={}:"object"==typeof a&&("from"in a||"to"in a)&&(r=function(e,t){var i;return e.isValid()&&t.isValid()?(t=Te(t,e),e.isBefore(t)?i=We(e,t):((i=We(t,e)).milliseconds=-i.milliseconds,i.months=-i.months),i):{milliseconds:0,months:0}}(ve(a.from),ve(a.to)),(a={}).ms=r.milliseconds,a.M=r.months),n=new we(a),be(e)&&s(e,"_locale")&&(n._locale=e._locale),n}function _e(e,t){var i=e&&parseFloat(e.replace(",","."));return(isNaN(i)?0:i)*t}function We(e,t){var i={};return i.months=t.month()-e.month()+12*(t.year()-e.year()),e.clone().add(i.months,"M").isAfter(t)&&--i.months,i.milliseconds=+t-+e.clone().add(i.months,"M"),i}function Ie(e,t){return function(i,n){var o;return null===n||isNaN(+n)||(C(t,"moment()."+t+"(period, number) is deprecated. Please use moment()."+t+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),o=i,i=n,n=o),Ne(this,Ae(i="string"==typeof i?+i:i,n),e),this}}function Ne(t,i,n,o){var r=i._milliseconds,a=Ce(i._days),s=Ce(i._months);t.isValid()&&(o=null==o||o,s&&H(t,Y(t,"Month")+s*n),a&&B(t,"Date",Y(t,"Date")+a*n),r&&t._d.setTime(t._d.valueOf()+r*n),o&&e.updateOffset(t,a||s))}function Pe(e,t){var i=12*(t.year()-e.year())+(t.month()-e.month()),n=e.clone().add(i,"months");return-(i+(t-n<0?(t-n)/(n-e.clone().add(i-1,"months")):(t-n)/(e.clone().add(i+1,"months")-n)))||0}function Ee(e){var t;return void 0===e?this._locale._abbr:(null!=(t=se(e))&&(this._locale=t),this)}function Me(){return this._locale}function Fe(e,t){return(e%t+t)%t}function Le(e,t,i){return e<100&&0<=e?new Date(e+400,t,i)-ti:new Date(e,t,i).valueOf()}function Oe(e,t,i){return e<100&&0<=e?Date.UTC(e+400,t,i)-ti:Date.UTC(e,t,i)}function Re(e,t){I(0,[e,e.length],0,t)}function $e(e,t,i,n,o){var r;return null==e?J(this,n,o).year:((r=X(e,n,o))<t&&(t=r),function(e,t,i,n,o){var r=K(e,t,i,n,o),a=q(r.year,0,r.dayOfYear);return this.year(a.getUTCFullYear()),this.month(a.getUTCMonth()),this.date(a.getUTCDate()),this}.call(this,e,t,i,n,o))}function Ge(e,t){t[6]=v(1e3*("0."+e))}function Ye(e){return e}function Be(e,t,i,n){var o=se(),r=d().set(n,t);return o[i](r,e)}function Ve(e,t,i){if(o(e)&&(t=e,e=void 0),e=e||"",null!=t)return Be(e,t,i,"month");var n,r=[];for(n=0;n<12;n++)r[n]=Be(e,n,i,"month");return r}function He(e,t,i,n){"boolean"==typeof e?o(t)&&(i=t,t=void 0):(t=e,e=!1,o(i=t)&&(i=t,t=void 0)),t=t||"";var r,a=se(),s=e?a._week.dow:0;if(null!=i)return Be(t,(i+s)%7,n,"day");var l=[];for(r=0;r<7;r++)l[r]=Be(t,(r+s)%7,n,"day");return l}function Ue(e,t,i,n){var o=Ae(t,i);return e._milliseconds+=n*o._milliseconds,e._days+=n*o._days,e._months+=n*o._months,e._bubble()}function je(e){return e<0?Math.floor(e):Math.ceil(e)}function qe(e){return 4800*e/146097}function ze(e){return 146097*e/4800}function Ke(e){return function(){return this.as(e)}}function Je(e){return function(){return this.isValid()?this._data[e]:NaN}}function Xe(e){return(0<e)-(e<0)||+e}function Ze(){if(!this.isValid())return this.localeData().invalidDate();var e,t,i=_i(this._milliseconds)/1e3,n=_i(this._days),o=_i(this._months);t=p((e=p(i/60))/60),i%=60,e%=60;var r=p(o/12),a=o%=12,s=n,l=t,d=e,c=i?i.toFixed(3).replace(/\.?0+$/,""):"",h=this.asSeconds();if(!h)return"P0D";var u=h<0?"-":"",m=Xe(this._months)!==Xe(h)?"-":"",g=Xe(this._days)!==Xe(h)?"-":"",f=Xe(this._milliseconds)!==Xe(h)?"-":"";return u+"P"+(r?m+r+"Y":"")+(a?m+a+"M":"")+(s?g+s+"D":"")+(l||d||c?"T":"")+(l?f+l+"H":"")+(d?f+d+"M":"")+(c?f+c+"S":"")}var Qe,et;et=Array.prototype.some?Array.prototype.some:function(e){for(var t=Object(this),i=t.length>>>0,n=0;n<i;n++)if(n in t&&e.call(this,t[n],n,t))return!0;return!1};var tt,it=e.momentProperties=[],nt=!1,ot={};e.suppressDeprecationWarnings=!1,e.deprecationHandler=null,tt=Object.keys?Object.keys:function(e){var t,i=[];for(t in e)s(e,t)&&i.push(t);return i};var rt={},at={},st=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,lt=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,dt={},ct={},ht=/\d\d/,ut=/\d{3}/,mt=/\d{4}/,gt=/[+-]?\d{6}/,ft=/\d\d?/,pt=/\d\d\d\d?/,vt=/\d\d\d\d\d\d?/,yt=/\d{1,3}/,wt=/\d{1,4}/,bt=/[+-]?\d{1,6}/,Ct=/[+-]?\d+/,St=/Z|[+-]\d\d(?::?\d\d)?/gi,kt=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,Tt={},Dt={};I("Y",0,0,function(){var e=this.year();return e<=9999?""+e:"+"+e}),I(0,["YY",2],0,function(){return this.year()%100}),I(0,["YYYY",4],0,"year"),I(0,["YYYYY",5],0,"year"),I(0,["YYYYYY",6,!0],0,"year"),D("year","y"),_("year",1),E("Y",Ct),E("YY",ft,ht),E("YYYY",wt,mt),E("YYYYY",bt,gt),E("YYYYYY",bt,gt),L(["YYYYY","YYYYYY"],0),L("YYYY",function(t,i){i[0]=2===t.length?e.parseTwoDigitYear(t):v(t)}),L("YY",function(t,i){i[0]=e.parseTwoDigitYear(t)}),L("Y",function(e,t){t[0]=parseInt(e,10)}),e.parseTwoDigitYear=function(e){return v(e)+(68<v(e)?1900:2e3)};var xt,At=G("FullYear",!0);xt=Array.prototype.indexOf?Array.prototype.indexOf:function(e){var t;for(t=0;t<this.length;++t)if(this[t]===e)return t;return-1},I("M",["MM",2],"Mo",function(){return this.month()+1}),I("MMM",0,0,function(e){return this.localeData().monthsShort(this,e)}),I("MMMM",0,0,function(e){return this.localeData().months(this,e)}),D("month","M"),_("month",8),E("M",ft),E("MM",ft,ht),E("MMM",function(e,t){return t.monthsShortRegex(e)}),E("MMMM",function(e,t){return t.monthsRegex(e)}),L(["M","MM"],function(e,t){t[1]=v(e)-1}),L(["MMM","MMMM"],function(e,t,i,n){var o=i._locale.monthsParse(e,n,i._strict);null!=o?t[1]=o:c(i).invalidMonth=e});var _t=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,Wt="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),It="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_");I("w",["ww",2],"wo","week"),I("W",["WW",2],"Wo","isoWeek"),D("week","w"),D("isoWeek","W"),_("week",5),_("isoWeek",5),E("w",ft),E("ww",ft,ht),E("W",ft),E("WW",ft,ht),O(["w","ww","W","WW"],function(e,t,i,n){t[n.substr(0,1)]=v(e)}),I("d",0,"do","day"),I("dd",0,0,function(e){return this.localeData().weekdaysMin(this,e)}),I("ddd",0,0,function(e){return this.localeData().weekdaysShort(this,e)}),I("dddd",0,0,function(e){return this.localeData().weekdays(this,e)}),I("e",0,0,"weekday"),I("E",0,0,"isoWeekday"),D("day","d"),D("weekday","e"),D("isoWeekday","E"),_("day",11),_("weekday",11),_("isoWeekday",11),E("d",ft),E("e",ft),E("E",ft),E("dd",function(e,t){return t.weekdaysMinRegex(e)}),E("ddd",function(e,t){return t.weekdaysShortRegex(e)}),E("dddd",function(e,t){return t.weekdaysRegex(e)}),O(["dd","ddd","dddd"],function(e,t,i,n){var o=i._locale.weekdaysParse(e,n,i._strict);null!=o?t.d=o:c(i).invalidWeekday=e}),O(["d","e","E"],function(e,t,i,n){t[n]=v(e)});var Nt="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),Pt="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),Et="Su_Mo_Tu_We_Th_Fr_Sa".split("_");I("H",["HH",2],0,"hour"),I("h",["hh",2],0,ee),I("k",["kk",2],0,function(){return this.hours()||24}),I("hmm",0,0,function(){return""+ee.apply(this)+W(this.minutes(),2)}),I("hmmss",0,0,function(){return""+ee.apply(this)+W(this.minutes(),2)+W(this.seconds(),2)}),I("Hmm",0,0,function(){return""+this.hours()+W(this.minutes(),2)}),I("Hmmss",0,0,function(){return""+this.hours()+W(this.minutes(),2)+W(this.seconds(),2)}),te("a",!0),te("A",!1),D("hour","h"),_("hour",13),E("a",ie),E("A",ie),E("H",ft),E("h",ft),E("k",ft),E("HH",ft,ht),E("hh",ft,ht),E("kk",ft,ht),E("hmm",pt),E("hmmss",vt),E("Hmm",pt),E("Hmmss",vt),L(["H","HH"],3),L(["k","kk"],function(e,t,i){var n=v(e);t[3]=24===n?0:n}),L(["a","A"],function(e,t,i){i._isPm=i._locale.isPM(e),i._meridiem=e}),L(["h","hh"],function(e,t,i){t[3]=v(e),c(i).bigHour=!0}),L("hmm",function(e,t,i){var n=e.length-2;t[3]=v(e.substr(0,n)),t[4]=v(e.substr(n)),c(i).bigHour=!0}),L("hmmss",function(e,t,i){var n=e.length-4,o=e.length-2;t[3]=v(e.substr(0,n)),t[4]=v(e.substr(n,2)),t[5]=v(e.substr(o)),c(i).bigHour=!0}),L("Hmm",function(e,t,i){var n=e.length-2;t[3]=v(e.substr(0,n)),t[4]=v(e.substr(n))}),L("Hmmss",function(e,t,i){var n=e.length-4,o=e.length-2;t[3]=v(e.substr(0,n)),t[4]=v(e.substr(n,2)),t[5]=v(e.substr(o))});var Mt,Ft=G("Hours",!0),Lt={calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},invalidDate:"Invalid date",ordinal:"%d",dayOfMonthOrdinalParse:/\d{1,2}/,relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},months:Wt,monthsShort:It,week:{dow:0,doy:6},weekdays:Nt,weekdaysMin:Et,weekdaysShort:Pt,meridiemParse:/[ap]\.?m?\.?/i},Ot={},Rt={},$t=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Gt=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Yt=/Z|[+-]\d\d(?::?\d\d)?/,Bt=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/]],Vt=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],Ht=/^\/?Date\((\-?\d+)/i,Ut=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,jt={UT:0,GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};e.createFromInputFallback=b("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged and will be removed in an upcoming major release. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))}),e.ISO_8601=function(){},e.RFC_2822=function(){};var qt=b("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=ve.apply(null,arguments);return this.isValid()&&e.isValid()?e<this?this:e:u()}),zt=b("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=ve.apply(null,arguments);return this.isValid()&&e.isValid()?this<e?this:e:u()}),Kt=["year","quarter","month","week","day","hour","minute","second","millisecond"];Se("Z",":"),Se("ZZ",""),E("Z",St),E("ZZ",St),L(["Z","ZZ"],function(e,t,i){i._useUTC=!0,i._tzm=ke(St,e)});e.updateOffset=function(){};var Jt=/^(\-|\+)?(?:(\d*)[. ])?(\d+)\:(\d+)(?:\:(\d+)(\.\d*)?)?$/,Xt=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;Ae.fn=we.prototype,Ae.invalid=function(){return Ae(NaN)};var Zt=Ie(1,"add"),Qt=Ie(-1,"subtract");e.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",e.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";var ei=b("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(e){return void 0===e?this.localeData():this.locale(e)}),ti=126227808e5;I(0,["gg",2],0,function(){return this.weekYear()%100}),I(0,["GG",2],0,function(){return this.isoWeekYear()%100}),Re("gggg","weekYear"),Re("ggggg","weekYear"),Re("GGGG","isoWeekYear"),Re("GGGGG","isoWeekYear"),D("weekYear","gg"),D("isoWeekYear","GG"),_("weekYear",1),_("isoWeekYear",1),E("G",Ct),E("g",Ct),E("GG",ft,ht),E("gg",ft,ht),E("GGGG",wt,mt),E("gggg",wt,mt),E("GGGGG",bt,gt),E("ggggg",bt,gt),O(["gggg","ggggg","GGGG","GGGGG"],function(e,t,i,n){t[n.substr(0,2)]=v(e)}),O(["gg","GG"],function(t,i,n,o){i[o]=e.parseTwoDigitYear(t)}),I("Q",0,"Qo","quarter"),D("quarter","Q"),_("quarter",7),E("Q",/\d/),L("Q",function(e,t){t[1]=3*(v(e)-1)}),I("D",["DD",2],"Do","date"),D("date","D"),_("date",9),E("D",ft),E("DD",ft,ht),E("Do",function(e,t){return e?t._dayOfMonthOrdinalParse||t._ordinalParse:t._dayOfMonthOrdinalParseLenient}),L(["D","DD"],2),L("Do",function(e,t){t[2]=v(e.match(ft)[0])});var ii=G("Date",!0);I("DDD",["DDDD",3],"DDDo","dayOfYear"),D("dayOfYear","DDD"),_("dayOfYear",4),E("DDD",yt),E("DDDD",ut),L(["DDD","DDDD"],function(e,t,i){i._dayOfYear=v(e)}),I("m",["mm",2],0,"minute"),D("minute","m"),_("minute",14),E("m",ft),E("mm",ft,ht),L(["m","mm"],4);var ni=G("Minutes",!1);I("s",["ss",2],0,"second"),D("second","s"),_("second",15),E("s",ft),E("ss",ft,ht),L(["s","ss"],5);var oi,ri=G("Seconds",!1);for(I("S",0,0,function(){return~~(this.millisecond()/100)}),I(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),I(0,["SSS",3],0,"millisecond"),I(0,["SSSS",4],0,function(){return 10*this.millisecond()}),I(0,["SSSSS",5],0,function(){return 100*this.millisecond()}),I(0,["SSSSSS",6],0,function(){return 1e3*this.millisecond()}),I(0,["SSSSSSS",7],0,function(){return 1e4*this.millisecond()}),I(0,["SSSSSSSS",8],0,function(){return 1e5*this.millisecond()}),I(0,["SSSSSSSSS",9],0,function(){return 1e6*this.millisecond()}),D("millisecond","ms"),_("millisecond",16),E("S",yt,/\d/),E("SS",yt,ht),E("SSS",yt,ut),oi="SSSS";oi.length<=9;oi+="S")E(oi,/\d+/);for(oi="S";oi.length<=9;oi+="S")L(oi,Ge);var ai=G("Milliseconds",!1);I("z",0,0,"zoneAbbr"),I("zz",0,0,"zoneName");var si=g.prototype;si.add=Zt,si.calendar=function(t,i){var n=t||ve(),o=Te(n,this).startOf("day"),r=e.calendarFormat(this,o)||"sameElse",a=i&&(S(i[r])?i[r].call(this,n):i[r]);return this.format(a||this.localeData().calendar(r,this,ve(n)))},si.clone=function(){return new g(this)},si.diff=function(e,t,i){var n,o,r;if(!this.isValid())return NaN;if(!(n=Te(e,this)).isValid())return NaN;switch(o=6e4*(n.utcOffset()-this.utcOffset()),t=x(t)){case"year":r=Pe(this,n)/12;break;case"month":r=Pe(this,n);break;case"quarter":r=Pe(this,n)/3;break;case"second":r=(this-n)/1e3;break;case"minute":r=(this-n)/6e4;break;case"hour":r=(this-n)/36e5;break;case"day":r=(this-n-o)/864e5;break;case"week":r=(this-n-o)/6048e5;break;default:r=this-n}return i?r:p(r)},si.endOf=function(t){var i;if(void 0===(t=x(t))||"millisecond"===t||!this.isValid())return this;var n=this._isUTC?Oe:Le;switch(t){case"year":i=n(this.year()+1,0,1)-1;break;case"quarter":i=n(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":i=n(this.year(),this.month()+1,1)-1;break;case"week":i=n(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":i=n(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":i=n(this.year(),this.month(),this.date()+1)-1;break;case"hour":i=this._d.valueOf(),i+=36e5-Fe(i+(this._isUTC?0:6e4*this.utcOffset()),36e5)-1;break;case"minute":i=this._d.valueOf(),i+=6e4-Fe(i,6e4)-1;break;case"second":i=this._d.valueOf(),i+=1e3-Fe(i,1e3)-1}return this._d.setTime(i),e.updateOffset(this,!0),this},si.format=function(t){t||(t=this.isUtc()?e.defaultFormatUtc:e.defaultFormat);var i=N(this,t);return this.localeData().postformat(i)},si.from=function(e,t){return this.isValid()&&(f(e)&&e.isValid()||ve(e).isValid())?Ae({to:this,from:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},si.fromNow=function(e){return this.from(ve(),e)},si.to=function(e,t){return this.isValid()&&(f(e)&&e.isValid()||ve(e).isValid())?Ae({from:this,to:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},si.toNow=function(e){return this.to(ve(),e)},si.get=function(e){return S(this[e=x(e)])?this[e]():this},si.invalidAt=function(){return c(this).overflow},si.isAfter=function(e,t){var i=f(e)?e:ve(e);return!(!this.isValid()||!i.isValid())&&("millisecond"===(t=x(t)||"millisecond")?this.valueOf()>i.valueOf():i.valueOf()<this.clone().startOf(t).valueOf())},si.isBefore=function(e,t){var i=f(e)?e:ve(e);return!(!this.isValid()||!i.isValid())&&("millisecond"===(t=x(t)||"millisecond")?this.valueOf()<i.valueOf():this.clone().endOf(t).valueOf()<i.valueOf())},si.isBetween=function(e,t,i,n){var o=f(e)?e:ve(e),r=f(t)?t:ve(t);return!!(this.isValid()&&o.isValid()&&r.isValid())&&("("===(n=n||"()")[0]?this.isAfter(o,i):!this.isBefore(o,i))&&(")"===n[1]?this.isBefore(r,i):!this.isAfter(r,i))},si.isSame=function(e,t){var i,n=f(e)?e:ve(e);return!(!this.isValid()||!n.isValid())&&("millisecond"===(t=x(t)||"millisecond")?this.valueOf()===n.valueOf():(i=n.valueOf(),this.clone().startOf(t).valueOf()<=i&&i<=this.clone().endOf(t).valueOf()))},si.isSameOrAfter=function(e,t){return this.isSame(e,t)||this.isAfter(e,t)},si.isSameOrBefore=function(e,t){return this.isSame(e,t)||this.isBefore(e,t)},si.isValid=function(){return h(this)},si.lang=ei,si.locale=Ee,si.localeData=Me,si.max=zt,si.min=qt,si.parsingFlags=function(){return l({},c(this))},si.set=function(e,t){if("object"==typeof e)for(var i=function(e){var t=[];for(var i in e)t.push({unit:i,priority:at[i]});return t.sort(function(e,t){return e.priority-t.priority}),t}(e=A(e)),n=0;n<i.length;n++)this[i[n].unit](e[i[n].unit]);else if(S(this[e=x(e)]))return this[e](t);return this},si.startOf=function(t){var i;if(void 0===(t=x(t))||"millisecond"===t||!this.isValid())return this;var n=this._isUTC?Oe:Le;switch(t){case"year":i=n(this.year(),0,1);break;case"quarter":i=n(this.year(),this.month()-this.month()%3,1);break;case"month":i=n(this.year(),this.month(),1);break;case"week":i=n(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":i=n(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":i=n(this.year(),this.month(),this.date());break;case"hour":i=this._d.valueOf(),i-=Fe(i+(this._isUTC?0:6e4*this.utcOffset()),36e5);break;case"minute":i=this._d.valueOf(),i-=Fe(i,6e4);break;case"second":i=this._d.valueOf(),i-=Fe(i,1e3)}return this._d.setTime(i),e.updateOffset(this,!0),this},si.subtract=Qt,si.toArray=function(){var e=this;return[e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second(),e.millisecond()]},si.toObject=function(){var e=this;return{years:e.year(),months:e.month(),date:e.date(),hours:e.hours(),minutes:e.minutes(),seconds:e.seconds(),milliseconds:e.milliseconds()}},si.toDate=function(){return new Date(this.valueOf())},si.toISOString=function(e){if(!this.isValid())return null;var t=!0!==e,i=t?this.clone().utc():this;return i.year()<0||9999<i.year()?N(i,t?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):S(Date.prototype.toISOString)?t?this.toDate().toISOString():new Date(this.valueOf()+60*this.utcOffset()*1e3).toISOString().replace("Z",N(i,"Z")):N(i,t?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")},si.inspect=function(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var e="moment",t="";this.isLocal()||(e=0===this.utcOffset()?"moment.utc":"moment.parseZone",t="Z");var i="["+e+'("]',n=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",o=t+'[")]';return this.format(i+n+"-MM-DD[T]HH:mm:ss.SSS"+o)},si.toJSON=function(){return this.isValid()?this.toISOString():null},si.toString=function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},si.unix=function(){return Math.floor(this.valueOf()/1e3)},si.valueOf=function(){return this._d.valueOf()-6e4*(this._offset||0)},si.creationData=function(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}},si.year=At,si.isLeapYear=function(){return $(this.year())},si.weekYear=function(e){return $e.call(this,e,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)},si.isoWeekYear=function(e){return $e.call(this,e,this.isoWeek(),this.isoWeekday(),1,4)},si.quarter=si.quarters=function(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)},si.month=U,si.daysInMonth=function(){return V(this.year(),this.month())},si.week=si.weeks=function(e){var t=this.localeData().week(this);return null==e?t:this.add(7*(e-t),"d")},si.isoWeek=si.isoWeeks=function(e){var t=J(this,1,4).week;return null==e?t:this.add(7*(e-t),"d")},si.weeksInYear=function(){var e=this.localeData()._week;return X(this.year(),e.dow,e.doy)},si.isoWeeksInYear=function(){return X(this.year(),1,4)},si.date=ii,si.day=si.days=function(e){if(!this.isValid())return null!=e?this:NaN;var t,i,n=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?(t=e,i=this.localeData(),e="string"!=typeof t?t:isNaN(t)?"number"==typeof(t=i.weekdaysParse(t))?t:null:parseInt(t,10),this.add(e-n,"d")):n},si.weekday=function(e){if(!this.isValid())return null!=e?this:NaN;var t=(this.day()+7-this.localeData()._week.dow)%7;return null==e?t:this.add(e-t,"d")},si.isoWeekday=function(e){if(!this.isValid())return null!=e?this:NaN;if(null==e)return this.day()||7;var t,i,n=(t=e,i=this.localeData(),"string"==typeof t?i.weekdaysParse(t)%7||7:isNaN(t)?null:t);return this.day(this.day()%7?n:n-7)},si.dayOfYear=function(e){var t=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==e?t:this.add(e-t,"d")},si.hour=si.hours=Ft,si.minute=si.minutes=ni,si.second=si.seconds=ri,si.millisecond=si.milliseconds=ai,si.utcOffset=function(t,i,n){var o,r=this._offset||0;if(!this.isValid())return null!=t?this:NaN;if(null==t)return this._isUTC?r:De(this);if("string"==typeof t){if(null===(t=ke(St,t)))return this}else Math.abs(t)<16&&!n&&(t*=60);return!this._isUTC&&i&&(o=De(this)),this._offset=t,this._isUTC=!0,null!=o&&this.add(o,"m"),r!==t&&(!i||this._changeInProgress?Ne(this,Ae(t-r,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,e.updateOffset(this,!0),this._changeInProgress=null)),this},si.utc=function(e){return this.utcOffset(0,e)},si.local=function(e){return this._isUTC&&(this.utcOffset(0,e),this._isUTC=!1,e&&this.subtract(De(this),"m")),this},si.parseZone=function(){if(null!=this._tzm)this.utcOffset(this._tzm,!1,!0);else if("string"==typeof this._i){var e=ke(/Z|[+-]\d\d:?\d\d/gi,this._i);null!=e?this.utcOffset(e):this.utcOffset(0,!0)}return this},si.hasAlignedHourOffset=function(e){return!!this.isValid()&&(e=e?ve(e).utcOffset():0,(this.utcOffset()-e)%60==0)},si.isDST=function(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()},si.isLocal=function(){return!!this.isValid()&&!this._isUTC},si.isUtcOffset=function(){return!!this.isValid()&&this._isUTC},si.isUtc=xe,si.isUTC=xe,si.zoneAbbr=function(){return this._isUTC?"UTC":""},si.zoneName=function(){return this._isUTC?"Coordinated Universal Time":""},si.dates=b("dates accessor is deprecated. Use date instead.",ii),si.months=b("months accessor is deprecated. Use month instead",U),si.years=b("years accessor is deprecated. Use year instead",At),si.zone=b("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",function(e,t){return null!=e?("string"!=typeof e&&(e=-e),this.utcOffset(e,t),this):-this.utcOffset()}),si.isDSTShifted=b("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",function(){if(!n(this._isDSTShifted))return this._isDSTShifted;var e={};if(m(e,this),(e=fe(e))._a){var t=e._isUTC?d(e._a):ve(e._a);this._isDSTShifted=this.isValid()&&0<y(e._a,t.toArray())}else this._isDSTShifted=!1;return this._isDSTShifted});var li=T.prototype;li.calendar=function(e,t,i){var n=this._calendar[e]||this._calendar.sameElse;return S(n)?n.call(t,i):n},li.longDateFormat=function(e){var t=this._longDateFormat[e],i=this._longDateFormat[e.toUpperCase()];return t||!i?t:(this._longDateFormat[e]=i.replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e])},li.invalidDate=function(){return this._invalidDate},li.ordinal=function(e){return this._ordinal.replace("%d",e)},li.preparse=Ye,li.postformat=Ye,li.relativeTime=function(e,t,i,n){var o=this._relativeTime[i];return S(o)?o(e,t,i,n):o.replace(/%d/i,e)},li.pastFuture=function(e,t){var i=this._relativeTime[0<e?"future":"past"];return S(i)?i(t):i.replace(/%s/i,t)},li.set=function(e){var t,i;for(i in e)S(t=e[i])?this[i]=t:this["_"+i]=t;this._config=e,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)},li.months=function(e,i){return e?t(this._months)?this._months[e.month()]:this._months[(this._months.isFormat||_t).test(i)?"format":"standalone"][e.month()]:t(this._months)?this._months:this._months.standalone},li.monthsShort=function(e,i){return e?t(this._monthsShort)?this._monthsShort[e.month()]:this._monthsShort[_t.test(i)?"format":"standalone"][e.month()]:t(this._monthsShort)?this._monthsShort:this._monthsShort.standalone},li.monthsParse=function(e,t,i){var n,o,r;if(this._monthsParseExact)return function(e,t,i){var n,o,r,a=e.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],n=0;n<12;++n)r=d([2e3,n]),this._shortMonthsParse[n]=this.monthsShort(r,"").toLocaleLowerCase(),this._longMonthsParse[n]=this.months(r,"").toLocaleLowerCase();return i?"MMM"===t?-1!==(o=xt.call(this._shortMonthsParse,a))?o:null:-1!==(o=xt.call(this._longMonthsParse,a))?o:null:"MMM"===t?-1!==(o=xt.call(this._shortMonthsParse,a))?o:-1!==(o=xt.call(this._longMonthsParse,a))?o:null:-1!==(o=xt.call(this._longMonthsParse,a))?o:-1!==(o=xt.call(this._shortMonthsParse,a))?o:null}.call(this,e,t,i);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),n=0;n<12;n++){if(o=d([2e3,n]),i&&!this._longMonthsParse[n]&&(this._longMonthsParse[n]=new RegExp("^"+this.months(o,"").replace(".","")+"$","i"),this._shortMonthsParse[n]=new RegExp("^"+this.monthsShort(o,"").replace(".","")+"$","i")),i||this._monthsParse[n]||(r="^"+this.months(o,"")+"|^"+this.monthsShort(o,""),this._monthsParse[n]=new RegExp(r.replace(".",""),"i")),i&&"MMMM"===t&&this._longMonthsParse[n].test(e))return n;if(i&&"MMM"===t&&this._shortMonthsParse[n].test(e))return n;if(!i&&this._monthsParse[n].test(e))return n}},li.monthsRegex=function(e){return this._monthsParseExact?(s(this,"_monthsRegex")||j.call(this),e?this._monthsStrictRegex:this._monthsRegex):(s(this,"_monthsRegex")||(this._monthsRegex=kt),this._monthsStrictRegex&&e?this._monthsStrictRegex:this._monthsRegex)},li.monthsShortRegex=function(e){return this._monthsParseExact?(s(this,"_monthsRegex")||j.call(this),e?this._monthsShortStrictRegex:this._monthsShortRegex):(s(this,"_monthsShortRegex")||(this._monthsShortRegex=kt),this._monthsShortStrictRegex&&e?this._monthsShortStrictRegex:this._monthsShortRegex)},li.week=function(e){return J(e,this._week.dow,this._week.doy).week},li.firstDayOfYear=function(){return this._week.doy},li.firstDayOfWeek=function(){return this._week.dow},li.weekdays=function(e,i){var n=t(this._weekdays)?this._weekdays:this._weekdays[e&&!0!==e&&this._weekdays.isFormat.test(i)?"format":"standalone"];return!0===e?Z(n,this._week.dow):e?n[e.day()]:n},li.weekdaysMin=function(e){return!0===e?Z(this._weekdaysMin,this._week.dow):e?this._weekdaysMin[e.day()]:this._weekdaysMin},li.weekdaysShort=function(e){return!0===e?Z(this._weekdaysShort,this._week.dow):e?this._weekdaysShort[e.day()]:this._weekdaysShort},li.weekdaysParse=function(e,t,i){var n,o,r;if(this._weekdaysParseExact)return function(e,t,i){var n,o,r,a=e.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],n=0;n<7;++n)r=d([2e3,1]).day(n),this._minWeekdaysParse[n]=this.weekdaysMin(r,"").toLocaleLowerCase(),this._shortWeekdaysParse[n]=this.weekdaysShort(r,"").toLocaleLowerCase(),this._weekdaysParse[n]=this.weekdays(r,"").toLocaleLowerCase();return i?"dddd"===t?-1!==(o=xt.call(this._weekdaysParse,a))?o:null:"ddd"===t?-1!==(o=xt.call(this._shortWeekdaysParse,a))?o:null:-1!==(o=xt.call(this._minWeekdaysParse,a))?o:null:"dddd"===t?-1!==(o=xt.call(this._weekdaysParse,a))?o:-1!==(o=xt.call(this._shortWeekdaysParse,a))?o:-1!==(o=xt.call(this._minWeekdaysParse,a))?o:null:"ddd"===t?-1!==(o=xt.call(this._shortWeekdaysParse,a))?o:-1!==(o=xt.call(this._weekdaysParse,a))?o:-1!==(o=xt.call(this._minWeekdaysParse,a))?o:null:-1!==(o=xt.call(this._minWeekdaysParse,a))?o:-1!==(o=xt.call(this._weekdaysParse,a))?o:-1!==(o=xt.call(this._shortWeekdaysParse,a))?o:null}.call(this,e,t,i);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),n=0;n<7;n++){if(o=d([2e3,1]).day(n),i&&!this._fullWeekdaysParse[n]&&(this._fullWeekdaysParse[n]=new RegExp("^"+this.weekdays(o,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[n]=new RegExp("^"+this.weekdaysShort(o,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[n]=new RegExp("^"+this.weekdaysMin(o,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[n]||(r="^"+this.weekdays(o,"")+"|^"+this.weekdaysShort(o,"")+"|^"+this.weekdaysMin(o,""),this._weekdaysParse[n]=new RegExp(r.replace(".",""),"i")),i&&"dddd"===t&&this._fullWeekdaysParse[n].test(e))return n;if(i&&"ddd"===t&&this._shortWeekdaysParse[n].test(e))return n;if(i&&"dd"===t&&this._minWeekdaysParse[n].test(e))return n;if(!i&&this._weekdaysParse[n].test(e))return n}},li.weekdaysRegex=function(e){return this._weekdaysParseExact?(s(this,"_weekdaysRegex")||Q.call(this),e?this._weekdaysStrictRegex:this._weekdaysRegex):(s(this,"_weekdaysRegex")||(this._weekdaysRegex=kt),this._weekdaysStrictRegex&&e?this._weekdaysStrictRegex:this._weekdaysRegex)},li.weekdaysShortRegex=function(e){return this._weekdaysParseExact?(s(this,"_weekdaysRegex")||Q.call(this),e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(s(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=kt),this._weekdaysShortStrictRegex&&e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)},li.weekdaysMinRegex=function(e){return this._weekdaysParseExact?(s(this,"_weekdaysRegex")||Q.call(this),e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(s(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=kt),this._weekdaysMinStrictRegex&&e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)},li.isPM=function(e){return"p"===(e+"").toLowerCase().charAt(0)},li.meridiem=function(e,t,i){return 11<e?i?"pm":"PM":i?"am":"AM"},re("en",{dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10;return e+(1===v(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")}}),e.lang=b("moment.lang is deprecated. Use moment.locale instead.",re),
e.langData=b("moment.langData is deprecated. Use moment.localeData instead.",se);var di=Math.abs,ci=Ke("ms"),hi=Ke("s"),ui=Ke("m"),mi=Ke("h"),gi=Ke("d"),fi=Ke("w"),pi=Ke("M"),vi=Ke("Q"),yi=Ke("y"),wi=Je("milliseconds"),bi=Je("seconds"),Ci=Je("minutes"),Si=Je("hours"),ki=Je("days"),Ti=Je("months"),Di=Je("years"),xi=Math.round,Ai={ss:44,s:45,m:45,h:22,d:26,M:11},_i=Math.abs,Wi=we.prototype;return Wi.isValid=function(){return this._isValid},Wi.abs=function(){var e=this._data;return this._milliseconds=di(this._milliseconds),this._days=di(this._days),this._months=di(this._months),e.milliseconds=di(e.milliseconds),e.seconds=di(e.seconds),e.minutes=di(e.minutes),e.hours=di(e.hours),e.months=di(e.months),e.years=di(e.years),this},Wi.add=function(e,t){return Ue(this,e,t,1)},Wi.subtract=function(e,t){return Ue(this,e,t,-1)},Wi.as=function(e){if(!this.isValid())return NaN;var t,i,n=this._milliseconds;if("month"===(e=x(e))||"quarter"===e||"year"===e)switch(t=this._days+n/864e5,i=this._months+qe(t),e){case"month":return i;case"quarter":return i/3;case"year":return i/12}else switch(t=this._days+Math.round(ze(this._months)),e){case"week":return t/7+n/6048e5;case"day":return t+n/864e5;case"hour":return 24*t+n/36e5;case"minute":return 1440*t+n/6e4;case"second":return 86400*t+n/1e3;case"millisecond":return Math.floor(864e5*t)+n;default:throw new Error("Unknown unit "+e)}},Wi.asMilliseconds=ci,Wi.asSeconds=hi,Wi.asMinutes=ui,Wi.asHours=mi,Wi.asDays=gi,Wi.asWeeks=fi,Wi.asMonths=pi,Wi.asQuarters=vi,Wi.asYears=yi,Wi.valueOf=function(){return this.isValid()?this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*v(this._months/12):NaN},Wi._bubble=function(){var e,t,i,n,o,r=this._milliseconds,a=this._days,s=this._months,l=this._data;return 0<=r&&0<=a&&0<=s||r<=0&&a<=0&&s<=0||(r+=864e5*je(ze(s)+a),s=a=0),l.milliseconds=r%1e3,e=p(r/1e3),l.seconds=e%60,t=p(e/60),l.minutes=t%60,i=p(t/60),l.hours=i%24,s+=o=p(qe(a+=p(i/24))),a-=je(ze(o)),n=p(s/12),s%=12,l.days=a,l.months=s,l.years=n,this},Wi.clone=function(){return Ae(this)},Wi.get=function(e){return e=x(e),this.isValid()?this[e+"s"]():NaN},Wi.milliseconds=wi,Wi.seconds=bi,Wi.minutes=Ci,Wi.hours=Si,Wi.days=ki,Wi.weeks=function(){return p(this.days()/7)},Wi.months=Ti,Wi.years=Di,Wi.humanize=function(e){if(!this.isValid())return this.localeData().invalidDate();var t,i,n,o,r,a,s,l,d,c,h,u=this.localeData(),m=(i=!e,n=u,o=Ae(t=this).abs(),r=xi(o.as("s")),a=xi(o.as("m")),s=xi(o.as("h")),l=xi(o.as("d")),d=xi(o.as("M")),c=xi(o.as("y")),(h=r<=Ai.ss&&["s",r]||r<Ai.s&&["ss",r]||a<=1&&["m"]||a<Ai.m&&["mm",a]||s<=1&&["h"]||s<Ai.h&&["hh",s]||l<=1&&["d"]||l<Ai.d&&["dd",l]||d<=1&&["M"]||d<Ai.M&&["MM",d]||c<=1&&["y"]||["yy",c])[2]=i,h[3]=0<+t,h[4]=n,function(e,t,i,n,o){return o.relativeTime(t||1,!!i,e,n)}.apply(null,h));return e&&(m=u.pastFuture(+this,m)),u.postformat(m)},Wi.toISOString=Ze,Wi.toString=Ze,Wi.toJSON=Ze,Wi.locale=Ee,Wi.localeData=Me,Wi.toIsoString=b("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",Ze),Wi.lang=ei,I("X",0,0,"unix"),I("x",0,0,"valueOf"),E("x",Ct),E("X",/[+-]?\d+(\.\d{1,3})?/),L("X",function(e,t,i){i._d=new Date(1e3*parseFloat(e,10))}),L("x",function(e,t,i){i._d=new Date(v(e))}),e.version="2.24.0",Qe=ve,e.fn=si,e.min=function(){return ye("isBefore",[].slice.call(arguments,0))},e.max=function(){return ye("isAfter",[].slice.call(arguments,0))},e.now=function(){return Date.now?Date.now():+new Date},e.utc=d,e.unix=function(e){return ve(1e3*e)},e.months=function(e,t){return Ve(e,t,"months")},e.isDate=r,e.locale=re,e.invalid=u,e.duration=Ae,e.isMoment=f,e.weekdays=function(e,t,i){return He(e,t,i,"weekdays")},e.parseZone=function(){return ve.apply(null,arguments).parseZone()},e.localeData=se,e.isDuration=be,e.monthsShort=function(e,t){return Ve(e,t,"monthsShort")},e.weekdaysMin=function(e,t,i){return He(e,t,i,"weekdaysMin")},e.defineLocale=ae,e.updateLocale=function(e,t){if(null!=t){var i,n,o=Lt;null!=(n=oe(e))&&(o=n._config),(i=new T(t=k(o,t))).parentLocale=Ot[e],Ot[e]=i,re(e)}else null!=Ot[e]&&(null!=Ot[e].parentLocale?Ot[e]=Ot[e].parentLocale:null!=Ot[e]&&delete Ot[e]);return Ot[e]},e.locales=function(){return tt(Ot)},e.weekdaysShort=function(e,t,i){return He(e,t,i,"weekdaysShort")},e.normalizeUnits=x,e.relativeTimeRounding=function(e){return void 0===e?xi:"function"==typeof e&&(xi=e,!0)},e.relativeTimeThreshold=function(e,t){return void 0!==Ai[e]&&(void 0===t?Ai[e]:(Ai[e]=t,"s"===e&&(Ai.ss=t-1),!0))},e.calendarFormat=function(e,t){var i=e.diff(t,"days",!0);return i<-6?"sameElse":i<-1?"lastWeek":i<0?"lastDay":i<1?"sameDay":i<2?"nextDay":i<7?"nextWeek":"sameElse"},e.prototype=si,e.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"},e});